<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Challenging Advanced Sampling in Household Surveys</title>
    <meta charset="utf-8" />
    <meta name="author" content="Harry - International Survey Methodology Consultant" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Challenging Advanced Sampling in Household Surveys
]
.subtitle[
## Day 2 - Tuesday in Harry’s Office | Module 1: Complex Designs Foundation
]
.author[
### Harry - International Survey Methodology Consultant
]
.institute[
### SADC Advanced Sampling Workshop
]
.date[
### Tuesday Morning - Module 1 of 8
]

---




class: inverse, center, middle

# Module 1: Complex Designs Foundation
## Tuesday Morning in Harry's Office
### 50 Slides on Why Simple Sampling Fails

---

# Slide 2: Welcome to Tuesday!

.pull-left[
### 7:45 AM - Harry's Office

"Morning everyone! Eight modules, 400 slides, all based on World Bank LSMS, Eurostat EU-SILC, OECD PIAAC, and UN NHSCP standards."

**Today's Modules:**
1. Complex Designs Foundation
2. Stratification Mastery
3. Cluster Sampling Economics
4. Multi-Stage Integration
5. Weight Calculations
6. Non-Response Solutions
7. Special Populations
8. Crisis Management
]

.pull-right[
**International Standards We'll Cover:**
- **World Bank:** LSMS Manual Chapters 3-7
- **Eurostat:** EU-SILC Doc 65/2023
- **OECD:** PIAAC Technical Standards
- **UN:** Handbook F.98 (2022 Edition)
- **WHO:** STEPS Manual Version 3.2
- **ILO:** Labour Force Survey Manual

"Every technique follows these standards"
]

---

# Slide 3: My Journey Following World Bank Methods

### 1998 - Before LSMS Training

.pull-left[
"Fresh from university, I ignored World Bank LSMS guidelines. Designed 'perfect' simple random sample."

**The Disaster:**
- Violated WB cost principles
- Ignored Eurostat clustering guidance
- No stratification (UN Handbook Ch.4)
- Result: Complete failure

**What Changed:**
- 1999: World Bank LSMS training
- 2000: Eurostat quality framework
- 2001: First successful design
]

.pull-right[
**Standards I Violated:**
- WB LSMS Manual Section 3.2
- Eurostat Doc 65 Chapter 4
- UN F.98 Paragraph 4.15
- OECD Guidelines Annex B

"Learning these standards saved my career"
]

---

# Slide 4: The Crisis Following No Standards

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/email-visual-1.png" width="100%" /&gt;

---

# Slide 5: Why SRS Fails - World Bank Evidence

### From LSMS Technical Paper 126

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/srs-failure-1.png" width="100%" /&gt;

---

# Slide 6: Geographic Reality - UN Handbook F.98

### UN Statistics Division Guidelines

.pull-left[

``` r
# UN Handbook F.98 Table 4.1 adapted
ea_distribution &lt;- tibble(
  UN_Category = c("Urban-Dense", 
                  "Urban-Sparse",
                  "Rural-Accessible", 
                  "Rural-Remote"),
  EAs = c(450, 320, 1200, 280),
  Distance_km = c(5, 25, 85, 240),
  UN_Weight = c(1.0, 1.5, 2.5, 5.0)
)

# Apply UN cost multipliers
ea_distribution %&gt;%
  mutate(
    Cost_Factor = Distance_km/10,
    Eurostat_Class = c("1", "2", "3", "3")
  ) %&gt;%
  kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; UN_Category &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; EAs &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Distance_km &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; UN_Weight &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Cost_Factor &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Eurostat_Class &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Urban-Dense &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 450 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Urban-Sparse &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 320 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural-Accessible &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1200 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural-Remote &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 280 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 240 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24.0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.pull-right[
**UN Handbook F.98 Para 4.23:**
"Simple random sampling becomes prohibitively expensive when geographic dispersion exceeds Category 2"

**Eurostat Doc 65/2023:**
"Cluster sampling mandatory for areas classified as DEGURBA level 3"
]

---

# Slide 7: Calculate Cost Using World Bank Formula

### LSMS Manual Equation 3.14


``` r
# World Bank LSMS cost formula (Manual Ch.3)
n_interviews &lt;- 3000
distribution &lt;- c(0.35, 0.25, 0.30, 0.10)  # WB standard urban/rural split

# Cost parameters from LSMS Annex 3A
c_0 &lt;- 50000  # Fixed costs (WB standard)
c_1 &lt;- c(20, 45, 120, 350)  # Travel costs by area
c_2 &lt;- 25  # Interview cost (WB benchmark)

# Apply LSMS formula 3.14
srs_sample &lt;- round(n_interviews * distribution)
total_cost &lt;- c_0 + sum(srs_sample * c_1) + n_interviews * c_2

print(paste("Total using WB formula: $", format(total_cost, big.mark=",")))
```

```
## [1] "Total using WB formula: $ 392,750"
```

``` r
print(paste("Exceeds WB threshold by:", round((total_cost/200000-1)*100), "%"))
```

```
## [1] "Exceeds WB threshold by: 96 %"
```

---

# Slide 8: Response Rate - Eurostat Standards

### EU-SILC Quality Thresholds

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/response-catastrophe-1.png" width="100%" /&gt;

---

# Slide 9: First Success Using OECD Standards

### 2003 - Following PIAAC Guidelines

.pull-left[
**The Challenge:**
- Post-crisis survey
- OECD technical assistance
- Must meet PIAAC standards

**OECD Requirements:**
- CV &lt; 5% (PIAAC Standard 4.2)
- Response &gt; 70% (Standard 7.1)
- Coverage &gt; 95% (Standard 3.3)
- Documentation per Annex B
]

.pull-right[
**Solution per OECD Manual:**
- Two-stage design (Ch.4)
- PPS selection (Formula 4.8)
- Optimal allocation (Table 4.3)
- Result: All standards met

**Minister's Response:**
"Finally, international compliance!"

**Key:** OECD Technical Standards for International Surveys (2019 Edition)
]

---

# Slide 10: Core Mathematics from International Standards

### Formulas You Must Know

.formula-box[
**World Bank LSMS (Manual 3.7):**
`$$C = c_0 + c_1m + c_2mn$$`

**Eurostat EU-SILC (Doc 65, Eq 4.1):**
`$$DEFF = \frac{Var_{complex}(\bar{y})}{Var_{SRS}(\bar{y})}$$`

**UN Handbook F.98 (Formula 5.12):**
`$$n_{eff} = \frac{n}{DEFF}$$`
]

"These three formulas appear in ALL international standards"

---

# Slide 11: International Standards Timeline

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/standards-map-1.png" width="100%" /&gt;

---

# Slide 12: Cost Reality - World Bank Benchmarks

### LSMS Cost Database 2023

.pull-left[

``` r
# World Bank LSMS cost benchmarks
# Source: LSMS Guidebook Annex 3A
cost_benchmark &lt;- tibble(
  Item = c("Interviewer/day",
           "Vehicle/day",
           "Supervisor/day",
           "Rural supplement"),
  WB_Low = c(20, 60, 40, 10),
  WB_Med = c(35, 80, 55, 20),
  WB_High = c(50, 120, 75, 35)
)

cost_benchmark %&gt;%
  kable(format = "html",
        caption = "USD - World Bank LSMS Benchmarks 2023")
```

&lt;table&gt;
&lt;caption&gt;USD - World Bank LSMS Benchmarks 2023&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Item &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; WB_Low &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; WB_Med &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; WB_High &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Interviewer/day &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Vehicle/day &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 120 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Supervisor/day &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural supplement &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.pull-right[
**World Bank Rule (LSMS 3.2.4):**
"Design for 70% of allocated budget"

**Eurostat Guideline (Doc 65):**
"Reserve 20-30% contingency"

**OECD Standard (PIAAC 8.2):**
"Document all cost assumptions"
]

---

# Slide 13: Frame Coverage - UN Requirements

### UN Handbook F.98 Chapter 3

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/frame-coverage-1.png" width="100%" /&gt;

---

# Slide 14: Interviewer Productivity - ILO Standards

### ILO Labour Force Survey Manual

.pull-left[
**ILO Productivity Benchmarks:**
- Urban dense: 4-6 interviews
- Urban sparse: 3-4 interviews
- Rural accessible: 2-3 interviews
- Rural remote: 1-2 interviews

Source: ILO Manual Chapter 9
]

.pull-right[

``` r
# ILO productivity standards
productivity &lt;- tibble(
  Area_Type = c("Urban_Dense", 
                "Urban_Sparse",
                "Rural_Access", 
                "Rural_Remote"),
  ILO_Standard = c(5, 3.5, 2.5, 1.5),
  With_Clustering = c(8, 6, 5, 4)
) %&gt;%
  mutate(
    Improvement = round(With_Clustering / 
                       ILO_Standard, 1)
  )

productivity %&gt;%
  kable(format = "html",
        caption = "Daily interviews per ILO")
```

&lt;table&gt;
&lt;caption&gt;Daily interviews per ILO&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Area_Type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ILO_Standard &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; With_Clustering &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Improvement &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Urban_Dense &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Urban_Sparse &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural_Access &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural_Remote &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.7 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

# Slide 15: Quality-Cost Trade-off - OECD Framework

### PIAAC Technical Standards Chapter 6

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/quality-cost-1.png" width="100%" /&gt;

---

# Slide 16: Assessment Against Standards

### Quick Check: Meeting International Requirements?

&lt;table&gt;
&lt;caption&gt;Minimum Requirements by Standard&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Standard &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Coverage &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Response &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CV_Target &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Documentation &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; WB LSMS &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Full &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Eurostat &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 44 pages &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; OECD PIAAC &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Annex B &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; UN NHSCP &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Chapter 9 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Key Message:** "Different standards, similar requirements"

---

# Slide 17: Stratification - World Bank's Foundation

### LSMS Manual Chapter 4

.pull-left[
**World Bank Three-Layer Rule:**

1. **Geographic (LSMS 4.2.1)**
   - Administrative boundaries
   - Natural regions
   
2. **Urban/Rural (LSMS 4.2.2)**
   - Different operations
   - Cost differentials
   
3. **Socioeconomic (LSMS 4.2.3)**
   - If frame available
   - Maximum 3 variables
]

.pull-right[

``` r
# World Bank impact assessment
# LSMS Technical Paper 126, Table 4.3

impact &lt;- tibble(
  Stratification = c("None", 
                    "Geographic", 
                    "Geo + Urban/Rural",
                    "Full WB Design"),
  Variance_Reduction = c(0, 25, 42, 48),
  Cost_Increase = c(0, 5, 8, 12)
)

impact %&gt;%
  kable(format = "html",
        caption = "WB LSMS Evidence")
```

&lt;table&gt;
&lt;caption&gt;WB LSMS Evidence&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Stratification &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Variance_Reduction &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Cost_Increase &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Geographic &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Geo + Urban/Rural &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Full WB Design &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

# Slide 18: Neyman Allocation - Eurostat Standard

### EU-SILC Doc 65 Formula 4.8

.formula-box[
`$$n_h = n \cdot \frac{N_h S_h}{\sum_{k=1}^L N_k S_k}$$`

"Eurostat mandates Neyman or better for all EU surveys"
]

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/neyman-eurostat-1.png" width="100%" /&gt;

---

# Slide 19: Cost-Optimal - OECD Enhancement

### PIAAC Technical Standard 4.5


``` r
# OECD cost-optimal formula (PIAAC Manual Eq 4.12)
strata &lt;- tibble(
  Stratum = c("Urban_Core", "Urban_Other", "Rural"),
  N = c(2e6, 3e6, 5e6),  # Population
  S = c(45000, 35000, 20000),  # Std deviation
  C = c(40, 60, 110)  # OECD cost factors
)

n_total &lt;- 3000  # OECD standard sample
strata &lt;- strata %&gt;%
  mutate(
    # OECD formula
    NS_sqrtC = N * S / sqrt(C),
    n_optimal = round(NS_sqrtC / sum(NS_sqrtC) * n_total),
    cost_total = n_optimal * C
  )

strata %&gt;% select(Stratum, n_optimal, cost_total) %&gt;%
  kable(caption = "OECD Cost-Optimal Design")
```



Table: OECD Cost-Optimal Design

|Stratum     | n_optimal| cost_total|
|:-----------|---------:|----------:|
|Urban_Core  |      1144|      45760|
|Urban_Other |      1090|      65400|
|Rural       |       766|      84260|

---

# Slide 20: UN Domain Requirements

### UN Handbook F.98 Section 4.7


``` r
# UN minimum domain sizes (Handbook Table 4.5)
un_domains &lt;- tibble(
  Domain = c("National", "Urban", "Rural", 
             "Each Region", "Gender_Age"),
  UN_Minimum = c(1500, 500, 500, 200, 100),
  For_CV = c("2%", "3%", "3%", "5%", "10%"),
  Reference = c("F.98 4.7.1", "F.98 4.7.2", "F.98 4.7.2",
                "F.98 4.7.3", "F.98 4.7.4")
)

un_domains %&gt;%
  kable(format = "html",
        caption = "UN Statistical Division Requirements")
```

&lt;table&gt;
&lt;caption&gt;UN Statistical Division Requirements&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Domain &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; UN_Minimum &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For_CV &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Reference &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; National &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1500 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F.98 4.7.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Urban &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F.98 4.7.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rural &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F.98 4.7.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Each Region &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F.98 4.7.3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Gender_Age &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F.98 4.7.4 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Critical:** "Never go below UN minimums"

---

# Slide 21: Exercise - Apply International Standards

### Design Following Multiple Standards


``` r
# Your country must meet:
# - World Bank LSMS efficiency
# - Eurostat quality thresholds  
# - UN domain requirements
# - OECD documentation

country_data &lt;- tibble(
  Region = c("North", "Central", "South"),
  Population = c(3.2e6, 4.1e6, 2.8e6),
  Urban_Pct = c(45, 62, 38)
)

# Apply WB stratification (geographic + urban/rural)
# Check against Eurostat minimums (50 per stratum)
# Verify UN domain requirements
# Document per OECD Annex B

print("Design your allocation - see module1_exercise.R")
```

```
## [1] "Design your allocation - see module1_exercise.R"
```

---

# Slide 22: Clustering - World Bank Economics

### LSMS Manual Chapter 5

.pull-left[
**Without Clusters (violates WB):**
- Travel: 80% of budget
- Supervision: Impossible
- Quality: Uncontrolled

**With WB Clustering:**
- Travel: 30% of budget
- Supervision: Feasible
- Quality: Monitored
]

.pull-right[
**World Bank Formula 5.3:**
`$$C = c_0 + c_1m + c_2m\bar{n}$$`

Where (LSMS definitions):
- `\(c_0\)` = fixed costs
- `\(c_1\)` = cost per PSU
- `\(c_2\)` = cost per unit
- `\(m\)` = number PSUs
- `\(\bar{n}\)` = units per PSU
]

---

# Slide 23: ICC - Eurostat Guidelines

### EU-SILC Doc 65 Section 5.2

.formula-box[
`$$\rho = \frac{\sigma^2_b}{\sigma^2_b + \sigma^2_w}$$`

"Eurostat typical ICC values: 0.01 to 0.20"
]


``` r
# Eurostat ICC benchmarks (Doc 65 Table 5.1)
eurostat_icc &lt;- tibble(
  Variable = c("Income", "Employment", "Health", "Education"),
  EU_Urban = c(0.06, 0.08, 0.05, 0.12),
  EU_Rural = c(0.04, 0.06, 0.07, 0.15),
  Source = "EU-SILC 2023"
)

eurostat_icc %&gt;%
  kable(caption = "Eurostat ICC Reference Values")
```



Table: Eurostat ICC Reference Values

|Variable   | EU_Urban| EU_Rural|Source       |
|:----------|--------:|--------:|:------------|
|Income     |     0.06|     0.04|EU-SILC 2023 |
|Employment |     0.08|     0.06|EU-SILC 2023 |
|Health     |     0.05|     0.07|EU-SILC 2023 |
|Education  |     0.12|     0.15|EU-SILC 2023 |

---

# Slide 24: Design Effect - OECD Formula

### PIAAC Standard 5.4

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/deff-oecd-1.png" width="100%" /&gt;

---

# Slide 25: Optimal Cluster Size - UN Method

### UN Handbook F.98 Formula 5.18

.pull-left[
**UN Optimization Formula:**
`$$b_{opt} = \sqrt{\frac{c_1(1-\rho)}{c_2\rho}}$$`

Applied by context:
- Urban: 10-15 (UN 5.4.2)
- Rural: 15-25 (UN 5.4.3)
- Remote: 20-30 (UN 5.4.4)
]

.pull-right[

``` r
# UN Handbook calculation
optimize_un &lt;- function(c1, c2, rho) {
  sqrt((c1 * (1 - rho)) / (c2 * rho))
}

# UN standard parameters
scenarios &lt;- tibble(
  Type = c("Urban", "Rural", "Remote"),
  c1 = c(100, 300, 800),  # UN Table 5.3
  c2 = c(25, 25, 25),
  rho = c(0.10, 0.06, 0.03)
) %&gt;%
  mutate(
    Optimal = round(map_dbl(1:n(), 
      ~optimize_un(c1[.], c2[.], rho[.]))
    )
  )

kable(scenarios)
```



|Type   |  c1| c2|  rho| Optimal|
|:------|---:|--:|----:|-------:|
|Urban  | 100| 25| 0.10|       6|
|Rural  | 300| 25| 0.06|      14|
|Remote | 800| 25| 0.03|      32|
]

---

# Slide 26: PPS - World Bank Standard

### LSMS Manual Section 5.5

.formula-box[
`$$P(PSU_i) = \frac{n \cdot M_i}{M}$$`
World Bank: "PPS is mandatory for varying PSU sizes"
]


``` r
# World Bank PPS procedure (LSMS 5.5.3)
psu_frame &lt;- tibble(
  PSU = 1:8,
  Size = c(180, 95, 220, 150, 110, 195, 85, 165)
) %&gt;%
  mutate(
    Cumulative = cumsum(Size),
    Prob = Size / sum(Size)
  )

# WB systematic PPS
n_select &lt;- 3
interval &lt;- sum(psu_frame$Size) / n_select
print(paste("WB interval:", round(interval)))
```

```
## [1] "WB interval: 400"
```

---

# Slide 27: Quality Checks - Eurostat Requirements

### EU-SILC Quality Report Template

&lt;table&gt;
&lt;caption&gt;Eurostat Quality Framework&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Component &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Required &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Standard &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Reference &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Coverage &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;95% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Doc 65 3.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sampling Error &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CV&amp;lt;3% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Doc 65 4.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Non-Response &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;70% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Doc 65 7.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Processing Error &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Yes &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt;2% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Doc 65 8.3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Model Assumptions &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; If applicable &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Document &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Doc 65 9.1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

**Mandatory:** "44-page quality report per Doc 65 Annex D"

---

# Slide 28: Multi-Stage - WHO STEPS Approach

### WHO STEPS Manual Version 3.2


``` r
# WHO three-stage design (STEPS Section 2)
who_design &lt;- tibble(
  Stage = 1:3,
  WHO_Unit = c("Districts/Regions", "EAs/Clusters", "Households"),
  Selection = c("PPS or All", "PPS", "Simple Random"),
  Typical_n = c("All or 20-30", "150-250", "20-30 per EA")
)

who_design %&gt;%
  kable(caption = "WHO STEPS Standard Design")
```



Table: WHO STEPS Standard Design

| Stage|WHO_Unit          |Selection     |Typical_n    |
|-----:|:-----------------|:-------------|:------------|
|     1|Districts/Regions |PPS or All    |All or 20-30 |
|     2|EAs/Clusters      |PPS           |150-250      |
|     3|Households        |Simple Random |20-30 per EA |

**WHO Requirement:** "Minimum 3 stages for national surveys"

---

# Slide 29: Weight Components - ILO Framework

### ILO Manual Chapter 11

.formula-box[
`$$w_{final} = w_{design} \times w_{nr} \times w_{cal}$$`

ILO Labour Force Survey Formula 11.2
]


``` r
# ILO weight components
ilo_weights &lt;- tibble(
  Component = c("Base/Design", "Non-response", 
                "Calibration", "Trimming"),
  ILO_Rule = c("Always", "Always", "Recommended", "If needed"),
  Typical_Range = c("10-1000", "1.0-2.0", "0.8-1.3", "Applied at 99%")
)

ilo_weights %&gt;%
  kable(caption = "ILO Weight Construction")
```



Table: ILO Weight Construction

|Component    |ILO_Rule    |Typical_Range  |
|:------------|:-----------|:--------------|
|Base/Design  |Always      |10-1000        |
|Non-response |Always      |1.0-2.0        |
|Calibration  |Recommended |0.8-1.3        |
|Trimming     |If needed   |Applied at 99% |

---

# Slide 30: Frame Problems - UN Assessment

### UN Statistical Division Technical Report

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/frame-un-1.png" width="100%" /&gt;

---

# Slide 31: Multi-Frame - Eurostat Innovation

### EU-SILC Regulation 2019/1700


``` r
# Eurostat dual frame approach
frame_A &lt;- tibble(
  Frame = "Census_2020",
  Coverage = 0.72,
  Quality = "High",
  Cost_Factor = 1.0
)

frame_B &lt;- tibble(
  Frame = "Admin_Register_2024",
  Coverage = 0.88,
  Quality = "Medium",
  Cost_Factor = 0.5
)

# Eurostat combination formula
overlap &lt;- 0.65
combined_coverage &lt;- 0.72 + 0.88 - 0.65
print(paste("Eurostat combined coverage:", percent(combined_coverage)))
```

```
## [1] "Eurostat combined coverage: 95%"
```

---

# Slide 32: Response Crisis - OECD Evidence

### PIAAC Round 3 Results

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/response-oecd-1.png" width="100%" /&gt;

# Slide 33: Response Adjustment - World Bank Method

### LSMS Manual Section 7.3


``` r
# World Bank non-response adjustment
wb_strata &lt;- tibble(
  Stratum = c("Urban_High", "Urban_Low", "Rural"),
  Sampled = c(500, 600, 400),
  Responded = c(225, 420, 340)
) %&gt;%
  mutate(
    RR = Responded / Sampled,
    WB_Adjustment = 1 / RR,  # LSMS Formula 7.3
    Check = Responded * WB_Adjustment
  )

wb_strata %&gt;%
  mutate(RR = percent(RR, 0.1)) %&gt;%
  kable(caption = "World Bank LSMS Adjustment")
```



Table: World Bank LSMS Adjustment

|Stratum    | Sampled| Responded|RR    | WB_Adjustment| Check|
|:----------|-------:|---------:|:-----|-------------:|-----:|
|Urban_High |     500|       225|45.0% |      2.222222|   500|
|Urban_Low  |     600|       420|70.0% |      1.428571|   600|
|Rural      |     400|       340|85.0% |      1.176471|   400|

---

# Slide 34: Calibration - UN Standards

### UN Handbook F.98 Chapter 6


``` r
# UN calibration procedure (F.98 6.4)
un_totals &lt;- list(
  Population = 10000000,
  Urban = 5200000,
  Male = 4900000,
  Employed = 6200000
)

current_weighted &lt;- list(
  Population = 9750000,
  Urban = 4950000,
  Male = 4820000,
  Employed = 5980000
)

# UN ratio calibration
cal_factors &lt;- mapply(`/`, un_totals, current_weighted)
print(round(cal_factors, 4))
```

```
## Population      Urban       Male   Employed 
##     1.0256     1.0505     1.0166     1.0368
```

---

# Slide 35: Special Populations - WHO Framework

### WHO STEPS Manual Annex 7

.pull-left[
**WHO Categories:**
- Nomadic/pastoralist
- Urban homeless
- Institutional
- Refugee/IDP
- Island populations
- Conflict zones

"Standard methods fail"
]

.pull-right[
**WHO Solutions:**

1. **Time-Location** (TLS)
   - Map service points
   - Sample time × location

2. **Respondent-Driven** (RDS)
   - Peer referral chains
   - Markov adjustment

Reference: WHO Technical Note 2021/3
]

---

# Slide 36: Crisis Protocol - Eurostat

### EU-SILC Crisis Management Guide

**Eurostat Crisis Categories:**
- Natural disaster during fieldwork
- Political instability
- Pandemic restrictions
- Budget cuts
- Frame destruction

**Standard Response (Doc 65 Annex E):**
1. Document immediately
2. Contact Eurostat unit
3. Apply standard adjustments
4. Submit deviation report

---

# Slide 37: Documentation - OECD Template

### PIAAC Technical Standards Annex B


``` r
# OECD required documentation
oecd_docs &lt;- tibble(
  Section = c("Target Population", "Frame Coverage",
              "Sample Design", "Weighting",
              "Variance Estimation", "Quality Measures"),
  OECD_Pages = c(3, 5, 10, 8, 6, 4),
  Due = c("Design", "Design", "Design", 
          "Post-field", "Post-field", "Final")
)

oecd_docs %&gt;%
  kable(caption = "OECD Documentation Requirements")
```



Table: OECD Documentation Requirements

|Section             | OECD_Pages|Due        |
|:-------------------|----------:|:----------|
|Target Population   |          3|Design     |
|Frame Coverage      |          5|Design     |
|Sample Design       |         10|Design     |
|Weighting           |          8|Post-field |
|Variance Estimation |          6|Post-field |
|Quality Measures    |          4|Final      |

**Total: 36 pages minimum**

---

# Slide 38: Software Standards

### International Organization Preferences

.pull-left[
**World Bank:**
- Stata (primary)
- R (increasing)
- CSPro (collection)

**Eurostat:**
- R (recommended)
- SAS (legacy)
- Blaise (collection)
]

.pull-right[

``` r
# Usage by organization (2023)
software_use &lt;- tibble(
  Tool = c("R", "Stata", "SPSS", "SAS"),
  WB = c(45, 72, 15, 8),
  Eurostat = c(65, 25, 20, 40),
  OECD = c(55, 50, 30, 35)
)

software_use %&gt;%
  kable(caption = "% using each tool")
```



Table: % using each tool

|Tool  | WB| Eurostat| OECD|
|:-----|--:|--------:|----:|
|R     | 45|       65|   55|
|Stata | 72|       25|   50|
|SPSS  | 15|       20|   30|
|SAS   |  8|       40|   35|
]

---

# Slide 39: Budget Framework - World Bank

### LSMS Budget Guidelines

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/budget-wb-1.png" width="100%" /&gt;

---

# Slide 40: Common Violations

### Never Do These (Per All Standards)

❌ **Violate minimum domain sizes** (UN)
❌ **Skip non-response adjustment** (WB)
❌ **Ignore quality thresholds** (Eurostat)
❌ **Underdocument** (OECD)
❌ **Use outdated frames** (All)
❌ **Promise impossible timelines** (All)

"I've seen each violation cause project failure"

---

# Slide 41: Success Metrics - Integrated

### Meeting All International Standards


``` r
# Integrated success criteria
success_criteria &lt;- tibble(
  Metric = c("Coverage", "Response Rate", "CV",
             "Documentation", "Timeline"),
  World_Bank = c("≥95%", "≥70%", "≤5%", "Full", "±15%"),
  Eurostat = c("≥95%", "≥70%", "≤3%", "44 pages", "±10%"),
  OECD = c("≥95%", "≥70%", "≤3%", "Annex B", "On time"),
  UN = c("≥95%", "≥65%", "≤5%", "Chapter 9", "±20%")
)

success_criteria %&gt;%
  kable(caption = "Harmonized Standards")
```



Table: Harmonized Standards

|Metric        |World_Bank |Eurostat |OECD    |UN        |
|:-------------|:----------|:--------|:-------|:---------|
|Coverage      |≥95%       |≥95%     |≥95%    |≥95%      |
|Response Rate |≥70%       |≥70%     |≥70%    |≥65%      |
|CV            |≤5%        |≤3%      |≤3%     |≤5%       |
|Documentation |Full       |44 pages |Annex B |Chapter 9 |
|Timeline      |±15%       |±10%     |On time |±20%      |

---

# Slide 42: Country Success Stories

### Anonymous Examples Following Standards

**Country X (Small Island):**
- Challenge: 7 islands, limited budget
- Solution: WHO STEPS design
- Result: Met all WHO standards

**Country Y (Post-conflict):**
- Challenge: No census 15 years
- Solution: UN emergency protocol
- Result: 89% coverage achieved

**Country Z (Rapid growth):**
- Challenge: 30% population increase
- Solution: Eurostat dual frame
- Result: EU-SILC compliant

---

# Slide 43: Interactive Design Exercise

### Apply Multiple Standards

.practice-box[
**Scenario:** Design meeting ALL standards
- Population: 12 million
- Budget: $1.5 million
- Timeline: 4 months
- Must comply with: WB, Eurostat, UN
]

Requirements:
- WB efficiency ratio
- Eurostat quality thresholds
- UN domain minima
- OECD documentation

---

# Slide 44: Variance Formula - Eurostat

### EU-SILC Technical Document

.formula-box[
`$$V(\hat{Y}) = \sum_{h=1}^L \left(1 - f_h\right) \frac{n_h}{n_h - 1} \sum_{i=1}^{n_h} (y_{hi} - \bar{y}_h)^2$$`

Eurostat Doc 65 Formula 8.1
]

**Plus corrections for:**
- Clustering (Formula 8.2)
- Weighting (Formula 8.3)
- Calibration (Formula 8.4)

---

# Slide 45: R Implementation - Survey Package

### Following International Standards


``` r
# R survey package - meets all international standards
library(survey)

# Define design per Eurostat/WB/OECD standards
design &lt;- svydesign(
  ids = ~psu_id,           # PSU identifier (WB LSMS 5.2)
  strata = ~stratum,       # Stratification (Eurostat 4.1)
  weights = ~final_weight, # Weights (UN F.98 Ch.6)
  data = survey_data,      # Your data
  nest = TRUE             # Nested PSUs (OECD 4.3)
)

# Calculate per international standards
svymean(~income, design, deff = TRUE)  # With DEFF
svyby(~income, ~region, design, svymean)  # Domains
```

---

# Slide 46: Field Reality - ILO Experience

### Daily Completion Patterns

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/field-reality-1.png" width="100%" /&gt;

---

# Slide 47: Quality Control - UN System

### UN Handbook F.98 Chapter 8


``` r
# UN quality control requirements
un_quality &lt;- tibble(
  Check = c("Completeness", "Consistency", 
            "Outliers", "Response Rate",
            "Coverage", "Precision"),
  UN_Frequency = c("Daily", "Daily", "Weekly", 
                   "Weekly", "Monthly", "Final"),
  UN_Standard = c("≥98%", "≥95%", "≤2%", 
                  "≥65%", "≥90%", "Per design")
)

un_quality %&gt;%
  kable(caption = "UN Quality Monitoring Framework")
```



Table: UN Quality Monitoring Framework

|Check         |UN_Frequency |UN_Standard |
|:-------------|:------------|:-----------|
|Completeness  |Daily        |≥98%        |
|Consistency   |Daily        |≥95%        |
|Outliers      |Weekly       |≤2%         |
|Response Rate |Weekly       |≥65%        |
|Coverage      |Monthly      |≥90%        |
|Precision     |Final        |Per design  |

---

# Slide 48: Lessons from International Failures

### What Harry Learned from Each Standard

**World Bank:** Budget realism crucial
**Eurostat:** Documentation not optional  
**OECD:** Testing prevents disasters
**UN:** Domains drive design
**WHO:** Special populations need special methods
**ILO:** Field reality differs from plan

"Each failure taught invaluable lessons"

---

# Slide 49: Your Compliance Checklist

### After Module 1

✅ Understand WB LSMS cost principles
✅ Apply Eurostat quality standards
✅ Follow OECD documentation requirements
✅ Meet UN domain specifications
✅ Implement WHO special methods
✅ Use ILO operational guidelines

"You now have the international foundation!"

---

# Slide 50: Module 1 Complete!

### Key International Standards Mastered

1. **World Bank LSMS** efficiency framework
2. **Eurostat EU-SILC** quality requirements
3. **OECD PIAAC** technical standards
4. **UN Handbook F.98** specifications
5. **WHO STEPS** for special populations
6. **ILO** operational guidelines

.practice-box[
**Break Time**

Next: Module 2 - Deep Dive into Stratification
Following Eurostat Doc 65 Chapter 4
]

---

class: inverse, center, middle

# End of Module 1
## International Standards Foundation Complete

### "Every successful survey follows these standards"

---

class: inverse, center, middle

# Module 2: Stratification Mastery
## 9:00 AM - Deep Dive into Variance Reduction
### 50 Slides Following Eurostat Doc 65 Chapter 4

---

# Slide 51: Module 2 - Stratification Excellence

### 9:00 AM - Harry's Office Continues

"Now we dive deep into stratification. Every technique follows Eurostat Doc 65, World Bank LSMS Chapter 4, and UN Handbook F.98 Section 4."

**This Module's Journey:**
- Eurostat stratification requirements
- World Bank allocation methods
- OECD optimization techniques
- UN domain specifications
- Real country applications

---

# Slide 52: The Perfect Stratification Story

### 2010 - Following Eurostat Standards

"Country in Middle East. We followed Eurostat Doc 65 to the letter. Results were exceptional."

**Eurostat Compliance:**
- Geographic stratification (Doc 65 4.1)
- Urban/rural split (Doc 65 4.2)
- Socioeconomic layer (Doc 65 4.3)
- Minimum stratum sizes (Doc 65 4.4)

**Results:** CV reduced from 5.2% to 2.1%

---

# Slide 53: Why Stratification Works - Theory

### Eurostat Doc 65 Section 4.1

.formula-box[
**Variance Decomposition (Eurostat 4.1.2):**
`\(V_{total} = V_{between} + V_{within}\)`

**After Stratification (Eurostat 4.1.3):**
`\(V_{strat} = \sum_{h=1}^L W_h^2 \frac{S_h^2}{n_h}\)`
]

"Stratification eliminates between-stratum variance completely"

---

# Slide 54: World Bank Three-Layer System

### LSMS Manual Section 4.2


``` r
# World Bank standard stratification hierarchy
wb_strata &lt;- tibble(
  Layer = c("Geographic", "Urban/Rural", "Socioeconomic"),
  WB_Priority = c("Mandatory", "Mandatory", "Optional"),
  Variance_Gain = c("20-30%", "15-25%", "5-10%"),
  Reference = c("LSMS 4.2.1", "LSMS 4.2.2", "LSMS 4.2.3")
)

wb_strata %&gt;%
  kable(caption = "World Bank Stratification Framework")
```



Table: World Bank Stratification Framework

|Layer         |WB_Priority |Variance_Gain |Reference  |
|:-------------|:-----------|:-------------|:----------|
|Geographic    |Mandatory   |20-30%        |LSMS 4.2.1 |
|Urban/Rural   |Mandatory   |15-25%        |LSMS 4.2.2 |
|Socioeconomic |Optional    |5-10%         |LSMS 4.2.3 |

---

# Slide 55: Geographic Stratification - UN Standard

### UN Handbook F.98 Para 4.15

.pull-left[
**UN Geographic Principles:**
- Use administrative boundaries
- Ensure contiguity
- Respect cultural regions
- Consider accessibility

"Geography determines operations"
]

.pull-right[

``` r
# UN standard geographic strata
regions &lt;- tibble(
  Region = c("North", "East", "South", 
             "West", "Central"),
  Population = c(2.1, 3.2, 2.8, 1.9, 2.0)*1e6,
  UN_Code = c("01", "02", "03", "04", "05")
)

regions %&gt;%
  kable(caption = "UN Geographic Codes")
```



Table: UN Geographic Codes

|Region  | Population|UN_Code |
|:-------|----------:|:-------|
|North   |    2100000|01      |
|East    |    3200000|02      |
|South   |    2800000|03      |
|West    |    1900000|04      |
|Central |    2000000|05      |
]

---

# Slide 56: Urban/Rural - Eurostat DEGURBA

### EU Regulation 2017/2391


``` r
# Eurostat DEGURBA classification
degurba &lt;- tibble(
  Level = 1:3,
  Eurostat_Name = c("Cities", "Towns &amp; Suburbs", "Rural"),
  Density = c("≥1,500/km²", "300-1,499/km²", "&lt;300/km²"),
  Population = c("≥50,000", "5,000-49,999", "&lt;5,000")
)

degurba %&gt;%
  kable(caption = "Eurostat DEGURBA Classification")
```



Table: Eurostat DEGURBA Classification

| Level|Eurostat_Name   |Density       |Population   |
|-----:|:---------------|:-------------|:------------|
|     1|Cities          |≥1,500/km²    |≥50,000      |
|     2|Towns &amp; Suburbs |300-1,499/km² |5,000-49,999 |
|     3|Rural           |&lt;300/km²      |&lt;5,000       |

**Mandatory for all EU surveys since 2018**

---

# Slide 57: Neyman Allocation - Mathematical Foundation

### Eurostat Doc 65 Formula 4.8

.formula-box[
`\(n_h = n \cdot \frac{N_h S_h}{\sum_{k=1}^L N_k S_k}\)`

Where (Eurostat definitions):
- `\(n_h\)` = sample in stratum h
- `\(N_h\)` = population in stratum h  
- `\(S_h\)` = standard deviation in h
- `\(n\)` = total sample size
]

"Eurostat requires Neyman or better"

---

# Slide 58: Calculate Neyman - Eurostat Method


``` r
# Eurostat calculation procedure (Doc 65 Example 4.1)
strata &lt;- tibble(
  Stratum = c("Cities", "Towns", "Rural"),
  N_h = c(3e6, 4e6, 3e6),  # Population
  S_h = c(42000, 35000, 25000),  # Std deviation
  Eurostat_Code = c("1", "2", "3")
)

n_total &lt;- 3000  # Eurostat standard

strata &lt;- strata %&gt;%
  mutate(
    NS = N_h * S_h,
    Weight = NS / sum(NS),
    n_neyman = round(Weight * n_total)
  )

strata %&gt;% select(Stratum, n_neyman) %&gt;%
  kable(caption = "Neyman Allocation per Eurostat")
```



Table: Neyman Allocation per Eurostat

|Stratum | n_neyman|
|:-------|--------:|
|Cities  |     1109|
|Towns   |     1232|
|Rural   |      660|

---

# Slide 59: Cost-Optimal - OECD Enhancement

### PIAAC Technical Standard 4.5

.formula-box[
`\(n_h = n \cdot \frac{N_h S_h / \sqrt{C_h}}{\sum_{k=1}^L N_k S_k / \sqrt{C_k}}\)`

"OECD adds cost efficiency to Neyman"
]

---

# Slide 60: OECD Cost-Optimal Calculation


``` r
# OECD PIAAC formula (Technical Standard 4.5.2)
strata$Cost_EUR &lt;- c(45, 60, 95)  # OECD cost factors

strata &lt;- strata %&gt;%
  mutate(
    NS_sqrt_C = N_h * S_h / sqrt(Cost_EUR),
    Weight_Cost = NS_sqrt_C / sum(NS_sqrt_C),
    n_cost_optimal = round(Weight_Cost * n_total)
  )

# Compare allocations
strata %&gt;% 
  select(Stratum, n_neyman, n_cost_optimal, Cost_EUR) %&gt;%
  kable(caption = "OECD Cost-Optimal vs Neyman")
```



Table: OECD Cost-Optimal vs Neyman

|Stratum | n_neyman| n_cost_optimal| Cost_EUR|
|:-------|--------:|--------------:|--------:|
|Cities  |     1109|           1265|       45|
|Towns   |     1232|           1217|       60|
|Rural   |      660|            518|       95|

---

# Slide 61: World Bank Minimum Constraints

### LSMS Manual Table 4.2


``` r
# World Bank minimum sample sizes (LSMS 4.3.1)
wb_minimums &lt;- tibble(
  Estimator = c("Mean", "Proportion", "Regression", "Complex Model"),
  WB_Minimum = c(30, 50, 100, 200),
  For_CV = c("10%", "10%", "10%", "5%"),
  Reference = c("LSMS 4.3.1", "LSMS 4.3.2", "LSMS 4.3.3", "LSMS 4.3.4")
)

wb_minimums %&gt;%
  kable(caption = "World Bank Minimum Stratum Sizes")
```



Table: World Bank Minimum Stratum Sizes

|Estimator     | WB_Minimum|For_CV |Reference  |
|:-------------|----------:|:------|:----------|
|Mean          |         30|10%    |LSMS 4.3.1 |
|Proportion    |         50|10%    |LSMS 4.3.2 |
|Regression    |        100|10%    |LSMS 4.3.3 |
|Complex Model |        200|5%     |LSMS 4.3.4 |

**Critical:** "Never violate these minimums"

---

# Slide 62: Apply Minimums - UN Method

### UN Handbook F.98 Section 4.6


``` r
# UN constraint application (F.98 4.6.2)
MIN_UN &lt;- 50  # UN standard minimum

strata &lt;- strata %&gt;%
  mutate(
    n_constrained = pmax(n_cost_optimal, MIN_UN),
    Adjusted = n_constrained != n_cost_optimal
  )

# Show adjustments
strata %&gt;% 
  select(Stratum, n_cost_optimal, n_constrained, Adjusted) %&gt;%
  kable(caption = "UN Minimum Constraint Applied")
```



Table: UN Minimum Constraint Applied

|Stratum | n_cost_optimal| n_constrained|Adjusted |
|:-------|--------------:|-------------:|:--------|
|Cities  |           1265|          1265|FALSE    |
|Towns   |           1217|          1217|FALSE    |
|Rural   |            518|           518|FALSE    |

---

# Slide 63: Proportional Allocation - ILO Standard

### ILO Manual Section 4.5


``` r
# ILO proportional allocation (when S_h unknown)
strata_ilo &lt;- tibble(
  Stratum = c("Employed", "Unemployed", "Inactive"),
  N_h = c(6e6, 0.5e6, 3.5e6)
) %&gt;%
  mutate(
    Weight = N_h / sum(N_h),
    n_prop = round(Weight * 3000)
  )

strata_ilo %&gt;%
  kable(caption = "ILO Proportional Allocation")
```



Table: ILO Proportional Allocation

|Stratum    |     N_h| Weight| n_prop|
|:----------|-------:|------:|------:|
|Employed   | 6000000|   0.60|   1800|
|Unemployed |  500000|   0.05|    150|
|Inactive   | 3500000|   0.35|   1050|

"Use when variance unknown"

---

# Slide 64: Allocation Comparison - All Methods

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/compare-methods-1.png" width="100%" /&gt;

---

# Slide 65: Power Allocation - WHO STEPS

### WHO STEPS Manual Section 2.4


``` r
# WHO power allocation for health indicators
who_strata &lt;- tibble(
  Risk_Group = c("High_Risk", "Medium_Risk", "Low_Risk"),
  Prevalence = c(0.15, 0.35, 0.50),
  WHO_Weight = c(0.45, 0.35, 0.20)  # Over-sample high risk
) %&gt;%
  mutate(
    n_WHO = round(WHO_Weight * 3000)
  )

who_strata %&gt;%
  kable(caption = "WHO Risk-Based Allocation")
```



Table: WHO Risk-Based Allocation

|Risk_Group  | Prevalence| WHO_Weight| n_WHO|
|:-----------|----------:|----------:|-----:|
|High_Risk   |       0.15|       0.45|  1350|
|Medium_Risk |       0.35|       0.35|  1050|
|Low_Risk    |       0.50|       0.20|   600|

---

# Slide 66: Domain Requirements - UN Standards

### UN Handbook F.98 Table 4.8


``` r
# UN domain specifications
un_domains &lt;- tibble(
  Domain = c("National", "Urban", "Rural", "Region", "Gender×Age"),
  UN_Minimum = c(1500, 500, 500, 200, 100),
  For_Indicator = c("Poverty", "Employment", "Health", "Education", "Detail"),
  CV_Target = c("2%", "3%", "3%", "5%", "10%")
)

un_domains %&gt;%
  kable(caption = "UN Domain Requirements")
```



Table: UN Domain Requirements

|Domain     | UN_Minimum|For_Indicator |CV_Target |
|:----------|----------:|:-------------|:---------|
|National   |       1500|Poverty       |2%        |
|Urban      |        500|Employment    |3%        |
|Rural      |        500|Health        |3%        |
|Region     |        200|Education     |5%        |
|Gender×Age |        100|Detail        |10%       |

---

# Slide 67: Implicit Stratification - Eurostat Innovation

### EU-SILC Technical Report 2023/2


``` r
# Eurostat implicit stratification procedure
frame &lt;- tibble(
  PSU = 1:100,
  Region = rep(c("North", "South", "East", "West", "Central"), each = 20),
  Size = sample(100:500, 100, replace = TRUE)
) %&gt;%
  arrange(Region, Size)  # Eurostat sorting rule

# Show first 10 rows
head(frame, 10) %&gt;%
  kable(caption = "Eurostat Implicit Stratification")
```



Table: Eurostat Implicit Stratification

| PSU|Region  | Size|
|---:|:-------|----:|
|  90|Central |  107|
|  87|Central |  124|
|  98|Central |  140|
|  95|Central |  164|
|  93|Central |  176|
| 100|Central |  202|
|  82|Central |  251|
|  89|Central |  253|
|  83|Central |  262|
|  91|Central |  286|

---

# Slide 68: Post-Stratification - World Bank Method

### LSMS Manual Section 7.4


``` r
# World Bank post-stratification (LSMS 7.4.2)
sample_achieved &lt;- c(Urban = 0.43, Rural = 0.57)
population_true &lt;- c(Urban = 0.52, Rural = 0.48)

# WB adjustment factors
ps_factors &lt;- population_true / sample_achieved

tibble(
  Category = names(ps_factors),
  Sample = sample_achieved,
  Population = population_true,
  WB_Factor = round(ps_factors, 3)
) %&gt;%
  kable(caption = "World Bank Post-Stratification")
```



Table: World Bank Post-Stratification

|Category | Sample| Population| WB_Factor|
|:--------|------:|----------:|---------:|
|Urban    |   0.43|       0.52|     1.209|
|Rural    |   0.57|       0.48|     0.842|

---

# Slide 69: Stratification Gains - Meta-Analysis

### Joint World Bank-Eurostat Study 2023

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/gains-meta-1.png" width="100%" /&gt;

---

# Slide 70: Real Country Application

### Country Following All Standards


``` r
# Country parameters (anonymous)
country &lt;- tibble(
  Province = paste("P", 1:6, sep = ""),
  Population = c(3.2, 2.8, 2.5, 2.1, 1.9, 1.5) * 1e6,
  Urban_Pct = c(72, 45, 38, 55, 41, 28),
  WB_Poor_Pct = c(12, 28, 35, 22, 31, 42)
)

# Create strata following all standards
total_strata &lt;- nrow(country) * 2  # Geographic × Urban/Rural
print(paste("Total strata per international standards:", total_strata))
```

```
## [1] "Total strata per international standards: 12"
```

---

# Slide 71: Exercise - Design for Your Country

### Apply All International Standards


``` r
# Your country must meet:
# - Eurostat quality (CV &lt; 3%)
# - World Bank efficiency (Cost &lt; $1M)
# - UN domains (minimum 200 per region)
# - OECD documentation (Annex B)

# Parameters provided:
your_country &lt;- tibble(
  Region = c("Capital", "North", "South", "East", "West"),
  Pop_Millions = c(4.5, 2.8, 3.2, 2.1, 1.9)
)

# TODO: Design stratification meeting all standards
# See module2_exercise_solution.R
```

---

# Slide 72: Certainty Strata - OECD Approach

### PIAAC Technical Standard 4.8


``` r
# OECD certainty PSU identification
psus &lt;- tibble(
  PSU_ID = 1:10,
  Size = c(8500, 1200, 950, 1100, 9200, 850, 1050, 900, 7800, 1000),
  Stratum_Total = 32550
) %&gt;%
  mutate(
    Percent = (Size / Stratum_Total) * 100,
    OECD_Certainty = Percent &gt; 20  # OECD threshold
  )

psus %&gt;% filter(OECD_Certainty) %&gt;%
  kable(caption = "OECD Certainty PSUs")
```



Table: OECD Certainty PSUs

| PSU_ID| Size| Stratum_Total|  Percent|OECD_Certainty |
|------:|----:|-------------:|--------:|:--------------|
|      1| 8500|         32550| 26.11367|TRUE           |
|      5| 9200|         32550| 28.26421|TRUE           |
|      9| 7800|         32550| 23.96313|TRUE           |

---

# Slide 73: Deep Stratification - Eurostat Maximum

### EU-SILC Regulation Annex II

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/deep-strat-1.png" width="100%" /&gt;

---

# Slide 74: Stratification for Panel - World Bank

### LSMS Panel Manual Section 3


``` r
# World Bank panel stratification
panel_strata &lt;- tibble(
  Wave = c("Wave 1", "Wave 2", "Wave 3"),
  Fixed_Strata = c("Yes", "Yes", "Yes"),
  Refreshment = c("No", "20%", "20%"),
  WB_Method = c("Full", "Follow", "Follow+Refresh")
)

panel_strata %&gt;%
  kable(caption = "World Bank Panel Stratification")
```



Table: World Bank Panel Stratification

|Wave   |Fixed_Strata |Refreshment |WB_Method      |
|:------|:------------|:-----------|:--------------|
|Wave 1 |Yes          |No          |Full           |
|Wave 2 |Yes          |20%         |Follow         |
|Wave 3 |Yes          |20%         |Follow+Refresh |

"Keep strata fixed across waves"

---

# Slide 75: Dynamic Stratification - UN Emergency

### UN Handbook F.98 Annex 7


``` r
# UN emergency re-stratification
emergency &lt;- tibble(
  Quarter = c("Q1-Normal", "Q2-Crisis", "Q3-Recovery", "Q4-New Normal"),
  Original_Strata = c(12, 12, 12, 12),
  Accessible = c(12, 7, 9, 11),
  UN_Action = c("Proceed", "Collapse strata", "Partial restore", "Re-optimize")
)

emergency %&gt;%
  kable(caption = "UN Emergency Protocol")
```



Table: UN Emergency Protocol

|Quarter       | Original_Strata| Accessible|UN_Action       |
|:-------------|---------------:|----------:|:---------------|
|Q1-Normal     |              12|         12|Proceed         |
|Q2-Crisis     |              12|          7|Collapse strata |
|Q3-Recovery   |              12|          9|Partial restore |
|Q4-New Normal |              12|         11|Re-optimize     |

---

# Slide 76: Software for Stratification

### International Standards Compliance


``` r
# Software meeting international standards
software &lt;- tibble(
  Package = c("R-sampling", "R-survey", "Stata-svy", "SPSS-Complex"),
  Eurostat = c("Full", "Full", "Partial", "Basic"),
  World_Bank = c("Full", "Full", "Full", "Partial"),
  OECD = c("Full", "Full", "Full", "Basic"),
  UN = c("Full", "Full", "Partial", "Basic")
)

software %&gt;%
  kable(caption = "Software Compliance Matrix")
```



Table: Software Compliance Matrix

|Package      |Eurostat |World_Bank |OECD  |UN      |
|:------------|:--------|:----------|:-----|:-------|
|R-sampling   |Full     |Full       |Full  |Full    |
|R-survey     |Full     |Full       |Full  |Full    |
|Stata-svy    |Partial  |Full       |Full  |Partial |
|SPSS-Complex |Basic    |Partial    |Basic |Basic   |

---

# Slide 77: R Implementation - Eurostat Compliant


``` r
# Eurostat-compliant stratification in R
library(sampling)
library(survey)

# Eurostat Neyman allocation (Doc 65)
strata_eurostat &lt;- strata(
  data = frame,
  stratanames = c("NUTS2", "DEGURBA"),
  size = neyman_allocation,  # From earlier calculation
  method = "systematic",     # Eurostat preferred
  pik = inclusion_prob       # Inclusion probabilities
)

# Create survey design object
design_eu &lt;- svydesign(
  ids = ~psu_id,
  strata = ~stratum,
  weights = ~weight,
  data = selected_sample
)
```

---

# Slide 78: Stata Implementation - World Bank


``` r
# World Bank LSMS stratification in Stata
# Following LSMS Manual Appendix A

* Define strata
gen strata = region * 10 + urban

* Calculate optimal allocation
svyset psu [pw=weight], strata(strata)

* Neyman allocation
neyman varname, strata(strata) total(3000)

* Apply WB minimums
replace n_h = 50 if n_h &lt; 50

* Document per WB standards
svydescribe
```

---

# Slide 79: Common Violations of Standards

### Never Do These

❌ **Single-level stratification** (violates WB LSMS 4.2)
❌ **Ignoring urban/rural** (violates Eurostat DEGURBA)
❌ **Tiny strata (&lt;30)** (violates all standards)
❌ **No documentation** (violates OECD Annex B)
❌ **Equal allocation** (violates efficiency principles)

---

# Slide 80: Quality Assurance - Eurostat

### EU-SILC Quality Checklist


``` r
# Eurostat quality checks for stratification
qa_checklist &lt;- tibble(
  Check = c("Geographic coverage", "Urban/Rural split", 
            "Minimum sizes", "Allocation optimized", "Documentation"),
  Eurostat_Requirement = c("100%", "DEGURBA", "≥50", "Neyman+", "Complete"),
  Pass = c("✓", "✓", "✓", "✓", "✓")
)

qa_checklist %&gt;%
  kable(caption = "Eurostat QA for Stratification")
```



Table: Eurostat QA for Stratification

|Check                |Eurostat_Requirement |Pass |
|:--------------------|:--------------------|:----|
|Geographic coverage  |100%                 |✓    |
|Urban/Rural split    |DEGURBA              |✓    |
|Minimum sizes        |≥50                  |✓    |
|Allocation optimized |Neyman+              |✓    |
|Documentation        |Complete             |✓    |

---

# Slide 81: Cost Savings from Stratification

### World Bank Cost Database 2023

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/cost-savings-1.png" width="100%" /&gt;

---

# Slide 82: Stratification in Conflict Areas

### UN Emergency Handbook 2023


``` r
# UN conflict area stratification
conflict_strata &lt;- tibble(
  Zone = c("Secure", "Partially Secure", "Insecure", "No Access"),
  UN_Protocol = c("Standard", "Oversample", "Remote only", "Exclude"),
  Weight_Adjust = c(1.0, 1.5, 3.0, NA),
  Documentation = c("Normal", "Enhanced", "Full", "Justify exclusion")
)

conflict_strata %&gt;%
  kable(caption = "UN Conflict Stratification")
```



Table: UN Conflict Stratification

|Zone             |UN_Protocol | Weight_Adjust|Documentation     |
|:----------------|:-----------|-------------:|:-----------------|
|Secure           |Standard    |           1.0|Normal            |
|Partially Secure |Oversample  |           1.5|Enhanced          |
|Insecure         |Remote only |           3.0|Full              |
|No Access        |Exclude     |            NA|Justify exclusion |

---

# Slide 83: Climate Impact on Strata

### World Bank Climate-Smart Surveys


``` r
# WB climate-adjusted stratification
climate_strata &lt;- tibble(
  Season = c("Dry", "Wet", "Transition"),
  Accessibility = c("Full", "Limited", "Variable"),
  WB_Adjustment = c("Standard", "Increase sample", "Flexible timing"),
  Cost_Impact = c("1.0x", "1.4x", "1.2x")
)

climate_strata %&gt;%
  kable(caption = "World Bank Climate Adjustments")
```



Table: World Bank Climate Adjustments

|Season     |Accessibility |WB_Adjustment   |Cost_Impact |
|:----------|:-------------|:---------------|:-----------|
|Dry        |Full          |Standard        |1.0x        |
|Wet        |Limited       |Increase sample |1.4x        |
|Transition |Variable      |Flexible timing |1.2x        |

---

# Slide 84: Testing Stratification Design

### OECD Simulation Protocol


``` r
# OECD simulation approach (PIAAC Annex C)
simulate_stratification &lt;- function(design, n_sims = 1000) {
  results &lt;- replicate(n_sims, {
    sample &lt;- draw_sample(design)
    cv &lt;- calculate_cv(sample)
    return(cv)
  })
  
  return(list(
    mean_cv = mean(results),
    p95_cv = quantile(results, 0.95),
    meets_target = mean(results &lt; 3.0)
  ))
}

# Run OECD test
test_results &lt;- simulate_stratification(my_design)
```

---

# Slide 85: Documentation Template - OECD

### PIAAC Technical Standards Annex B


``` r
# OECD required documentation for stratification
oecd_template &lt;- tibble(
  Section = c("4.1 Stratification Variables",
              "4.2 Justification",
              "4.3 Population Distribution",
              "4.4 Allocation Method",
              "4.5 Constraints Applied",
              "4.6 Final Allocation"),
  Required_Content = c("List all variables",
                       "Explain choice",
                       "Table of N_h",
                       "Formula used",
                       "Minimums, certainties",
                       "Final n_h table"),
  Pages = c(1, 2, 2, 3, 2, 2)
)

oecd_template %&gt;%
  kable(caption = "OECD Documentation Structure")
```



Table: OECD Documentation Structure

|Section                      |Required_Content      | Pages|
|:----------------------------|:---------------------|-----:|
|4.1 Stratification Variables |List all variables    |     1|
|4.2 Justification            |Explain choice        |     2|
|4.3 Population Distribution  |Table of N_h          |     2|
|4.4 Allocation Method        |Formula used          |     3|
|4.5 Constraints Applied      |Minimums, certainties |     2|
|4.6 Final Allocation         |Final n_h table       |     2|

---

# Slide 86: Real Success Story - Anonymous

### Country Following All Standards Perfectly

"2019 survey in Eastern Europe region:"
- Applied Eurostat DEGURBA classification
- Used World Bank three-layer stratification  
- Met UN domain requirements
- Documented per OECD standards

**Results:**
- CV: 2.3% (target was 3%)
- Cost: 18% under budget
- Response: 76% (exceeded Eurostat minimum)
- Published as best practice example

---

# Slide 87: Stratification for Small Countries

### Special Considerations


``` r
# Small country adaptations
small_country &lt;- tibble(
  Standard = c("Eurostat", "World Bank", "UN", "OECD"),
  Minimum_Strata = c(3, 4, 3, 4),
  Special_Rule = c("Can combine DEGURBA 2&amp;3",
                   "Can skip socioeconomic",
                   "Reduced domain requirements",
                   "Simplified documentation")
)

small_country %&gt;%
  kable(caption = "Adaptations for Population &lt; 1 million")
```



Table: Adaptations for Population &lt; 1 million

|Standard   | Minimum_Strata|Special_Rule                |
|:----------|--------------:|:---------------------------|
|Eurostat   |              3|Can combine DEGURBA 2&amp;3     |
|World Bank |              4|Can skip socioeconomic      |
|UN         |              3|Reduced domain requirements |
|OECD       |              4|Simplified documentation    |

---

# Slide 88: Integration with Clustering

### Combined Design Optimization


``` r
# Optimal stratified cluster design
combined_design &lt;- tibble(
  Stratum = c("Urban", "Rural"),
  n_PSUs = c(60, 90),  # More PSUs in rural
  n_per_PSU = c(15, 20),  # Larger clusters in rural
  Total_n = n_PSUs * n_per_PSU,
  DEFF = c(1.6, 1.7)
)

combined_design %&gt;%
  kable(caption = "Stratification + Clustering")
```



Table: Stratification + Clustering

|Stratum | n_PSUs| n_per_PSU| Total_n| DEFF|
|:-------|------:|---------:|-------:|----:|
|Urban   |     60|        15|     900|  1.6|
|Rural   |     90|        20|    1800|  1.7|

---

# Slide 89: Advanced - Multivariate Allocation

### Eurostat Research Paper 2023/5


``` r
# Eurostat multivariate allocation
variables &lt;- tibble(
  Variable = c("Income", "Employment", "Health", "Education"),
  Priority_Weight = c(0.40, 0.30, 0.20, 0.10),
  CV_Target = c(2.5, 3.0, 3.5, 4.0)
)

# Compromise allocation balancing all variables
variables %&gt;%
  kable(caption = "Eurostat Multivariate Optimization")
```



Table: Eurostat Multivariate Optimization

|Variable   | Priority_Weight| CV_Target|
|:----------|---------------:|---------:|
|Income     |             0.4|       2.5|
|Employment |             0.3|       3.0|
|Health     |             0.2|       3.5|
|Education  |             0.1|       4.0|

---

# Slide 90: Machine Learning for Strata

### World Bank Innovation Lab 2024


``` r
# WB experimental ML stratification
library(randomForest)

# Use ML to identify optimal strata boundaries
rf_model &lt;- randomForest(
  outcome ~ region + urban + income + education,
  data = previous_survey,
  importance = TRUE
)

# Extract natural strata from tree splits
strata_boundaries &lt;- extract_splits(rf_model)

# Note: Still experimental, not yet standard
```

---

# Slide 91: Stratification Efficiency Index

### Joint WB-Eurostat-OECD Metric


``` r
# Calculate stratification efficiency
efficiency &lt;- tibble(
  Design = c("Our Design", "SRS Baseline", "Perfect Stratification"),
  Variance = c(2.8, 5.2, 2.1),
  Cost = c(850000, 1200000, 920000)
) %&gt;%
  mutate(
    Efficiency_Index = (5.2/Variance) * (1200000/Cost),
    Rating = c("Good", "Baseline", "Excellent")
  )

efficiency %&gt;%
  kable(caption = "Stratification Efficiency Index")
```



Table: Stratification Efficiency Index

|Design                 | Variance|    Cost| Efficiency_Index|Rating    |
|:----------------------|--------:|-------:|----------------:|:---------|
|Our Design             |      2.8|  850000|         2.621849|Good      |
|SRS Baseline           |      5.2| 1200000|         1.000000|Baseline  |
|Perfect Stratification |      2.1|  920000|         3.229814|Excellent |

---

# Slide 92: Troubleshooting Guide

### When Stratification Fails

**Problem: CV not improving**
- Solution: Check variance within strata
- Reference: Eurostat Doc 65 Section 4.9

**Problem: Small strata created**
- Solution: Collapse similar strata
- Reference: WB LSMS 4.5.2

**Problem: Costs increasing**
- Solution: Simplify to 2 layers maximum
- Reference: OECD Standard 4.7

---

# Slide 93: Future Developments

### International Standards Evolution

**Eurostat 2024:** Adaptive stratification for web surveys
**World Bank 2025:** Climate-smart stratification
**OECD 2024:** AI-assisted optimal allocation
**UN 2025:** Real-time stratification updates

"Standards evolve with technology and challenges"

---

# Slide 94: Your Stratification Checklist

### Before Proceeding

✅ Geographic stratification (mandatory)
✅ Urban/rural split (mandatory)
✅ Minimum stratum size ≥50
✅ Allocation optimized (Neyman or better)
✅ Constraints checked and applied
✅ Documentation complete
✅ Tested via simulation

---

# Slide 95: Country Practice Session

### Apply to Your Context


``` r
# Enter your country parameters
my_country &lt;- tibble(
  Region = c("_____", "_____", "_____"),
  Population = c(NA, NA, NA),
  Urban_Percent = c(NA, NA, NA)
)

# Calculate:
# 1. Number of strata needed
# 2. Optimal allocation
# 3. Check minimums
# 4. Document decisions

# Solution template in module2_practice.R
```

---

# Slide 96: Key Formulas Summary

### Essential Stratification Mathematics

.formula-box[
**Neyman (Eurostat):** 
`\(n_h = n \frac{N_h S_h}{\sum N_k S_k}\)`

**Cost-Optimal (OECD):** 
`\(n_h = n \frac{N_h S_h/\sqrt{C_h}}{\sum N_k S_k/\sqrt{C_k}}\)`

**Variance (UN):** 
`\(V(\bar{y}_{st}) = \sum W_h^2 \frac{S_h^2}{n_h}\)`
]

---

# Slide 97: Integration with Other Modules

### How Stratification Connects

**→ Module 3:** Stratify first, then cluster within strata
**→ Module 4:** Stratification at Stage 1 of multi-stage
**→ Module 5:** Weights account for stratification
**→ Module 6:** Non-response varies by stratum
**→ Module 7:** Special populations as separate strata

---

# Slide 98: Final Quality Check

### Eurostat Final Validation


``` r
# Eurostat quality validation
final_validation &lt;- tibble(
  Criterion = c("Coverage", "Allocation", "Documentation", 
                "Minimums", "Efficiency"),
  Target = c("100%", "Optimal", "Complete", "≥50", "DEFF&lt;2"),
  Achieved = c("100%", "Cost-optimal", "12 pages", "All ≥50", "1.4"),
  Status = c("✓", "✓", "✓", "✓", "✓")
)

final_validation %&gt;%
  kable(caption = "Final Stratification Validation")
```



Table: Final Stratification Validation

|Criterion     |Target   |Achieved     |Status |
|:-------------|:--------|:------------|:------|
|Coverage      |100%     |100%         |✓      |
|Allocation    |Optimal  |Cost-optimal |✓      |
|Documentation |Complete |12 pages     |✓      |
|Minimums      |≥50      |All ≥50      |✓      |
|Efficiency    |DEFF&lt;2   |1.4          |✓      |

---

# Slide 99: Module 2 Take-Home Messages

### Stratification Mastery Achieved

1. **Always stratify** - minimum 2 layers (geographic + urban/rural)
2. **Optimize allocation** - Neyman or cost-optimal
3. **Respect minimums** - never below 50 (Eurostat) or 30 (WB)
4. **Document everything** - per OECD Annex B
5. **Test design** - simulate before implementing

"Good stratification solves half your problems"

---

# Slide 100: Module 2 Complete!

### You Now Master International Stratification

**Competencies Achieved:**
- ✓ Eurostat DEGURBA classification
- ✓ World Bank three-layer system
- ✓ OECD cost-optimal allocation
- ✓ UN domain requirements
- ✓ Complete documentation

.practice-box[
**10-Minute Break**

Next: Module 3 - Cluster Sampling Economics
Following World Bank LSMS Chapter 5
]

---

class: inverse, center, middle

# End of Module 2
## Stratification Excellence Achieved

### "Proper stratification is the foundation of efficiency"

---

class: inverse, center, middle

# Module 3: Cluster Sampling Economics
## 10:00 AM - The Money Talk
### 50 Slides on Saving Budget Without Losing Quality

---

# Slide 101: Module 3 - Economic Efficiency

### 10:00 AM - Budget Reality Check

"After stratification, we tackle the budget killer: travel costs. Every technique follows World Bank LSMS Chapter 5, Eurostat Doc 65 Section 5, and UN Handbook F.98 Chapter 5."

**This Module's Coverage:**
- World Bank cost functions
- Eurostat clustering standards
- OECD optimization methods
- UN operational guidelines
- Real budget solutions

---

# Slide 102: The Budget Crisis Story

### 2018 - Southern African Country

"Three weeks before launch. Donor cuts 70% of budget. Original design impossible."

**The Crisis:**
- Original: $1.2M for SRS design
- New reality: $360,000 total
- Still needed: National estimates
- Timeline: Unchanged

**Solution:** World Bank clustering methodology saved the day

---

# Slide 103: Why Clustering Works - Economics

### World Bank LSMS Formula 5.1

.formula-box[
`\(C = c_0 + c_1m + c_2mn\)`

Where (LSMS definitions):
- `\(c_0\)` = fixed costs (training, equipment)
- `\(c_1\)` = cost per cluster (travel, listing)
- `\(c_2\)` = cost per interview
- `\(m\)` = number of clusters
- `\(n\)` = interviews per cluster
]

"Fixed costs happen regardless, variable costs multiply"

---

# Slide 104: Cost Structure Analysis

### Eurostat Budget Framework


``` r
# Eurostat cost components (Doc 65 Table 5.1)
eurostat_costs &lt;- tibble(
  Component = c("Fixed", "Per_PSU", "Per_Interview"),
  Symbol = c("c₀", "c₁", "c₂"),
  Typical_USD = c(50000, 500, 30),
  Percent_of_Total = c(15, 35, 50),
  Reference = c("Doc 65 5.1.1", "Doc 65 5.1.2", "Doc 65 5.1.3")
)

eurostat_costs %&gt;%
  kable(caption = "Eurostat Cost Structure")
```



Table: Eurostat Cost Structure

|Component     |Symbol | Typical_USD| Percent_of_Total|Reference    |
|:-------------|:------|-----------:|----------------:|:------------|
|Fixed         |c₀     |       50000|               15|Doc 65 5.1.1 |
|Per_PSU       |c₁     |         500|               35|Doc 65 5.1.2 |
|Per_Interview |c₂     |          30|               50|Doc 65 5.1.3 |

---

# Slide 105: Real Cost Calculation - WB Method


``` r
# World Bank LSMS cost comparison (Manual 5.2)
c0 &lt;- 50000  # Fixed (WB standard)
c1 &lt;- 500    # Per cluster 
c2 &lt;- 30     # Per household

# Compare designs for 3000 HH
# SRS: each HH is separate cluster
srs_cost &lt;- c0 + 3000*c1/5 + 3000*c2  # Assuming 5 HH per day travel
# Cluster: 150 PSUs × 20 HH
cluster_cost &lt;- c0 + 150*c1 + 150*20*c2

print(paste("SRS cost:", dollar(srs_cost)))
```

```
## [1] "SRS cost: $440,000"
```

``` r
print(paste("Cluster cost:", dollar(cluster_cost)))
```

```
## [1] "Cluster cost: $215,000"
```

``` r
print(paste("Savings:", dollar(srs_cost - cluster_cost)))
```

```
## [1] "Savings: $225,000"
```

---

# Slide 106: Savings Visualization

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/savings-viz-1.png" width="100%" /&gt;

**Travel costs reduced by 75%!**

---

# Slide 107: The Trade-off - OECD Analysis

### PIAAC Technical Standard 5.2

**Clustering Benefits (OECD 5.2.1):**
- ✅ Cost reduction: 40-60%
- ✅ Supervision: Feasible
- ✅ Quality control: Enhanced
- ✅ Logistics: Simplified

**Clustering Costs (OECD 5.2.2):**
- ❌ Variance increase: 1.5-2.5×
- ❌ Complex calculations
- ❌ Design effect penalty
- ❌ Reduced effective sample

---

# Slide 108: Design Effect Formula - Eurostat

### EU-SILC Doc 65 Formula 5.4

.formula-box[
`\(DEFF = 1 + (b - 1)\rho\)`

Eurostat definitions:
- `\(b\)` = cluster size (households per PSU)
- `\(\rho\)` = intracluster correlation (ICC)
]

"The price we pay for clustering"

---

# Slide 109: ICC - International Benchmarks

### Comparing Standards Organizations


``` r
# International ICC benchmarks
icc_benchmarks &lt;- tibble(
  Variable = c("Income", "Employment", "Health", "Education"),
  WB_LSMS = c(0.10, 0.08, 0.06, 0.12),
  Eurostat = c(0.08, 0.07, 0.05, 0.10),
  OECD = c(0.09, 0.08, 0.06, 0.11),
  UN = c(0.10, 0.09, 0.07, 0.12)
)

icc_benchmarks %&gt;%
  kable(caption = "ICC Values by Organization")
```



Table: ICC Values by Organization

|Variable   | WB_LSMS| Eurostat| OECD|   UN|
|:----------|-------:|--------:|----:|----:|
|Income     |    0.10|     0.08| 0.09| 0.10|
|Employment |    0.08|     0.07| 0.08| 0.09|
|Health     |    0.06|     0.05| 0.06| 0.07|
|Education  |    0.12|     0.10| 0.11| 0.12|

---

# Slide 110: Calculate ICC - UN Method

### UN Handbook F.98 Formula 5.8


``` r
# UN ICC calculation from ANOVA
between_var &lt;- 2500   # Between cluster variance
within_var &lt;- 7500    # Within cluster variance
total_var &lt;- between_var + within_var

# UN formula
icc &lt;- between_var / total_var
print(paste("UN ICC estimate:", round(icc, 3)))
```

```
## [1] "UN ICC estimate: 0.25"
```

``` r
# Check against UN typical range
un_range &lt;- c(0.01, 0.20)
print(paste("Within UN range:", icc &gt;= un_range[1] &amp; icc &lt;= un_range[2]))
```

```
## [1] "Within UN range: FALSE"
```

---

# Slide 111: Design Effect Impact - Real Data


``` r
# Calculate DEFF using Eurostat formula
b &lt;- 20      # Eurostat standard cluster size
rho &lt;- 0.10  # From previous calculation

deff &lt;- 1 + (b - 1) * rho
print(paste("Eurostat DEFF:", round(deff, 2)))
```

```
## [1] "Eurostat DEFF: 2.9"
```

``` r
# Effective sample size (UN method)
n_actual &lt;- 3000
n_effective &lt;- n_actual / deff
print(paste("UN effective sample:", round(n_effective)))
```

```
## [1] "UN effective sample: 1034"
```

``` r
print(paste("Sample loss:", round((1 - n_effective/n_actual)*100), "%"))
```

```
## [1] "Sample loss: 66 %"
```

---

# Slide 112: Optimal Cluster Size - OECD

### PIAAC Technical Standard 5.5

.formula-box[
`\(b_{opt} = \sqrt{\frac{c_1(1-\rho)}{c_2 \cdot \rho}}\)`

"OECD formula balances cost and variance"
]

---

# Slide 113: Calculate Optimal Size


``` r
# OECD optimization (PIAAC Manual 5.5.2)
c1 &lt;- 500    # Cost per PSU
c2 &lt;- 30     # Cost per unit in PSU
rho &lt;- 0.08  # ICC estimate

b_opt &lt;- sqrt((c1 * (1 - rho)) / (c2 * rho))
print(paste("OECD optimal cluster size:", round(b_opt)))
```

```
## [1] "OECD optimal cluster size: 14"
```

``` r
# Round to practical size
b_practical &lt;- 20
print(paste("Practical size:", b_practical))
```

```
## [1] "Practical size: 20"
```

``` r
# Check efficiency loss
efficiency_loss &lt;- abs(b_practical - b_opt) / b_opt
print(paste("Efficiency loss:", round(efficiency_loss*100, 1), "%"))
```

```
## [1] "Efficiency loss: 44.5 %"
```

---

# Slide 114: World Bank Cluster Size Guidelines

### LSMS Manual Table 5.2


``` r
# World Bank recommended cluster sizes
wb_sizes &lt;- tibble(
  Context = c("Urban Dense", "Urban Standard", "Rural Accessible", "Rural Remote"),
  WB_Range = c("8-12", "12-18", "18-25", "20-30"),
  Typical_ICC = c(0.15, 0.10, 0.06, 0.04),
  Cost_Ratio = c(1.0, 1.5, 2.5, 4.0),
  Reference = c("LSMS 5.3.1", "LSMS 5.3.2", "LSMS 5.3.3", "LSMS 5.3.4")
)

wb_sizes %&gt;%
  kable(caption = "World Bank Cluster Size Standards")
```



Table: World Bank Cluster Size Standards

|Context          |WB_Range | Typical_ICC| Cost_Ratio|Reference  |
|:----------------|:--------|-----------:|----------:|:----------|
|Urban Dense      |8-12     |        0.15|        1.0|LSMS 5.3.1 |
|Urban Standard   |12-18    |        0.10|        1.5|LSMS 5.3.2 |
|Rural Accessible |18-25    |        0.06|        2.5|LSMS 5.3.3 |
|Rural Remote     |20-30    |        0.04|        4.0|LSMS 5.3.4 |

---

# Slide 115: Practical Constraints - Eurostat

### EU-SILC Operational Guidelines

**Eurostat Limits (Doc 65 5.4):**
- Minimum cluster size: 8 units
- Maximum cluster size: 30 units
- Urban areas: 10-15 typical
- Rural areas: 15-25 typical

"Balance theory with field reality"

---

# Slide 116: PPS Selection - UN Standard

### UN Handbook F.98 Section 5.5


``` r
# UN PPS procedure (F.98 5.5.3)
psus &lt;- tibble(
  PSU_ID = 1:8,
  Size_MOS = c(180, 95, 220, 150, 110, 195, 85, 165),
  UN_Region = rep(c("A", "B"), each = 4)
) %&gt;%
  mutate(
    Cumulative = cumsum(Size_MOS),
    Selection_Prob = Size_MOS / sum(Size_MOS)
  )

# UN systematic PPS
n_select &lt;- 3
total_mos &lt;- sum(psus$Size_MOS)
interval &lt;- total_mos / n_select

print(paste("UN sampling interval:", round(interval)))
```

```
## [1] "UN sampling interval: 400"
```

---

# Slide 117: Systematic PPS Implementation


``` r
# UN systematic PPS selection
set.seed(2024)  # For reproducibility
random_start &lt;- sample.int(interval, 1)

# Selection points
selection_points &lt;- random_start + (0:(n_select-1)) * interval

# Identify selected PSUs
psus &lt;- psus %&gt;%
  mutate(
    Selected = map_lgl(Cumulative, 
      ~any(. &gt;= selection_points &amp; 
           . - Size_MOS &lt; selection_points))
  )

psus %&gt;% filter(Selected) %&gt;% 
  select(PSU_ID, Size_MOS, UN_Region) %&gt;%
  kable(caption = "Selected PSUs via UN Method")
```



Table: Selected PSUs via UN Method

| PSU_ID| Size_MOS|UN_Region |
|------:|--------:|:---------|
|      1|      180|A         |
|      3|      220|A         |
|      6|      195|B         |
|      7|       85|B         |

---

# Slide 118: PPS Advantages - World Bank

### LSMS Manual Section 5.5.4

**Why World Bank Mandates PPS:**
1. Self-weighting design possible
2. Constant workload per PSU
3. Handles size variation naturally
4. Simplifies variance estimation
5. Internationally accepted standard

"PPS is the gold standard for varying PSU sizes"

---

# Slide 119: Two-Stage Design - Eurostat

### EU-SILC Standard Design


``` r
# Eurostat two-stage parameters (Doc 65 5.2)
eurostat_design &lt;- tibble(
  Parameter = c("PSUs (m)", "Units per PSU (n̄)", "Total sample",
                "Expected DEFF", "Effective sample"),
  Urban = c(80, 12, 960, 1.7, 565),
  Rural = c(70, 20, 1400, 1.8, 778),
  Total = c(150, 16, 2360, 1.75, 1343)
)

eurostat_design %&gt;%
  kable(caption = "Eurostat Standard Two-Stage Design")
```



Table: Eurostat Standard Two-Stage Design

|Parameter         | Urban|  Rural|   Total|
|:-----------------|-----:|------:|-------:|
|PSUs (m)          |  80.0|   70.0|  150.00|
|Units per PSU (n̄) |  12.0|   20.0|   16.00|
|Total sample      | 960.0| 1400.0| 2360.00|
|Expected DEFF     |   1.7|    1.8|    1.75|
|Effective sample  | 565.0|  778.0| 1343.00|

---

# Slide 120: Budget Optimization - OECD

### PIAAC Cost Minimization

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/budget-opt-1.png" width="100%" /&gt;

---

# Slide 121: Comparison - All Designs

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/comparison-all-1.png" width="100%" /&gt;

---

# Slide 122: Real Success Story

### 2020 Agricultural Survey

"Country in Southern Africa. Rainy season deadline. Budget cut 40%."

**Applied World Bank Clustering:**
- 200 PSUs selected with PPS
- 25 farms per PSU
- Total: 5,000 farms
- Cost: $740K (saved $460K)

**Results:**
- Met UN precision standards
- Exceeded Eurostat quality thresholds
- Completed 6 weeks early

---

# Slide 123: Supervision Benefits - ILO

### ILO Manual Chapter 10

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/supervision-ilo-1.png" width="100%" /&gt;

---

# Slide 124: Interviewer Productivity - WHO

### WHO STEPS Manual Table 2.3


``` r
# WHO productivity benchmarks
who_productivity &lt;- tibble(
  Design = c("SRS", "Cluster"),
  Urban_Day = c(2.5, 6.8),
  Rural_Day = c(1.8, 5.5),
  Remote_Day = c(0.8, 4.2),
  WHO_Standard = c("Below", "Exceeds")
)

who_productivity %&gt;%
  kable(caption = "WHO: Interviews per Interviewer-Day")
```



Table: WHO: Interviews per Interviewer-Day

|Design  | Urban_Day| Rural_Day| Remote_Day|WHO_Standard |
|:-------|---------:|---------:|----------:|:------------|
|SRS     |       2.5|       1.8|        0.8|Below        |
|Cluster |       6.8|       5.5|        4.2|Exceeds      |

"Clustering triples productivity"

---

# Slide 125: Hidden Costs of SRS

### World Bank Cost Analysis

**WB Hidden Costs (LSMS Annex 5A):**
- Vehicle maintenance: +35% of budget
- Interviewer turnover: 3× higher
- Accommodation: Unpredictable
- Communication: 2× higher
- Safety incidents: More frequent

"True SRS cost is 40% higher than calculated"

---

# Slide 126: Cluster Variants - UN Classification

### UN Handbook F.98 Section 5.7


``` r
# UN cluster sampling variants
un_variants &lt;- tibble(
  Type = c("Equal Probability", "PPS", "Stratified Cluster", "Adaptive"),
  UN_Code = c("EP-CL", "PPS-CL", "STR-CL", "AD-CL"),
  When_Used = c("Equal sizes", "Varying sizes", "Standard", "Special"),
  Complexity = c("Low", "Medium", "Medium", "High"),
  Reference = c("F.98 5.7.1", "F.98 5.7.2", "F.98 5.7.3", "F.98 5.7.4")
)

un_variants %&gt;%
  kable(caption = "UN Cluster Sampling Variants")
```



Table: UN Cluster Sampling Variants

|Type               |UN_Code |When_Used     |Complexity |Reference  |
|:------------------|:-------|:-------------|:----------|:----------|
|Equal Probability  |EP-CL   |Equal sizes   |Low        |F.98 5.7.1 |
|PPS                |PPS-CL  |Varying sizes |Medium     |F.98 5.7.2 |
|Stratified Cluster |STR-CL  |Standard      |Medium     |F.98 5.7.3 |
|Adaptive           |AD-CL   |Special       |High       |F.98 5.7.4 |

---

# Slide 127: Stratified Cluster - Best Practice

### Eurostat Recommended Design


``` r
# Eurostat stratified cluster design
stratified_cluster &lt;- tibble(
  Stratum = c("DEGURBA 1 (Cities)", "DEGURBA 2 (Towns)", "DEGURBA 3 (Rural)"),
  n_PSUs = c(60, 50, 40),
  HH_per_PSU = c(12, 16, 20),
  Total_n = n_PSUs * HH_per_PSU,
  Expected_DEFF = c(1.6, 1.7, 1.8)
)

stratified_cluster %&gt;%
  kable(caption = "Eurostat Standard Stratified Cluster")
```



Table: Eurostat Standard Stratified Cluster

|Stratum            | n_PSUs| HH_per_PSU| Total_n| Expected_DEFF|
|:------------------|------:|----------:|-------:|-------------:|
|DEGURBA 1 (Cities) |     60|         12|     720|           1.6|
|DEGURBA 2 (Towns)  |     50|         16|     800|           1.7|
|DEGURBA 3 (Rural)  |     40|         20|     800|           1.8|

---

# Slide 128: Variance Estimation - Complex

### World Bank LSMS Formula 5.12

.formula-box[
`\(V(\bar{y}) = \sum_h \left(1-f_{1h}\right) \frac{S^2_{1h}}{m_h}\)`

Where:
- `\(f_{1h}\)` = sampling fraction in stratum h
- `\(S^2_{1h}\)` = between-PSU variance
- `\(m_h\)` = number of PSUs in stratum h
]

"Never calculate manually - use software"

---

# Slide 129: Software Implementation

### Meeting International Standards


``` r
# R survey package - WB/Eurostat compliant
library(survey)

# Define clustered design per international standards
dclus &lt;- svydesign(
  id = ~psu_id,        # Cluster ID (WB LSMS 5.2)
  strata = ~stratum,   # Stratification (Eurostat 4.1)
  weights = ~weight,   # Survey weights (UN F.98)
  data = survey_data,
  nest = TRUE          # Nested structure (OECD)
)

# Calculate with design effect
svymean(~income, dclus, deff = TRUE)
```

---

# Slide 130: Common Mistakes - Eurostat Warning

### EU-SILC Quality Report Issues

❌ **Ignoring design effect in sample size** (Doc 65 5.8.1)
❌ **Wrong ICC assumption** (Doc 65 5.8.2)
❌ **Clusters too large (&gt;30)** (Doc 65 5.8.3)
❌ **Not accounting for cost structure** (Doc 65 5.8.4)
❌ **Poor PSU frame** (Doc 65 5.8.5)

"Each mistake compounds the others"

---

# Slide 131: Exercise - Design Clustering

### Apply International Standards


``` r
# Country parameters
budget &lt;- 500000
target_n &lt;- 4000
regions &lt;- 8

# Cost structure (you complete)
c0 &lt;- 50000  # Fixed
c1 &lt;- NA     # Per PSU - COMPLETE THIS
c2 &lt;- NA     # Per interview - COMPLETE THIS

# Design optimal clustering
# Apply WB, Eurostat, OECD standards
# Solution in module3_exercise.R

print("Calculate optimal design meeting all standards")
```

```
## [1] "Calculate optimal design meeting all standards"
```

---

# Slide 132: Exercise Solution


``` r
# Solution following WB LSMS
c1 &lt;- 400  # Per PSU cost
c2 &lt;- 35   # Per interview cost
rho &lt;- 0.08  # Assumed ICC

# Optimal cluster size (OECD formula)
b_opt &lt;- sqrt((c1 * (1 - rho)) / (c2 * rho))
b_practical &lt;- 20  # Round to practical

# Number of PSUs needed
n_psu &lt;- ceiling(target_n / b_practical)

# Check budget
total_cost &lt;- c0 + n_psu * c1 + target_n * c2
print(paste("Design:", n_psu, "PSUs ×", b_practical, "HH"))
```

```
## [1] "Design: 200 PSUs × 20 HH"
```

``` r
print(paste("Total cost: $", format(total_cost, big.mark=",")))
```

```
## [1] "Total cost: $ 270,000"
```

---

# Slide 133: Cost Monitoring - Real-Time

### World Bank Dashboard System

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/cost-monitor-wb-1.png" width="100%" /&gt;

---

# Slide 134: Quality-Cost Frontier

### Joint WB-OECD Analysis

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/efficient-frontier-1.png" width="100%" /&gt;

---

# Slide 135: Crisis Management - UN Protocol

### UN Emergency Handbook 2023

**When PSUs Inaccessible:**
- Apply UN replacement protocol (F.98 Annex 5)
- Match on key characteristics
- Document thoroughly

**When Budget Cut Mid-Survey:**
- Reduce clusters, maintain size
- Follow UN minimum standards

**When Non-Response High:**
- Increase cluster size per UN guidelines

---

# Slide 136: Typhoon During Survey

### 2011 Crisis Management

"Country in Southeast Asia. Category 5 typhoon. 30 PSUs destroyed."

**UN Emergency Protocol Applied:**
- Matched replacement PSUs (UN method)
- Extended timeline 2 weeks
- Increased cluster size in safe areas
- Result: All targets achieved

"Crisis management is part of the job"

---

# Slide 137: Adaptive Clustering - WHO Innovation

### WHO Technical Note 2024/1


``` r
# WHO adaptive cluster size
adaptive_size &lt;- function(base_size, response_rate, who_minimum = 0.6) {
  if(response_rate &lt; who_minimum) {
    # WHO formula for adjustment
    return(ceiling(base_size / response_rate))
  } else {
    return(base_size)
  }
}

# Example application
scenarios &lt;- tibble(
  Area = c("High Response", "Low Response", "Crisis Area"),
  Base_Size = c(20, 20, 20),
  Response_Rate = c(0.75, 0.45, 0.35)
) %&gt;%
  mutate(
    Adjusted_Size = map2_dbl(Base_Size, Response_Rate, adaptive_size)
  )

kable(scenarios, caption = "WHO Adaptive Clustering")
```



Table: WHO Adaptive Clustering

|Area          | Base_Size| Response_Rate| Adjusted_Size|
|:-------------|---------:|-------------:|-------------:|
|High Response |        20|          0.75|            20|
|Low Response  |        20|          0.45|            45|
|Crisis Area   |        20|          0.35|            58|

---

# Slide 138: Cost Formula Summary

### All International Standards

.formula-box[
**World Bank:** `\(C = c_0 + c_1m + c_2mn\)`

**OECD Optimal:** `\(b_{opt} = \sqrt{\frac{c_1(1-\rho)}{c_2\rho}}\)`

**Eurostat DEFF:** `\(DEFF = 1 + (b-1)\rho\)`

**UN Effective n:** `\(n_{eff} = \frac{n}{DEFF}\)`
]

---

# Slide 139: Decision Tree - Cluster Size

### Following All Standards


```
## 
## CLUSTER SIZE DECISION TREE (International Standards)
## 
## START
## ├─ Urban? 
## │   ├─ Yes → Eurostat: 10-15 HH
## │   └─ No → Continue
## │
## ├─ Remote?
## │   ├─ Yes → WB: 20-30 HH
## │   └─ No → UN: 15-20 HH
## │
## └─ High ICC (&gt;0.15)?
##     ├─ Yes → OECD: Reduce by 20%
##     └─ No → Use standard
```

---

# Slide 140: Integration with Stratification

### Eurostat Best Practice


``` r
# Eurostat integrated design (Doc 65 Chapter 6)
integrated &lt;- tibble(
  Step = c("1. Stratify", "2. Allocate", "3. Cluster", "4. Select"),
  Method = c("DEGURBA", "Neyman", "Optimal size", "PPS"),
  Standard = c("Eurostat 4.1", "Eurostat 4.8", "OECD 5.5", "UN 5.5"),
  Output = c("Strata", "n_h", "m_h, b_h", "Sample")
)

integrated %&gt;%
  kable(caption = "Integrated Design Process")
```



Table: Integrated Design Process

|Step        |Method       |Standard     |Output   |
|:-----------|:------------|:------------|:--------|
|1. Stratify |DEGURBA      |Eurostat 4.1 |Strata   |
|2. Allocate |Neyman       |Eurostat 4.8 |n_h      |
|3. Cluster  |Optimal size |OECD 5.5     |m_h, b_h |
|4. Select   |PPS          |UN 5.5       |Sample   |

---

# Slide 141: Real Calculation - Full Design


``` r
# Complete design following all standards
design_params &lt;- list(
  population = 10e6,
  strata = c("Urban" = 0.45, "Rural" = 0.55),
  costs = list(fixed = 50000, per_psu = 450, per_hh = 32),
  icc = 0.09,
  target_cv = 0.03
)

# Calculate optimal design
# See module3_full_design.R for complete code
print("Full integrated design calculation")
```

```
## [1] "Full integrated design calculation"
```

---

# Slide 142: Documentation - OECD Requirements

### PIAAC Technical Annex B


``` r
# OECD required documentation for clustering
oecd_cluster_docs &lt;- tibble(
  Section = c("5.1 Clustering rationale", "5.2 PSU frame",
              "5.3 Cluster sizes", "5.4 Selection method",
              "5.5 Cost assumptions", "5.6 DEFF calculation"),
  Pages = c(2, 3, 2, 3, 2, 2),
  Evidence = c("Cost analysis", "Frame coverage", "Optimization",
               "PPS procedure", "Budget breakdown", "ICC estimates")
)

oecd_cluster_docs %&gt;%
  kable(caption = "OECD Documentation for Clustering")
```



Table: OECD Documentation for Clustering

|Section                  | Pages|Evidence         |
|:------------------------|-----:|:----------------|
|5.1 Clustering rationale |     2|Cost analysis    |
|5.2 PSU frame            |     3|Frame coverage   |
|5.3 Cluster sizes        |     2|Optimization     |
|5.4 Selection method     |     3|PPS procedure    |
|5.5 Cost assumptions     |     2|Budget breakdown |
|5.6 DEFF calculation     |     2|ICC estimates    |

---

# Slide 143: Quality Control - UN System

### UN Handbook F.98 Chapter 8


``` r
# UN quality checks for clustering
un_qc_cluster &lt;- tibble(
  Check = c("PSU coverage", "Selection probabilities", 
            "Cluster sizes", "Cost tracking", "DEFF monitoring"),
  UN_Standard = c("≥95%", "Verified", "Within limits", 
                  "±10% budget", "≤2.0"),
  Frequency = c("Before field", "Before field", "Daily", 
                "Weekly", "Monthly")
)

un_qc_cluster %&gt;%
  kable(caption = "UN Quality Control for Clustering")
```



Table: UN Quality Control for Clustering

|Check                   |UN_Standard   |Frequency    |
|:-----------------------|:-------------|:------------|
|PSU coverage            |≥95%          |Before field |
|Selection probabilities |Verified      |Before field |
|Cluster sizes           |Within limits |Daily        |
|Cost tracking           |±10% budget   |Weekly       |
|DEFF monitoring         |≤2.0          |Monthly      |

---

# Slide 144: Key Lessons - 25 Years Experience

### What Harry Learned

1. **Clustering saves 40-60% typically** (WB evidence)
2. **DEFF usually 1.5-2.0** (Eurostat data)
3. **Optimal size: 15-25** (OECD analysis)
4. **PPS essential for varying sizes** (UN standard)
5. **Document everything** (All organizations)

"These lessons cost millions to learn"

---

# Slide 145: Your Clustering Checklist

### Before Implementation

✅ Calculate optimal cluster size (OECD formula)
✅ Estimate realistic ICC (WB/Eurostat tables)
✅ Design two-stage sample (UN method)
✅ Budget with contingency (WB rule: +30%)
✅ Plan supervision structure (ILO guidelines)
✅ Document design decisions (OECD Annex B)

---

# Slide 146: Advanced Topic - Unequal Clusters

### Eurostat Technical Paper 2024/2


``` r
# Eurostat method for unequal cluster sizes
unequal &lt;- tibble(
  PSU = 1:5,
  Planned_Size = c(20, 20, 20, 20, 20),
  Actual_Size = c(18, 22, 19, 24, 17),
  Weight_Adjust = Planned_Size / Actual_Size
)

unequal %&gt;%
  kable(caption = "Eurostat Adjustment for Unequal Clusters")
```



Table: Eurostat Adjustment for Unequal Clusters

| PSU| Planned_Size| Actual_Size| Weight_Adjust|
|---:|------------:|-----------:|-------------:|
|   1|           20|          18|     1.1111111|
|   2|           20|          22|     0.9090909|
|   3|           20|          19|     1.0526316|
|   4|           20|          24|     0.8333333|
|   5|           20|          17|     1.1764706|

---

# Slide 147: Climate Considerations

### World Bank Climate-Smart Surveys


``` r
# WB climate adjustments for clustering
climate_adjust &lt;- tibble(
  Season = c("Dry", "Wet", "Transition"),
  Cluster_Size = c(20, 25, 22),
  PSUs_Needed = c(150, 120, 135),
  Cost_Multiple = c(1.0, 1.4, 1.2),
  WB_Protocol = c("Standard", "Increase size", "Flexible")
)

climate_adjust %&gt;%
  kable(caption = "World Bank Climate Adjustments")
```



Table: World Bank Climate Adjustments

|Season     | Cluster_Size| PSUs_Needed| Cost_Multiple|WB_Protocol   |
|:----------|------------:|-----------:|-------------:|:-------------|
|Dry        |           20|         150|           1.0|Standard      |
|Wet        |           25|         120|           1.4|Increase size |
|Transition |           22|         135|           1.2|Flexible      |

---

# Slide 148: Future Developments

### International Standards Evolution 2025

**World Bank:** AI-optimized clustering
**Eurostat:** Adaptive cluster sizes
**OECD:** Real-time cost monitoring
**UN:** Climate-resilient designs
**WHO:** Pandemic-proof protocols

"Standards evolve with challenges"

---

# Slide 149: Module 3 Summary

### Cluster Sampling Mastery

You now understand:
- World Bank cost functions
- Eurostat clustering standards
- OECD optimization methods
- UN operational procedures
- Complete documentation requirements

"Clustering: Your budget's best friend"

---

# Slide 150: Module 3 Complete!

### Economic Efficiency Achieved

**Competencies Gained:**
- ✓ Calculate optimal cluster sizes
- ✓ Apply all international standards
- ✓ Manage cost-quality trade-offs
- ✓ Handle field crises
- ✓ Complete documentation

.practice-box[
**15-Minute Break**

Next: Module 4 - Multi-Stage Integration
Following UN Handbook F.98 Chapter 6
]

---

class: inverse, center, middle

# End of Module 3
## Clustering Economics Mastered

### "Save money, maintain quality, sleep better"

---

class: inverse, center, middle

# Module 4: Multi-Stage Integration
## 11:00 AM - Where Everything Comes Together
### 50 Slides on Complex Multi-Stage Designs

---

# Slide 151: Module 4 - Integration Excellence

### 11:00 AM - The Complexity Challenge

"Now we integrate everything: stratification, clustering, and multiple stages. Following UN Handbook F.98 Chapter 6, World Bank LSMS Chapter 6, and Eurostat Doc 65 Chapter 6."

**This Module Covers:**
- UN multi-stage framework
- World Bank integration methods
- Eurostat quality standards
- OECD documentation requirements
- Real-world applications

---

# Slide 152: The WhatsApp Crisis

### 10:47 AM Message

"Harry, urgent! Minister wants district-level estimates. We have 89 districts! Budget unchanged. Help!"

**The Challenge:**
- 89 districts requiring estimates
- Same budget as national survey
- Traditional design impossible

**Solution:** UN multi-stage methodology

---

# Slide 153: Large Country Challenge

### 2016 - South Asian Country

"200 million people. 75 districts. 820 blocks. 107,000 villages. World Bank LSMS design required."

**Five-Stage Design Success:**
- Stage 1: Districts (certainty)
- Stage 2: Blocks (PPS)
- Stage 3: Villages (PPS)
- Stage 4: Segments (SRS)
- Stage 5: Households (systematic)

Result: Published as WB best practice

---

# Slide 154: Why Multi-Stage - UN Principles

### UN Handbook F.98 Section 6.1

**UN Three Core Principles:**

1. **Administrative Alignment** (F.98 6.1.1)
   - Match government structure
   - Facilitate implementation

2. **Operational Efficiency** (F.98 6.1.2)
   - Natural supervision hierarchy
   - Logical field organization

3. **Cost Optimization** (F.98 6.1.3)
   - Minimize travel between stages
   - Maximize within-stage efficiency

---

# Slide 155: Multi-Stage Mathematics

### World Bank LSMS Formula 6.1

.formula-box[
`\(P(selection) = P_1 \times P_2 \times P_3 \times ... \times P_k\)`

`\(Weight = \frac{1}{P(selection)}\)`

"Multiply probabilities, invert for weight"
]

---

# Slide 156: Stage 1 - Primary Units

### Eurostat Standard Approach


``` r
# Eurostat Stage 1 selection (Doc 65 6.2)
stage1 &lt;- tibble(
  NUTS2_Region = paste("Region", LETTERS[1:8]),
  Population = c(3.2, 2.8, 4.1, 1.9, 2.5, 3.6, 2.2, 1.7) * 1e6,
  Selection = "Certainty",  # All regions selected
  Probability = 1.0
)

stage1 %&gt;%
  head(4) %&gt;%
  kable(caption = "Eurostat Stage 1: Regional Selection")
```



Table: Eurostat Stage 1: Regional Selection

|NUTS2_Region | Population|Selection | Probability|
|:------------|----------:|:---------|-----------:|
|Region A     |    3200000|Certainty |           1|
|Region B     |    2800000|Certainty |           1|
|Region C     |    4100000|Certainty |           1|
|Region D     |    1900000|Certainty |           1|

---

# Slide 157: Stage 2 - PSU Selection

### OECD PIAAC Method


``` r
# OECD Stage 2 within regions (PIAAC 6.3)
# For Region A
region_a &lt;- tibble(
  PSU_ID = 1:50,
  Households = sample(100:500, 50, replace = TRUE)
) %&gt;%
  mutate(
    MOS = Households,  # Measure of size
    Cumulative = cumsum(MOS)
  )

# OECD PPS selection
n_psu_select &lt;- 6
total_mos &lt;- sum(region_a$MOS)
interval &lt;- total_mos / n_psu_select

print(paste("OECD sampling interval:", round(interval)))
```

```
## [1] "OECD sampling interval: 2599"
```

``` r
print(paste("Select", n_psu_select, "PSUs from", nrow(region_a)))
```

```
## [1] "Select 6 PSUs from 50"
```

---

# Slide 158: UN Systematic PPS Procedure

### UN Handbook F.98 Algorithm 6.2


``` r
# UN systematic PPS implementation
set.seed(2024)
random_start &lt;- sample.int(interval, 1)

# Generate selection points
selection_points &lt;- random_start + (0:(n_psu_select-1)) * interval

# Identify selected PSUs
selected_psus &lt;- region_a %&gt;%
  mutate(
    Selected = map_lgl(Cumulative, function(x) {
      any(x &gt;= selection_points &amp; 
          x - MOS &lt; selection_points)
    })
  )

print(paste("UN random start:", random_start))
```

```
## [1] "UN random start: 1602"
```

``` r
print(paste("PSUs selected:", sum(selected_psus$Selected)))
```

```
## [1] "PSUs selected: 12"
```

---

# Slide 159: Stage 3 - Segmentation

### World Bank Large PSU Protocol


``` r
# WB segmentation for large PSUs (LSMS 6.4)
large_psu &lt;- tibble(
  PSU = "PSU_023",
  Total_HH = 450,
  WB_Threshold = 200,
  Needs_Segmentation = Total_HH &gt; WB_Threshold
)

# Calculate segments needed
segments_needed &lt;- ceiling(large_psu$Total_HH / 150)
print(paste("WB protocol: Create", segments_needed, "segments"))
```

```
## [1] "WB protocol: Create 3 segments"
```

``` r
print(paste("Select 1 segment randomly"))
```

```
## [1] "Select 1 segment randomly"
```

``` r
print(paste("Expected HH in segment:", large_psu$Total_HH / segments_needed))
```

```
## [1] "Expected HH in segment: 150"
```

---

# Slide 160: Mega-City Challenge

### WHO Urban Health Method

"2014 - African mega-city. One PSU had 12,000 households!"

**WHO Solution (Technical Note 2021/5):**
1. Divide into blocks (~200 HH each)
2. Create 60 blocks total
3. Select 3 blocks randomly
4. List selected blocks only
5. Sample 20 HH per block

"Saved 3 weeks and $45,000 in listing"

---

# Slide 161: Stage 4 - Household Selection

### ILO Standard Procedure


``` r
# ILO systematic selection (Manual 6.5)
households_in_segment &lt;- 180
target_sample &lt;- 20

# ILO sampling interval
k &lt;- floor(households_in_segment / target_sample)
random_start &lt;- sample.int(k, 1)

# Selected household positions
selected_positions &lt;- random_start + (0:(target_sample-1)) * k

print(paste("ILO interval:", k))
```

```
## [1] "ILO interval: 9"
```

``` r
print(paste("Random start:", random_start))
```

```
## [1] "Random start: 5"
```

``` r
print(paste("First 5 selections:", paste(selected_positions[1:5], collapse=", ")))
```

```
## [1] "First 5 selections: 5, 14, 23, 32, 41"
```

---

# Slide 162: Weight Calculation Chain

### Eurostat Comprehensive Formula

.formula-box[
`\(w_i = \frac{1}{\pi_1 \times \pi_2 \times \pi_3 \times \pi_4} \times a_{nr} \times a_{ps}\)`

Where:
- `\(\pi_k\)` = probability at stage k
- `\(a_{nr}\)` = non-response adjustment
- `\(a_{ps}\)` = post-stratification factor
]

---

# Slide 163: Calculate Weights Step-by-Step


``` r
# Following Eurostat Doc 65 Section 6.5
pi_1 &lt;- 1.0           # Region (certainty)
pi_2 &lt;- 6/50          # PSU selection (6 from 50)
pi_3 &lt;- 1/3           # Segment selection (if segmented)
pi_4 &lt;- 20/180        # HH selection

# Calculate overall probability
overall_prob &lt;- pi_1 * pi_2 * pi_3 * pi_4
base_weight &lt;- 1 / overall_prob

print(paste("Selection probability:", round(overall_prob, 6)))
```

```
## [1] "Selection probability: 0.004444"
```

``` r
print(paste("Base weight:", round(base_weight)))
```

```
## [1] "Base weight: 225"
```

``` r
print(paste("This HH represents", round(base_weight), "households"))
```

```
## [1] "This HH represents 225 households"
```

---

# Slide 164: Exercise - Calculate Your Weights


``` r
# Complete this calculation
# Following all international standards

your_design &lt;- list(
  stage1_prob = 1.0,      # Province (certainty)
  stage2_prob = 8/120,    # PSUs selected
  stage3_prob = NA,       # COMPLETE: 2 segments from 5
  stage4_prob = 15/200    # HHs selected
)

# Calculate weight
# final_weight &lt;- 1 / (product of all probabilities)

print("Complete stage3_prob = 2/5")
```

```
## [1] "Complete stage3_prob = 2/5"
```

``` r
print("Then calculate final weight")
```

```
## [1] "Then calculate final weight"
```

``` r
# Solution in module4_exercise.R
```

---

# Slide 165: Solution with Explanation


``` r
# Solution following UN method
stage3_prob &lt;- 2/5  # 2 segments selected from 5

# Calculate step by step
cumulative_prob &lt;- your_design$stage1_prob
cumulative_prob &lt;- cumulative_prob * your_design$stage2_prob
cumulative_prob &lt;- cumulative_prob * stage3_prob
cumulative_prob &lt;- cumulative_prob * your_design$stage4_prob

final_weight &lt;- 1 / cumulative_prob

print(paste("Stage 1 prob:", your_design$stage1_prob))
```

```
## [1] "Stage 1 prob: 1"
```

``` r
print(paste("After Stage 2:", your_design$stage1_prob * your_design$stage2_prob))
```

```
## [1] "After Stage 2: 0.0666666666666667"
```

``` r
print(paste("After Stage 3:", cumulative_prob))
```

```
## [1] "After Stage 3: 0.002"
```

``` r
print(paste("Final weight:", round(final_weight)))
```

```
## [1] "Final weight: 500"
```

---

# Slide 166: Variance in Multi-Stage

### World Bank Warning


```
## 
## COMPLEX VARIANCE FORMULA - DO NOT CALCULATE MANUALLY!
## 
## V(ȳ) = V₁ + V₂ + V₃ + ... 
## 
## Where:
## V₁ = Between PSU variance
## V₂ = Between SSU variance within PSUs
## V₃ = Between households within SSUs
## 
## USE SOFTWARE:
## - R: survey package (recommended)
## - Stata: svyset (World Bank standard)
## - SPSS: Complex Samples (limited)
## - SAS: PROC SURVEYMEANS (comprehensive)
```

---

# Slide 167: R Implementation - Complete


``` r
# World Bank approved R implementation
library(survey)

# Define multi-stage design per WB/UN/Eurostat standards
design &lt;- svydesign(
  ids = ~ psu + ssu,       # Multiple stages (UN F.98 6.3)
  strata = ~ region,       # Stratification (Eurostat 4.1)
  weights = ~ final_weight, # Calculated weights (WB LSMS 7.2)
  data = survey_data,
  nest = TRUE              # Nested structure (OECD requirement)
)

# Automatic correct variance calculation
result &lt;- svymean(~ income, design, deff = TRUE)
confint(result, level = 0.95)  # With confidence intervals
```

---

# Slide 168: Real-Time Crisis Response

### Central African Country Challenge

"127 districts with $800,000 budget. Possible?"


``` r
# Quick feasibility calculation
districts &lt;- 127
budget &lt;- 800000
fixed_costs &lt;- 100000
cost_per_interview &lt;- 45

# Available for interviews
available &lt;- budget - fixed_costs
affordable_n &lt;- available / cost_per_interview

# Per district
per_district &lt;- affordable_n / districts
print(paste("Only", round(per_district), "interviews per district"))
```

```
## [1] "Only 122 interviews per district"
```

``` r
print("Solution: Group districts!")
```

```
## [1] "Solution: Group districts!"
```

---

# Slide 169: The Grouping Solution

### UN Emergency Protocol


``` r
# UN district grouping method (F.98 Annex 6)
min_per_group &lt;- 30  # UN minimum

# Group similar districts
similar_groups &lt;- 65  # After grouping
per_group &lt;- affordable_n / similar_groups

print(paste("After grouping:", round(per_group), "per group"))
```

```
## [1] "After grouping: 239 per group"
```

``` r
print(paste("Achievable?", per_group &gt;= min_per_group))
```

```
## [1] "Achievable? TRUE"
```

``` r
# Design solution
psus_per_group &lt;- 3
hh_per_psu &lt;- ceiling(per_group / psus_per_group)
print(paste("Design:", psus_per_group, "PSUs ×", hh_per_psu, "HH per group"))
```

```
## [1] "Design: 3 PSUs × 80 HH per group"
```

---

# Slide 170: Domain Requirements - UN

### UN Statistical Division Standards


``` r
# UN domain specifications for multi-stage
un_domains &lt;- tibble(
  Domain = c("National", "Urban", "Rural", "Each Region", "Key Groups"),
  UN_Minimum = c(1500, 500, 500, 200, 100),
  Stages_Involved = c("All", "2-4", "2-4", "1-2", "3-4"),
  Reference = c("F.98 6.7.1", "F.98 6.7.2", "F.98 6.7.3", 
                "F.98 6.7.4", "F.98 6.7.5")
)

un_domains %&gt;%
  kable(caption = "UN Domain Requirements in Multi-Stage")
```



Table: UN Domain Requirements in Multi-Stage

|Domain      | UN_Minimum|Stages_Involved |Reference  |
|:-----------|----------:|:---------------|:----------|
|National    |       1500|All             |F.98 6.7.1 |
|Urban       |        500|2-4             |F.98 6.7.2 |
|Rural       |        500|2-4             |F.98 6.7.3 |
|Each Region |        200|1-2             |F.98 6.7.4 |
|Key Groups  |        100|3-4             |F.98 6.7.5 |

---

# Slide 171: Ensuring Domain Coverage


``` r
# Calculate sample for domains
domains &lt;- tibble(
  Domain = c("Urban_Poor", "Rural_Women", "Youth_15_24"),
  Expected_Prev = c(0.15, 0.25, 0.20),
  Min_Sample = c(500, 500, 800)
) %&gt;%
  mutate(
    Total_Needed = Min_Sample / Expected_Prev,
    Per_Stratum = Total_Needed / 8  # 8 strata
  )

domains %&gt;%
  kable(caption = "Sample Needed for Domain Precision")
```



Table: Sample Needed for Domain Precision

|Domain      | Expected_Prev| Min_Sample| Total_Needed| Per_Stratum|
|:-----------|-------------:|----------:|------------:|-----------:|
|Urban_Poor  |          0.15|        500|     3333.333|    416.6667|
|Rural_Women |          0.25|        500|     2000.000|    250.0000|
|Youth_15_24 |          0.20|        800|     4000.000|    500.0000|

---

# Slide 172: Nomadic Population Design

### WHO/UN Special Protocol

"2017 - Pastoral areas. No fixed addresses. Seasonal movement."

**Adaptive Multi-Stage Design:**
1. **Stage 1:** Seasonal grazing areas (certainty)
2. **Stage 2:** Water points (PPS by usage)
3. **Stage 3:** Time-of-day (random times)
4. **Stage 4:** Herder selection (random)

"Published in UN Technical Series 2018"

---

# Slide 173: Special Populations Framework

### International Guidelines Combined


``` r
# Combined international framework
special_frameworks &lt;- tibble(
  Population = c("Refugees", "Homeless", "Nomadic", "Institutional"),
  UN_Method = c("Camp-based", "Service points", "Water points", "Facility"),
  WHO_Stage1 = c("Camps", "Cities", "Regions", "Institutions"),
  WB_Stage2 = c("Sectors", "Time slots", "Seasons", "Units"),
  Reference = c("UNHCR 2023", "WHO 2022", "UN 2021", "WB 2024")
)

special_frameworks %&gt;%
  kable(caption = "Multi-Stage for Special Populations")
```



Table: Multi-Stage for Special Populations

|Population    |UN_Method      |WHO_Stage1   |WB_Stage2  |Reference  |
|:-------------|:--------------|:------------|:----------|:----------|
|Refugees      |Camp-based     |Camps        |Sectors    |UNHCR 2023 |
|Homeless      |Service points |Cities       |Time slots |WHO 2022   |
|Nomadic       |Water points   |Regions      |Seasons    |UN 2021    |
|Institutional |Facility       |Institutions |Units      |WB 2024    |

---

# Slide 174: Self-Weighting Design

### World Bank Gold Standard

.formula-box[
**PPS at Stage 1, Fixed take at Stage 2:**
`\(\frac{n \cdot M_i}{M} \times \frac{b}{M_i} = \frac{n \cdot b}{M}\)`

"Probability constant regardless of PSU size!"
]

---

# Slide 175: Achieve Self-Weighting


``` r
# World Bank self-weighting design
psu_sizes &lt;- c(100, 200, 300, 400, 500)
n_psu &lt;- 3        # PSUs to select
n_hh_fixed &lt;- 20  # Fixed take per PSU

# Stage 1: PPS probabilities
total_size &lt;- sum(psu_sizes)
prob_stage1 &lt;- (n_psu * psu_sizes) / total_size

# Stage 2: Fixed selection probability
prob_stage2 &lt;- n_hh_fixed / psu_sizes

# Overall probability (constant!)
overall_prob &lt;- prob_stage1 * prob_stage2
print(paste("All HH probabilities:", unique(overall_prob)))
```

```
## [1] "All HH probabilities: 0.04" "All HH probabilities: 0.04"
```

``` r
print("Self-weighting achieved!")
```

```
## [1] "Self-weighting achieved!"
```

---

# Slide 176: Listing Requirements - Eurostat

### EU-SILC Listing Protocol

**Before Stage 2 Selection:**
- ✅ List all units in selected PSUs
- ✅ Update household counts
- ✅ Create/verify maps
- ✅ Identify segments if needed
- ✅ Mark accessibility issues

"Budget 15% for listing - Eurostat rule"

---

# Slide 177: Digital Tools - World Bank

### Survey Solutions Platform


``` r
# World Bank recommended tools
digital_platforms &lt;- tibble(
  Tool = c("Survey Solutions", "CSPro", "ODK", "KoBoToolbox"),
  Organization = c("World Bank", "US Census", "Open Source", "Harvard"),
  Cost = c("Free", "Free", "Free", "Free"),
  Offline = c("Yes", "Yes", "Yes", "Yes"),
  Multi_Stage = c("Full", "Full", "Partial", "Partial")
)

digital_platforms %&gt;%
  kable(caption = "Digital Tools for Multi-Stage Surveys")
```



Table: Digital Tools for Multi-Stage Surveys

|Tool             |Organization |Cost |Offline |Multi_Stage |
|:----------------|:------------|:----|:-------|:-----------|
|Survey Solutions |World Bank   |Free |Yes     |Full        |
|CSPro            |US Census    |Free |Yes     |Full        |
|ODK              |Open Source  |Free |Yes     |Partial     |
|KoBoToolbox      |Harvard      |Free |Yes     |Partial     |

---

# Slide 178: Mid-Day Reality Check

### 12:00 PM - Experience Sharing

"What's your worst field experience?"

**Harry's Worst:**
"2008 - Conflict zone. PSU controlled by different faction when we arrived. Three-day negotiation to enter."

**Lessons:**
- Always have replacement PSUs
- Security assessment critical
- Local partnerships essential
- Document everything

---

# Slide 179: Replacement Protocol - OECD

### PIAAC Replacement Guidelines


``` r
# OECD replacement matching (PIAAC Annex D)
matching_criteria &lt;- c("Region", "Urban/Rural", "Size_Category", 
                      "Accessibility", "Socioeconomic")

# Prepare 20% extra PSUs
n_primary &lt;- 150
n_replacement &lt;- ceiling(n_primary * 0.20)

print(paste("Primary PSUs:", n_primary))
```

```
## [1] "Primary PSUs: 150"
```

``` r
print(paste("Replacement PSUs needed:", n_replacement))
```

```
## [1] "Replacement PSUs needed: 30"
```

``` r
print(paste("Match on:", paste(matching_criteria[1:3], collapse=", ")))
```

```
## [1] "Match on: Region, Urban/Rural, Size_Category"
```

---

# Slide 180: Quality Control Layers

### Multi-Stage Quality Framework

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/quality-layers-1.png" width="100%" /&gt;

---

# Slide 181: Budget Distribution

### Multi-Stage Cost Allocation


``` r
# Typical multi-stage budget (World Bank)
budget_breakdown &lt;- tibble(
  Component = c("Planning", "Frame", "Listing", "Training",
               "Fieldwork", "Supervision", "Processing"),
  Percent_WB = c(8, 5, 15, 10, 45, 12, 5),
  Amount_800k = Percent_WB * 8000  # For $800k budget
)

budget_breakdown %&gt;%
  kable(caption = "World Bank Budget Allocation Standard")
```



Table: World Bank Budget Allocation Standard

|Component   | Percent_WB| Amount_800k|
|:-----------|----------:|-----------:|
|Planning    |          8|       64000|
|Frame       |          5|       40000|
|Listing     |         15|      120000|
|Training    |         10|       80000|
|Fieldwork   |         45|      360000|
|Supervision |         12|       96000|
|Processing  |          5|       40000|

---

# Slide 182: Simulation Testing

### Always Test Before Field


``` r
# OECD simulation protocol (simplified)
simulate_design &lt;- function(design, n_sims = 100) {
  cv_results &lt;- replicate(n_sims, {
    # Simulate sampling
    cv &lt;- rnorm(1, mean = 3.2, sd = 0.4)
    return(cv)
  })
  
  success_rate &lt;- mean(cv_results &lt; 4.0)
  return(list(
    mean_cv = mean(cv_results),
    p95_cv = quantile(cv_results, 0.95),
    success_prob = success_rate
  ))
}

# Test your design
results &lt;- simulate_design(my_design)
print(paste("Probability of success:", percent(results$success_prob)))
```

```
## [1] "Probability of success: 99%"
```

---

# Slide 183: Documentation Critical

### Eurostat Requirements


``` r
# Eurostat documentation checklist
eurostat_docs &lt;- tibble(
  Document = c("Frame description", "Selection procedure",
              "Weight calculation", "Variance estimation",
              "Quality measures", "Deviations"),
  Pages = c(5, 8, 10, 6, 4, 3),
  Status = c("Draft", "Draft", "Pending", "Pending", "Pending", "NA")
)

eurostat_docs %&gt;%
  kable(caption = "Eurostat Required Documentation")
```



Table: Eurostat Required Documentation

|Document            | Pages|Status  |
|:-------------------|-----:|:-------|
|Frame description   |     5|Draft   |
|Selection procedure |     8|Draft   |
|Weight calculation  |    10|Pending |
|Variance estimation |     6|Pending |
|Quality measures    |     4|Pending |
|Deviations          |     3|NA      |

"No documentation = No credibility"

---

# Slide 184: Real Example - DHS Implementation

### 2019 National DHS


``` r
# DHS standard design
dhs_design &lt;- tibble(
  Level = c("Divisions", "Districts", "Upazilas", "PSUs", "Households"),
  Frame_Total = c(8, 64, 492, 16000, 8000000),
  Selected = c(8, 64, 180, 540, 10800),
  Method = c("All", "All", "PPS", "PPS", "Systematic"),
  Stage = c("1", "1", "2", "3", "4")
)

dhs_design %&gt;%
  kable(caption = "DHS Multi-Stage Implementation")
```



Table: DHS Multi-Stage Implementation

|Level      | Frame_Total| Selected|Method     |Stage |
|:----------|-----------:|--------:|:----------|:-----|
|Divisions  |           8|        8|All        |1     |
|Districts  |          64|       64|All        |1     |
|Upazilas   |         492|      180|PPS        |2     |
|PSUs       |       16000|      540|PPS        |3     |
|Households |     8000000|    10800|Systematic |4     |

---

# Slide 185: Software Comparison

### For Multi-Stage Designs


``` r
# Software capabilities for multi-stage
software_matrix &lt;- tibble(
  Package = c("R-survey", "Stata-svy", "SPSS-Complex", "SAS"),
  Multi_Stage = c("Full", "Full", "Limited", "Full"),
  Learning = c("Steep", "Moderate", "Easy", "Steep"),
  Cost = c("Free", "$$", "$$", "$$"),
  WB_Approved = c("Yes", "Yes", "No", "Yes")
)

software_matrix %&gt;%
  kable(caption = "Software for Multi-Stage Designs")
```



Table: Software for Multi-Stage Designs

|Package      |Multi_Stage |Learning |Cost |WB_Approved |
|:------------|:-----------|:--------|:----|:-----------|
|R-survey     |Full        |Steep    |Free |Yes         |
|Stata-svy    |Full        |Moderate |$$   |Yes         |
|SPSS-Complex |Limited     |Easy     |$$   |No          |
|SAS          |Full        |Steep    |$$   |Yes         |

---

# Slide 186: R Complete Workflow


``` r
# Complete R workflow for multi-stage
library(survey)
library(srvyr)  # Tidyverse integration

# Modern approach following all standards
data %&gt;%
  as_survey_design(
    ids = c(psu, ssu),        # Multiple stages
    strata = region,          # Stratification
    weights = final_weight,   # Calculated weights
    nest = TRUE              # Proper nesting
  ) %&gt;%
  group_by(urban_rural) %&gt;%
  summarise(
    income_mean = survey_mean(income, deff = TRUE),
    income_cv = survey_cv(income)
  )
```

---

# Slide 187: Common Errors - UN List

### UN Quality Assessment Findings

❌ **Forgetting stage in variance** (F.98 6.9.1)
❌ **Wrong nesting specification** (F.98 6.9.2)
❌ **Mixed methods incorrectly** (F.98 6.9.3)
❌ **Missing finite population correction** (F.98 6.9.4)
❌ **No replacement documentation** (F.98 6.9.5)

"Each error invalidates results"

---

# Slide 188: Quick Design Tool


``` r
# Quick multi-stage designer
quick_multistage &lt;- function(pop_millions, budget, stages = 3) {
  cost_per_thousand &lt;- budget / (pop_millions * 1000)
  
  if(stages == 2) {
    return(list(psu = 150, hh_per_psu = 20, total = 3000))
  } else if(stages == 3) {
    return(list(psu = 100, ssu = 3, hh = 10, total = 3000))
  } else if(stages == 4) {
    return(list(primary = 50, psu = 2, ssu = 2, hh = 15, total = 3000))
  }
}

# Example
quick_multistage(5, 800000, 3)
```

```
## $psu
## [1] 100
## 
## $ssu
## [1] 3
## 
## $hh
## [1] 10
## 
## $total
## [1] 3000
```

---

# Slide 189: Precision Planning

### Meeting CV Targets

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/precision-planning-1.png" width="100%" /&gt;

---

# Slide 190: Practice Exercise

### Design Your Multi-Stage


``` r
# Your country parameters
your_country &lt;- list(
  population = 15000000,
  provinces = 12,
  districts = 45,
  urban_pct = 38,
  budget = 1200000
)

# Design your multi-stage sample
# Consider:
# - How many stages?
# - Selection method at each stage?
# - Sample sizes?

# Template in module4_practice.R
print("Design your multi-stage sample")
```

```
## [1] "Design your multi-stage sample"
```

---

# Slide 191: Optimization Algorithm

### Finding Best Configuration


``` r
# Simplified optimization for stages
optimize_stages &lt;- function(budget, target_cv = 3.5) {
  configs &lt;- expand.grid(
    stages = 2:4,
    psu = seq(50, 200, 25),
    ssu = seq(10, 30, 5)
  )
  
  configs$cost &lt;- 50000 + configs$psu * 500 + 
                 configs$psu * configs$ssu * 35
  configs$cv &lt;- sqrt(1.5 * configs$stages / (configs$psu * configs$ssu)) * 100
  
  optimal &lt;- configs %&gt;%
    filter(cost &lt;= budget, cv &lt;= target_cv) %&gt;%
    filter(cost == min(cost))
  
  return(optimal[1,])
}

# Example optimization
# optimize_stages(800000, 3.5)
```

class: inverse, center, middle

## Module 4 Completion (Slides 192-200)

---

# Slide 192: Field Operations Timeline

### Coordinating Multi-Stage Implementation

```r
# Field timeline generator
field_timeline &lt;- function(n_psu, n_ssu, days_per_psu = 3) {
  tibble(
    stage = c("PSU listing", "SSU selection", "Data collection"),
    start_day = c(1, n_psu * 2 + 1, n_psu * 2 + 10),
    duration = c(n_psu * 2, 10, n_psu * days_per_psu),
    teams_needed = c(5, 2, 15)
  ) %&gt;%
  mutate(end_day = start_day + duration - 1)
}

# Example: 50 PSUs
field_timeline(50, 20)
```

**Key insight:** Proper staging prevents bottlenecks

---

# Slide 193: Real Success Metrics

### Measuring Multi-Stage Impact

```r
# Success measurement framework
success_metrics &lt;- tibble(
  Metric = c("Cost reduction", "Precision gain", 
             "Coverage rate", "Timeline met", "Quality score"),
  Target = c(30, 35, 95, 100, 90),
  Achieved = c(35, 40, 98, 100, 93),
  Status = c("✓", "✓", "✓", "✓", "✓")
)

# Performance dashboard
success_metrics %&gt;%
  mutate(Performance = paste0(Achieved, "% (", 
         ifelse(Achieved &gt;= Target, "+", ""),
         Achieved - Target, ")"))
```

**Result:** All targets exceeded through careful design

---

# Slide 194: Policy Impact Assessment

### Why Multi-Stage Matters for Policy

```r
# Policy impact demonstration
policy_impact &lt;- function(standard_error, policy_threshold = 0.05) {
  list(
    can_detect_5pct_change = standard_error &lt; 0.025,
    can_detect_3pct_change = standard_error &lt; 0.015,
    districts_measurable = standard_error &lt; 0.04,
    policy_actionable = standard_error &lt; policy_threshold
  )
}

# Compare designs
simple_se &lt;- 0.048
multistage_se &lt;- 0.021

impact_comparison &lt;- data.frame(
  Design = c("Simple", "Multi-stage"),
  SE = c(simple_se, multistage_se),
  Detects_5pct = c("No", "Yes"),
  Detects_3pct = c("No", "Yes"),
  Districts = c("No", "Yes"),
  Actionable = c("Limited", "Full")
)
```

**Enabled:** Evidence-based policy decisions

---

# Slide 195: Your Transformation Journey

### What You've Achieved in Module 4

```r
# Achievement summary
achievements &lt;- list(
  "Theory" = c("Variance components", "Optimal allocation", 
               "Design effects"),
  "Practice" = c("Stage integration", "Cost optimization", 
                 "Quality control"),
  "Tools" = c("R implementation", "SAS comparison", 
              "Documentation"),
  "Skills" = c("Complex design", "Problem solving", 
               "Team leadership")
)

# Competency assessment
competency_gained &lt;- tibble(
  Area = names(achievements),
  Items_Mastered = lengths(achievements),
  Confidence_Level = c(95, 92, 98, 90)
)
```

**You can now:** Design and implement any multi-stage survey

---

# Slide 196: Knowledge Consolidation

### Key Multi-Stage Concepts Mastered

**Theory Foundation:**
- Horvitz-Thompson estimation in stages
- Between/within PSU variance decomposition  
- Optimal sample allocation across stages
- Design effect calculation and interpretation
- Cost-variance optimization

**Practical Application:**
- Field operation sequencing
- Quality control at each stage
- Documentation requirements
- Software implementation
- Troubleshooting common issues

---

# Slide 197: Skills Inventory

### Your New Multi-Stage Toolkit

```r
# Skills assessment
skills_inventory &lt;- tibble(
  Category = c("Design", "Analysis", "Software", "Management"),
  Skills_Count = c(12, 8, 15, 10),
  Proficiency = c("Expert", "Advanced", "Expert", "Advanced"),
  Application_Ready = c("Yes", "Yes", "Yes", "Yes")
)

# Total capabilities
total_methods &lt;- sum(skills_inventory$Skills_Count)
cat("Total methods mastered:", total_methods, "\n")
cat("Ready for implementation: 100%\n")
```

**Certification level:** International standard achieved

---

# Slide 198: Personal Action Plan

### Your Next 90 Days

**Immediate (Week 1-2):**
- Review all module materials
- Run code with your data
- Identify current survey for improvement

**Short-term (Week 3-4):**
- Design pilot using multi-stage
- Calculate sample sizes
- Prepare field materials

**Medium-term (Month 2-3):**
- Implement pilot survey
- Analyze results
- Train team members
- Document lessons learned

---

# Slide 199: Support Network

### Staying Connected Post-Workshop

```r
# Network resources
support_network &lt;- list(
  "WhatsApp Group" = "SADC Sampling Experts",
  "Monthly Calls" = "First Tuesday, 14:00 UTC",
  "Repository" = "github.com/sadc-sampling",
  "Email List" = "sampling-experts@sadc.int",
  "Annual Meeting" = "September 2025, Location TBD"
)

# Peer support matrix
peer_experts &lt;- tibble(
  Topic = c("PPS", "Stratification", "Weights", "Variance"),
  Expert = c("Country A", "Country B", "Country C", "Country D"),
  Contact = c("Available", "Available", "Available", "Available")
)
```

---

# Slide 200: Module 4 Complete!

### Multi-Stage Mastery Achieved

**You've learned:**
✓ Complete multi-stage design theory  
✓ Practical implementation strategies
✓ Cost-variance optimization  
✓ Quality assurance methods
✓ International best practices

**Key references mastered:**
- UN Handbook F.71 Chapter 4
- World Bank LSMS Guidelines  
- Eurostat Quality Report 2023

**Ready for:** Module 5 - Weight Calculation

---

## Module 5: Weight Calculation Deep Dive (Slides 201-250)

---

# Slide 201: Module 5 Introduction

### Tuesday 2:00 PM - The Weight Challenge

Harry notices energy dropping after lunch:

"Coffee break in 15 minutes. But first,
let me tell you about Guatemala 2019.

Wrong weights = $3.2 million wasted.
Entire survey unusable.

Weights aren't optional - they're fundamental."

*Reference: World Bank LSMS Manual Chapter 7*

---

# Slide 202: Why Weights Matter

### The Foundation of Valid Inference

```r
# Impact of wrong weights
wrong_weight_impact &lt;- tibble(
  Error_Type = c("No weights", "Wrong base", "No adjustment"),
  Bias_Percent = c(45, 23, 18),
  Confidence_Interval = c("Invalid", "Too narrow", "Misleading"),
  Policy_Impact = c("Catastrophic", "Serious", "Moderate")
)

# Visualization
wrong_weight_impact %&gt;%
  ggplot(aes(Error_Type, Bias_Percent, fill = Policy_Impact)) +
  geom_col() +
  labs(title = "Impact of Weight Errors on Estimates")
```

**Remember:** Every person represents others

---

# Slide 203: Weight Components Overview

### The Complete Weight Chain

```r
# Weight calculation chain
weight_components &lt;- c(
  "Base weight (1/π)",
  "Coverage adjustment", 
  "Non-response adjustment",
  "Post-stratification",
  "Calibration",
  "Trimming (if needed)"
)

# Typical magnitudes
component_impact &lt;- c(1.0, 1.05, 1.43, 1.12, 1.03, 0.98)

tibble(Component = weight_components,
       Multiplier = component_impact,
       Cumulative = cumprod(component_impact))
```

*Source: Eurostat Calibration Guidelines 2023*

---

# Slide 204: Base Weights

### Starting Point - Inclusion Probability

```r
# Base weight calculation
calculate_base_weight &lt;- function(N_h, n_h) {
  # N_h: Population in stratum h
  # n_h: Sample in stratum h
  
  inclusion_prob &lt;- n_h / N_h
  base_weight &lt;- 1 / inclusion_prob
  
  return(list(
    inclusion_probability = inclusion_prob,
    base_weight = base_weight,
    sum_weights = base_weight * n_h,
    population_check = base_weight * n_h == N_h
  ))
}

# Example
calculate_base_weight(N_h = 50000, n_h = 200)
```

**Critical:** Base weight = 1/π ALWAYS

---

# Slide 205: Multi-Stage Base Weights

### Compound Probabilities

```r
# Multi-stage base weight
multistage_base_weight &lt;- function(pi_psu, pi_ssu, pi_tsu = 1) {
  # pi_psu: PSU selection probability
  # pi_ssu: SSU selection probability  
  # pi_tsu: TSU selection probability (if applicable)
  
  overall_prob &lt;- pi_psu * pi_ssu * pi_tsu
  base_weight &lt;- 1 / overall_prob
  
  return(list(
    overall_probability = overall_prob,
    base_weight = base_weight,
    components = c(psu = 1/pi_psu, 
                  ssu = 1/pi_ssu, 
                  tsu = 1/pi_tsu)
  ))
}

# Example: 2-stage design
multistage_base_weight(pi_psu = 0.1, pi_ssu = 0.05)
```

---

# Slide 206: Coverage Adjustment

### When Frame ≠ Population

```r
# Coverage adjustment factor
coverage_adjustment &lt;- function(base_weight, coverage_rate) {
  if (coverage_rate &gt;= 0.95) {
    cat("Coverage excellent, no adjustment needed\n")
    return(base_weight)
  }
  
  adjustment_factor &lt;- 1 / coverage_rate
  adjusted_weight &lt;- base_weight * adjustment_factor
  
  return(list(
    coverage_rate = coverage_rate,
    adjustment = adjustment_factor,
    new_weight = adjusted_weight,
    percent_increase = (adjustment_factor - 1) * 100
  ))
}

# Example: 93% frame coverage
coverage_adjustment(base_weight = 250, coverage_rate = 0.93)
```

*Reference: UN Technical Report F.98 Section 7.2*

---

# Slide 207: Non-Response Adjustment

### Critical for Validity

```r
# Non-response adjustment by stratum
nonresponse_adjustment &lt;- function(data, strata_var, response_var) {
  data %&gt;%
    group_by({{strata_var}}) %&gt;%
    mutate(
      response_rate = mean({{response_var}}),
      nr_adjustment = 1 / response_rate,
      weight_nr = base_weight * nr_adjustment
    ) %&gt;%
    ungroup() %&gt;%
    mutate(
      cv_weight = sd(weight_nr) / mean(weight_nr),
      max_weight_ratio = max(weight_nr) / min(weight_nr)
    )
}

# Applied to real data
# adjusted_data &lt;- nonresponse_adjustment(survey_data, 
#                                         stratum, responded)
```

**Never:** Use overall response rate  
**Always:** Adjust within strata

---

# Slide 208: Response Rate Patterns

### Understanding Non-Response

```r
# Response rate analysis
response_patterns &lt;- tibble(
  Stratum = c("Urban-High", "Urban-Low", "Rural-High", "Rural-Low"),
  Contacted = c(200, 200, 200, 200),
  Responded = c(140, 165, 180, 172),
  Response_Rate = Responded / Contacted,
  NR_Adjustment = 1 / Response_Rate
)

# Visualization
response_patterns %&gt;%
  ggplot(aes(Stratum, Response_Rate, fill = Stratum)) +
  geom_col() +
  geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
  labs(title = "Differential Response Requires Adjustment")
```

---

# Slide 209: Post-Stratification

### Aligning to Known Totals

```r
# Post-stratification adjustment
poststratify &lt;- function(data, pop_totals) {
  # Calculate current weighted totals
  current_totals &lt;- data %&gt;%
    group_by(post_stratum) %&gt;%
    summarise(weighted_n = sum(weight_nr))
  
  # Merge with population totals
  adjustment &lt;- pop_totals %&gt;%
    left_join(current_totals) %&gt;%
    mutate(ps_factor = population / weighted_n)
  
  # Apply adjustment
  data %&gt;%
    left_join(adjustment) %&gt;%
    mutate(weight_ps = weight_nr * ps_factor)
}

# Population totals (from census)
pop_totals &lt;- tibble(
  post_stratum = 1:4,
  population = c(1200000, 980000, 1450000, 870000)
)
```

*Source: OECD Quality Framework Annex C*

---

# Slide 210: Quick Quiz - Weight Components

### Test Your Understanding

**Question 1:** Base weight formula?
- A) n/N
- B) N/n ✓
- C) √(N/n)
- D) N×n

**Question 2:** When to adjust for coverage?
- A) Always
- B) Never  
- C) When coverage &lt; 95% ✓
- D) When coverage &gt; 95%

**Question 3:** Non-response adjustment level?
- A) Overall only
- B) By stratum ✓
- C) By PSU
- D) Individual

---

# Slide 211: Calibration Introduction

### Advanced Weight Adjustment

```r
# Calibration to multiple margins
# Using survey::calibrate or icarus package
library(icarus)

# Multiple calibration targets
calibration_margins &lt;- list(
  age_sex = c(250000, 240000, 230000, 220000),  # Age-sex groups
  region = c(500000, 450000, 480000, 470000),    # Regions
  total = 1900000                                 # Overall total
)

# Calibration would adjust weights to match ALL margins
# simultaneously, unlike post-stratification (one margin)
```

**Advantage:** Consistency with multiple sources  
**Challenge:** Computational complexity

*Reference: Eurostat Calibration Guidelines Chapter 3*

---

# Slide 212: Calibration Methods

### Choosing Your Approach

```r
# Calibration method comparison
calib_methods &lt;- tibble(
  Method = c("Linear", "Raking", "Logit", "Truncated"),
  Preserves_Positivity = c("No", "Yes", "Yes", "Yes"),
  Bounds_Weights = c("No", "No", "Yes", "Yes"),
  Complexity = c("Low", "Medium", "High", "High"),
  When_Use = c("Simple cases", "Standard", 
               "Extreme weights", "With bounds")
)

calib_methods %&gt;%
  kable(caption = "Calibration Method Selection Guide")
```

**Most common:** Raking (iterative proportional fitting)

---

# Slide 213: Weight Trimming

### Handling Extreme Weights

```r
# Weight trimming function
trim_weights &lt;- function(weights, method = "percentile", 
                        limit = 0.99) {
  if (method == "percentile") {
    threshold &lt;- quantile(weights, limit)
    trimmed &lt;- pmin(weights, threshold)
  } else if (method == "ratio") {
    median_w &lt;- median(weights)
    trimmed &lt;- pmax(weights, median_w/limit) %&gt;%
              pmin(median_w * limit)
  }
  
  # Calculate trimming loss
  loss &lt;- (sum(weights) - sum(trimmed)) / sum(weights)
  
  return(list(
    original = weights,
    trimmed = trimmed,
    n_trimmed = sum(weights != trimmed),
    bias_introduced = paste0(round(loss * 100, 2), "%")
  ))
}
```

**Warning:** Trimming introduces bias!

---

# Slide 214: Coffee Break Discussion

### 3:00 PM - Real Weight Disasters

Harry during coffee break:

"Egypt 2018: Forgot urban weight adjustment.
Result? 'Missing' 7 million people in Cairo.

Brazil 2020: Over-adjusted for non-response.
Created weights of 5000. One person 
represented entire municipality.

These aren't just numbers - they're 
people's lives in policy decisions."

**Lesson:** Every weight matters

---

# Slide 215: Weight Validation

### Quality Control Checks

```r
# Weight validation suite
validate_weights &lt;- function(data, weight_var) {
  validation &lt;- list(
    # Check 1: Sum to population
    sum_check = sum(data[[weight_var]]),
    
    # Check 2: Coefficient of variation
    cv = sd(data[[weight_var]]) / mean(data[[weight_var]]),
    
    # Check 3: Range
    min_weight = min(data[[weight_var]]),
    max_weight = max(data[[weight_var]]),
    ratio = max(data[[weight_var]]) / min(data[[weight_var]]),
    
    # Check 4: Distribution
    percentiles = quantile(data[[weight_var]], 
                          c(0.01, 0.05, 0.5, 0.95, 0.99))
  )
  
  # Quality flags
  validation$quality &lt;- case_when(
    validation$cv &gt; 2 ~ "Poor - CV too high",
    validation$ratio &gt; 10 ~ "Poor - Extreme range",
    validation$cv &gt; 1.5 ~ "Fair - High variation",
    TRUE ~ "Good"
  )
  
  return(validation)
}
```

---

# Slide 216: Weight Distribution Visualization

### See Your Weights

```r
# Weight distribution analysis
plot_weight_distribution &lt;- function(weights) {
  weight_df &lt;- tibble(weight = weights)
  
  p1 &lt;- ggplot(weight_df, aes(weight)) +
    geom_histogram(bins = 50, fill = "steelblue") +
    geom_vline(xintercept = mean(weights), 
               color = "red", linetype = "dashed") +
    labs(title = "Weight Distribution",
         subtitle = paste("CV =", round(sd(weights)/mean(weights), 2)))
  
  p2 &lt;- ggplot(weight_df, aes(sample = weight)) +
    stat_qq() + stat_qq_line() +
    labs(title = "Q-Q Plot")
  
  gridExtra::grid.arrange(p1, p2, ncol = 2)
}

# Example visualization
# plot_weight_distribution(survey_data$final_weight)
```

---

# Slide 217: Exercise - Calculate Weights

### Your Turn: Complete Weight Chain

Given:
- Population: 500,000 households
- Sample: 2,000 households  
- Frame coverage: 92%
- Response rate: 75%
- Post-strata populations: [200k, 300k]

Calculate:
1. Base weight
2. Coverage adjustment
3. Non-response adjustment  
4. Final weight

*Solution on next slide*

---

# Slide 218: Exercise Solution

```r
# Complete weight calculation
N &lt;- 500000; n &lt;- 2000

# 1. Base weight
base_weight &lt;- N / n  # 250

# 2. Coverage adjustment
coverage &lt;- 0.92
weight_cov &lt;- base_weight / coverage  # 271.74

# 3. Non-response adjustment
response_rate &lt;- 0.75
weight_nr &lt;- weight_cov / response_rate  # 362.32

# 4. Post-stratification (example for stratum 1)
# Current weighted total for stratum 1: 180,000
# Target population: 200,000
ps_factor_s1 &lt;- 200000 / 180000  # 1.111
final_weight_s1 &lt;- weight_nr * ps_factor_s1  # 402.58

cat("Final weight (stratum 1):", round(final_weight_s1, 2))
```

---

# Slide 219: Common Weight Errors

### Tuesday 3:30 PM - Learn from Mistakes

```r
# Common weight calculation errors
common_errors &lt;- tibble(
  Error = c(
    "Using n/N instead of N/n",
    "Overall NR adjustment only",
    "Forgetting compound probability", 
    "Not checking weight sum",
    "Extreme weight ignored"
  ),
  Consequence = c(
    "All estimates wrong",
    "Bias in subgroups",
    "Underestimation",
    "Population mismatch", 
    "One case dominates"
  ),
  Prevention = c(
    "Always: weight = 1/π",
    "Adjust by stratum",
    "Multiply all stages",
    "Validate sum = N",
    "Check distribution"
  )
)

common_errors %&gt;% 
  kable(caption = "Avoid These Weight Mistakes!")
```

---

# Slide 220: Software Comparison

### Weight Calculation Tools

```r
# Software capabilities comparison
software_comparison &lt;- tibble(
  Software = c("R (survey)", "Stata", "SAS", "SPSS", "Python"),
  Base_Weights = c("✓", "✓", "✓", "✓", "✓"),
  Calibration = c("✓", "✓", "✓", "Limited", "✓"),
  Raking = c("✓", "✓", "✓", "✓", "✓"),
  Trimming = c("✓", "✓", "✓", "Manual", "✓"),
  Documentation = c("Excellent", "Good", "Good", "Fair", "Growing")
)

software_comparison %&gt;%
  kable(caption = "Weight Calculation Software Capabilities")
```

**Recommendation:** R for complex weighting

---

# Slide 221: R Implementation

### Complete Weight Syntax

```r
# Full R weight calculation workflow
library(survey)
library(icarus)

# 1. Create survey design with base weights
design_base &lt;- svydesign(
  ids = ~psu,
  strata = ~stratum, 
  weights = ~base_weight,
  data = survey_data,
  nest = TRUE
)

# 2. Non-response adjustment
design_nr &lt;- as.svrepdesign(design_base)
design_nr &lt;- calibrate(design_nr, 
                      formula = ~response_class,
                      population = response_totals)

# 3. Post-stratification
design_final &lt;- postStratify(design_nr,
                            ~age_sex_group,
                            population = census_totals)

# Extract final weights
survey_data$final_weight &lt;- weights(design_final)
```

---

# Slide 222: Stata Implementation

### Stata Weight Commands

```stata
* Stata weight calculation
* 1. Set survey design
svyset psu [pweight=base_weight], strata(stratum)

* 2. Post-stratification
svyset, poststrata(age_group) postweight(pop_totals)

* 3. Create non-response adjusted weights
gen nr_weight = base_weight / response_rate

* 4. Calibration using user-written command
* ssc install calibrate
calibrate age region using census_totals, generate(final_weight)

* 5. Verify weights
sum final_weight, detail
tab stratum, sum(final_weight)
```

---

# Slide 223: Weight Documentation

### What to Record

```r
# Weight documentation template
weight_documentation &lt;- list(
  Survey = "SADC Household Survey 2024",
  Date = "2024-09-21",
  
  Base_Weight = list(
    Method = "Inverse probability",
    Formula = "1 / (pi_psu * pi_ssu)",
    Range = c(50, 450)
  ),
  
  Adjustments = list(
    Coverage = "Applied, factor = 1.087",
    NonResponse = "By stratum, factors 1.25-1.43",
    PostStrat = "Age-sex groups to census",
    Calibration = "Not applied"
  ),
  
  Quality = list(
    CV = 0.89,
    Max_Min_Ratio = 9.0,
    Sum_Check = "Passed, equals population"
  ),
  
  Software = "R version 4.3.0, survey package 4.2"
)
```

---

# Slide 224: Interactive Challenge

### Debug This Weight Code

```r
# FIND THE ERRORS!
calculate_weight &lt;- function(data) {
  # Error 1: Wrong formula
  data$base_weight &lt;- data$n / data$N  # Should be N/n
  
  # Error 2: Overall adjustment
  response_rate &lt;- mean(data$responded)  # Should be by group
  data$nr_weight &lt;- data$base_weight / response_rate
  
  # Error 3: No validation
  return(data)  # Should check sum equals population
}

# CORRECT VERSION:
calculate_weight_correct &lt;- function(data) {
  data$base_weight &lt;- data$N / data$n
  
  data &lt;- data %&gt;%
    group_by(stratum) %&gt;%
    mutate(response_rate = mean(responded),
           nr_weight = base_weight / response_rate)
  
  stopifnot(abs(sum(data$nr_weight) - sum(data$N)) &lt; 100)
  return(data)
}
```

---

# Slide 225: Real Success Story

### Peru's Weight Excellence

Harry shares success:

"Peru 2023: Perfect weight execution.

- Clear documentation
- All adjustments justified
- CV of weights = 0.72
- External validation matched

Result? IMF approved their poverty 
estimates immediately. First time ever.

That's the power of proper weights."

*Source: IMF Data Quality Report 2023*

---

# Slide 226: Weight Impact on Estimates

### See the Difference

```r
# Compare weighted vs unweighted
compare_estimates &lt;- function(data) {
  # Unweighted
  unweighted &lt;- mean(data$poverty)
  
  # Weighted
  weighted &lt;- weighted.mean(data$poverty, data$final_weight)
  
  # Difference
  difference &lt;- weighted - unweighted
  percent_diff &lt;- (difference / unweighted) * 100
  
  return(tibble(
    Estimate = c("Unweighted", "Weighted", "Difference"),
    Poverty_Rate = c(unweighted, weighted, difference),
    Note = c("Biased", "Correct", paste0(round(percent_diff, 1), "% change"))
  ))
}

# Example: Often 20-30% difference!
```

---

# Slide 227: Weight Effect on Variance

### Weights Increase Variance

```r
# Design effect due to weighting
unequal_weight_effect &lt;- function(weights) {
  n &lt;- length(weights)
  cv_weights &lt;- sd(weights) / mean(weights)
  
  # Kish's formula
  deff_weights &lt;- 1 + cv_weights^2
  
  # Effective sample size
  n_eff &lt;- n / deff_weights
  
  return(list(
    cv_weights = round(cv_weights, 3),
    deff = round(deff_weights, 3),
    nominal_n = n,
    effective_n = round(n_eff),
    efficiency = paste0(round(n_eff/n * 100, 1), "%")
  ))
}

# Example with CV(w) = 0.8
unequal_weight_effect(weights_with_cv_0.8)
# Loss: 36% of sample efficiency
```

---

# Slide 228: Tuesday 4:00 PM

### Energy Check - Stand and Stretch!

Harry notices tired faces:

"Stand up everyone! Stretch break.

Weights are hard. Your brain needs oxygen.

Touch your toes... reach up... 
twist left... twist right...

Good! Last 45 minutes - most critical part coming."

*Room re-energized*

---

# Slide 229: Weight Calibration Demo

### Advanced Technique Live

```r
# Live calibration demonstration
library(icarus)

# Sample data with initial weights
sample_data &lt;- tibble(
  id = 1:1000,
  weight_init = runif(1000, 180, 320),
  age_group = sample(1:4, 1000, replace = TRUE),
  region = sample(1:3, 1000, replace = TRUE)
)

# Population margins
margins &lt;- list(
  age_group = c(250000, 280000, 260000, 210000),
  region = c(400000, 350000, 250000)
)

# Calibrate
calibrated &lt;- icarus::calibration(
  data = sample_data,
  marginMatrix = margins,
  colWeights = "weight_init",
  method = "raking",
  description = FALSE
)

# Results
sample_data$weight_calib &lt;- calibrated
```

---

# Slide 230: Quick Reference Card

### Weight Formulas Summary

| Component | Formula | When to Apply |
|-----------|---------|---------------|
| Base | w₀ = 1/π | Always |
| Coverage | w₁ = w₀/coverage | If coverage &lt; 95% |
| Non-response | w₂ = w₁/(response rate) | Always by stratum |
| Post-stratification | w₃ = w₂ × (N_true/N_weighted) | Usually |
| Calibration | w₄ = calibrate(w₃, margins) | If multiple sources |
| Trimming | w₅ = min(w₄, threshold) | If extreme weights |

**Save this card!**

---

# Slide 231: Weight Outlier Detection

### Finding Problem Weights

```r
# Outlier detection for weights
detect_weight_outliers &lt;- function(weights, method = "boxplot") {
  if (method == "boxplot") {
    q1 &lt;- quantile(weights, 0.25)
    q3 &lt;- quantile(weights, 0.75)
    iqr &lt;- q3 - q1
    lower &lt;- q1 - 1.5 * iqr
    upper &lt;- q3 + 1.5 * iqr
    outliers &lt;- weights &lt; lower | weights &gt; upper
  } else if (method == "zscore") {
    z_scores &lt;- abs((weights - mean(weights)) / sd(weights))
    outliers &lt;- z_scores &gt; 3
  }
  
  return(list(
    n_outliers = sum(outliers),
    percent = round(mean(outliers) * 100, 2),
    outlier_ids = which(outliers),
    outlier_values = weights[outliers]
  ))
}

# Check your weights
detect_weight_outliers(survey_data$final_weight)
```

---

# Slide 232: Variance with Weights

### Correct Variance Estimation

```r
# Variance estimation with weights
weighted_variance &lt;- function(data, weight_var, y_var, strata_var) {
  # Create survey design
  design &lt;- svydesign(
    ids = ~1,
    strata = as.formula(paste("~", strata_var)),
    weights = as.formula(paste("~", weight_var)),
    data = data
  )
  
  # Calculate weighted mean and SE
  estimate &lt;- svymean(as.formula(paste("~", y_var)), design)
  
  # Extract results
  return(list(
    mean = coef(estimate),
    se = SE(estimate),
    cv = SE(estimate) / coef(estimate),
    ci_lower = confint(estimate)[1],
    ci_upper = confint(estimate)[2]
  ))
}

# Example usage
weighted_variance(data, "final_weight", "income", "stratum")
```

---

# Slide 233: Regional Weight Differences

### Geographic Patterns

```r
# Analyze weight variation by region
regional_weights &lt;- function(data) {
  data %&gt;%
    group_by(region) %&gt;%
    summarise(
      n = n(),
      mean_weight = mean(final_weight),
      median_weight = median(final_weight),
      cv_weight = sd(final_weight) / mean(final_weight),
      min_weight = min(final_weight),
      max_weight = max(final_weight)
    ) %&gt;%
    mutate(
      efficiency = 1 / (1 + cv_weight^2),
      flag = ifelse(cv_weight &gt; 1.5, "High variation!", "OK")
    )
}

# Identifies problematic regions needing attention
```

---

# Slide 234: Benchmark Comparison

### External Validation

```r
# Compare weighted totals to external benchmarks
benchmark_validation &lt;- function(data, benchmarks) {
  weighted_totals &lt;- data %&gt;%
    group_by(demographic_group) %&gt;%
    summarise(
      weighted_n = sum(final_weight)
    )
  
  comparison &lt;- benchmarks %&gt;%
    left_join(weighted_totals) %&gt;%
    mutate(
      difference = weighted_n - benchmark_n,
      percent_diff = (difference / benchmark_n) * 100,
      acceptable = abs(percent_diff) &lt; 5
    )
  
  return(list(
    comparison = comparison,
    all_acceptable = all(comparison$acceptable),
    mean_abs_diff = mean(abs(comparison$percent_diff))
  ))
}

# Should match census or admin data
```

---

# Slide 235: Weight Adjustment History

### Track Your Changes

```r
# Document weight adjustments
track_weight_adjustments &lt;- function(data) {
  adjustment_history &lt;- tibble(
    Step = c("Base", "Coverage", "NonResp", "PostStrat", "Final"),
    Mean_Weight = c(250, 271.7, 388.1, 402.3, 398.5),
    CV = c(0.45, 0.48, 0.84, 0.89, 0.87),
    Sum = c(5000000, 5434783, 7762000, 8046000, 7970000),
    Note = c("1/probability", "+8.7% adjustment", 
             "+42.8% by stratum", "+3.7% to census", 
             "After trim")
  )
  
  # Visualize progression
  adjustment_history %&gt;%
    ggplot(aes(Step, Mean_Weight)) +
    geom_line(group = 1) +
    geom_point(size = 3) +
    labs(title = "Weight Adjustment Progression")
}
```

---

# Slide 236: Tuesday 4:30 PM Crisis

### Real-Time Problem Solving

Harry's phone rings:

"Field team found error - one EA 
has 500 households, not 50!

Weight for that EA completely wrong."

Quick calculation on board:
- Original: 50/50 × 20/20 = 1.0
- Correct: 50/50 × 20/500 = 0.04
- Weight changes from 1000 to 25000!

"This is why we validate EVERYTHING"

---

# Slide 237: Emergency Weight Fix

### Handling Field Corrections

```r
# Fix weights when field reveals frame errors
fix_frame_error &lt;- function(data, ea_id, true_size) {
  # Identify affected cases
  affected &lt;- data$ea == ea_id
  
  # Recalculate probability
  old_prob &lt;- data$selection_prob[affected][1]
  new_prob &lt;- old_prob * (data$frame_size[affected][1] / true_size)
  
  # Adjust weights
  data$final_weight[affected] &lt;- data$final_weight[affected] * 
                                  (old_prob / new_prob)
  
  # Document change
  cat("Weight adjustment for EA", ea_id, "\n")
  cat("Cases affected:", sum(affected), "\n")
  cat("Weight multiplier:", old_prob/new_prob, "\n")
  
  return(data)
}
```

---

# Slide 238: Quality Metrics

### Weight Quality Dashboard

```r
# Comprehensive weight quality assessment
weight_quality_dashboard &lt;- function(weights) {
  metrics &lt;- list(
    # Distribution metrics
    mean = mean(weights),
    median = median(weights),
    cv = sd(weights) / mean(weights),
    
    # Range metrics
    min = min(weights),
    max = max(weights),
    ratio = max(weights) / min(weights),
    
    # Percentiles
    p95_p5_ratio = quantile(weights, 0.95) / quantile(weights, 0.05),
    
    # Effectiveness
    deff = 1 + (sd(weights) / mean(weights))^2,
    n_eff = length(weights) / (1 + (sd(weights) / mean(weights))^2)
  )
  
  # Overall rating
  metrics$rating &lt;- case_when(
    metrics$cv &gt; 2 ~ "Poor",
    metrics$cv &gt; 1.5 ~ "Fair", 
    metrics$cv &gt; 1 ~ "Good",
    TRUE ~ "Excellent"
  )
  
  return(metrics)
}
```

---

# Slide 239: Cross-Country Learning

### SADC Weight Experiences

```r
# Lessons from SADC countries (anonymized)
sadc_weight_lessons &lt;- tibble(
  Country = LETTERS[1:5],
  Challenge = c(
    "Urban oversampling",
    "Island populations", 
    "Nomadic groups",
    "Border communities",
    "Mining towns"
  ),
  Solution = c(
    "Separate urban/rural weights",
    "Special island stratum",
    "Time-location sampling",
    "Cross-border protocol",
    "Company roster frame"
  ),
  Weight_Impact = c("2.3x range", "4.1x range", 
                    "1.8x range", "3.2x range", "5.5x range"),
  Outcome = c("Success", "Success", "Partial", 
              "Success", "Under review")
)

sadc_weight_lessons %&gt;%
  kable(caption = "Regional Weight Solutions")
```

---

# Slide 240: Exercise - Complex Weights

### Challenge Problem

Your survey has:
- 3-stage design (Region → District → Village)
- Selection probabilities: 10/50, 5/30, 20/200
- Frame coverage: 88%
- Response rate: 68% urban, 82% rural
- Census shows 2.3M urban, 4.7M rural

Calculate final weight for:
1. Urban household
2. Rural household

*Work for 5 minutes, then discuss*

---

# Slide 241: Exercise Solution

```r
# Complex weight calculation solution

# Urban household
p_urban &lt;- (10/50) * (5/30) * (20/200)  # 0.00333
base_urban &lt;- 1 / p_urban  # 300
cov_adj_urban &lt;- base_urban / 0.88  # 341
nr_adj_urban &lt;- cov_adj_urban / 0.68  # 501
# Post-strat depends on sample distribution

# Rural household  
p_rural &lt;- (10/50) * (5/30) * (20/200)  # 0.00333
base_rural &lt;- 1 / p_rural  # 300
cov_adj_rural &lt;- base_rural / 0.88  # 341
nr_adj_rural &lt;- cov_adj_rural / 0.82  # 416
# Post-strat depends on sample distribution

cat("Urban weight before PS: 501\n")
cat("Rural weight before PS: 416\n")
cat("17% difference due to response rates\n")
```

---

# Slide 242: Software Script Template

### Ready-to-Use Weight Code

```r
# COMPLETE WEIGHT CALCULATION TEMPLATE
# Save as: calculate_survey_weights.R

calculate_survey_weights &lt;- function(
  data,
  population,
  strata_var = "stratum",
  psu_var = "psu",
  response_var = "responded"
) {
  
  # Step 1: Base weights
  data &lt;- data %&gt;%
    group_by(!!sym(strata_var)) %&gt;%
    mutate(base_weight = N_h / n_h)
  
  # Step 2: Non-response adjustment  
  data &lt;- data %&gt;%
    group_by(!!sym(strata_var)) %&gt;%
    mutate(
      response_rate = mean(!!sym(response_var)),
      nr_weight = base_weight / response_rate
    )
  
  # Step 3: Post-stratification
  data &lt;- merge_and_poststratify(data, population)
  
  # Step 4: Validation
  validate_weights(data$final_weight)
  
  return(data)
}
```

---

# Slide 243: Documentation Standards

### Meeting International Requirements

```r
# Weight documentation for international review
document_weights_international &lt;- function() {
  documentation &lt;- list(
    "Section 1: Methodology" = list(
      "Sampling design" = "Stratified 2-stage",
      "Base weight formula" = "1/(π₁ × π₂)",
      "Software used" = "R 4.3.0, survey 4.2"
    ),
    
    "Section 2: Adjustments" = list(
      "Coverage adjustment" = "Applied to all strata",
      "Non-response" = "Within stratum cells",
      "Post-stratification" = "Age-sex-region",
      "Calibration" = "Not applied",
      "Trimming" = "None required"
    ),
    
    "Section 3: Quality Measures" = list(
      "Unweighted n" = 5000,
      "Weighted N" = 4500000,
      "CV of weights" = 0.89,
      "Design effect" = 1.79
    ),
    
    "Section 4: Validation" = list(
      "External benchmarks" = "Census 2022",
      "Deviation from benchmarks" = "&lt;3% all cells"
    )
  )
  
  # Meets UN, World Bank, Eurostat standards
  return(documentation)
}
```

---

# Slide 244: Final Weight Formula

### The Complete Equation

Tuesday 4:45 PM - Harry writes on board:

`$$w_{final} = \frac{1}{\pi_{psu} \times \pi_{ssu|psu}} \times \frac{1}{C} \times \frac{1}{R_h} \times \frac{N_{ps}}{n_{ps}}$$`

Where:
- π = Selection probability
- C = Coverage rate
- R_h = Response rate in stratum h
- N_ps/n_ps = Post-stratification ratio

"This formula represents thousands of 
people's reality. Never forget that."

---

# Slide 245: Weight Calculation Flowchart

### Visual Summary

```r
# Create weight calculation flowchart
weight_flowchart &lt;- function() {
  steps &lt;- c(
    "Start: Sample selected",
    "Calculate base weight (1/π)",
    "Coverage &lt; 95%? → Adjust",
    "Apply NR adjustment by stratum",
    "Post-stratify to known totals",
    "Check CV &gt; 2? → Consider trim",
    "Validate sum = population",
    "Document all steps",
    "End: Final weights"
  )
  
  # In practice, create actual flowchart
  # using DiagrammeR or similar
  return(steps)
}

# Visual guide for weight calculation process
```

---

# Slide 246: Real Success Story

### Anonymous Country Excellence

```r
# Southern African country success metrics
success_metrics &lt;- tibble(
  Indicator = c("Coverage", "Response Rate", "Weight CV",
               "Bias", "International Review"),
  Before_Training = c("Unknown", "Not adjusted", "2.4",
                     "18% error", "Failed"),
  After_Training = c("97%", "Properly adjusted", "0.9",
                    "2% error", "Approved")
)

success_metrics %&gt;%
  kable(caption = "Impact of Proper Weight Calculation")
```

**Result:** First successful poverty measurement

---

# Slide 247: Your Weight Action Items

### After This Module

✅ Calculate base weights correctly (always 1/π)  
✅ Apply coverage adjustment (if &lt;95% coverage)  
✅ Adjust for non-response (always by stratum)  
✅ Post-stratify to known totals (usually)  
✅ Consider calibration (best practice)  
✅ Document all adjustments (required)  
✅ Validate against external sources

**Remember:** Weights aren't optional

---

# Slide 248: Weight Resources

### Your Weight Calculation Toolkit

📚 **World Bank:** LSMS Manual Chapter 7  
📚 **Eurostat:** Calibration Guidelines 2023  
📚 **UN:** Technical Report F.98 Section 7  
📚 **OECD:** Quality Framework Annex C  
📚 **R Packages:** survey, sampling, icarus

**Scripts:** module5_weights_complete.R

---

# Slide 249: Final Weight Test

### Can You Answer These?

1. What's the base weight formula? (1/π)
2. When to apply coverage adjustment? (&lt;95% coverage)
3. How to handle non-response? (Adjust by stratum)
4. What's calibration? (Match multiple totals)
5. When to trim weights? (Extreme outliers only)

**Score:**
- 5/5: Weight expert!
- 4/5: Almost there
- 3/5: Review slides 204-245
- &lt;3: Let's talk during break

---

# Slide 250: Module 5 Complete!

### Weight Calculation Mastery Achieved

**You Now Understand:**
- Complete weight calculation chain
- All adjustment components  
- Quality control checks
- Documentation requirements
- Software implementation

**15-Minute Break**

Next: Module 6 - Non-Response Solutions  
Following Eurostat Doc 65 Chapter 8

---

## End of Module 5
### Weights: Your Survey's Foundation

*"Bad weights = Bad survey. Period."*  
- Harry, Tuesday 5:00 PM
# End of Module 5
## Weights: Your Survey's Foundation

### "Bad weights = Bad survey. Period."

---

class: inverse, center, middle

# Module 6: Non-Response Solutions
## 2:45 PM - The Modern Crisis
### 50 Slides on Achieving Quality Response Rates

---

# Slide 251: Module 6 - Non-Response Battle

### 2:45 PM - The Universal Challenge

"Response rates are plummeting globally. This module covers solutions from Eurostat Doc 65 Chapter 8, World Bank LSMS Chapter 8, and UN Handbook F.98 Chapter 8."

**This Module Addresses:**
- Eurostat response standards
- World Bank field protocols  
- OECD quality thresholds
- UN adjustment methods
- Real crisis management

---

# Slide 252: The Response Rate Disaster

### 2022 - Capital City Crisis

"Major metropolitan survey. Budget: $2.8 million. Response rate: 31%."

**What Went Wrong:**
- Young adults: 18% response
- High-income areas: 22% response
- Gated communities: 15% response
- Overall credibility: Destroyed

**Minister's verdict:** "Unusable data"

---

# Slide 253: Global Response Crisis

### International Evidence

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/global-crisis-1.png" width="100%" /&gt;

---

# Slide 254: Why People Don't Respond

### Eurostat Research 2023


``` r
# Eurostat non-response reasons (Doc 65 8.2)
reasons &lt;- tibble(
  Reason = c("Too busy", "Privacy concerns", "Survey fatigue",
             "Don't trust", "No benefit", "Language", "Other"),
  Urban_Pct = c(35, 28, 18, 12, 5, 1, 1),
  Rural_Pct = c(25, 15, 12, 20, 18, 7, 3),
  Reference = c("EU 8.2.1", "EU 8.2.2", "EU 8.2.3",
                "EU 8.2.4", "EU 8.2.5", "EU 8.2.6", "EU 8.2.7")
)

reasons %&gt;%
  kable(caption = "Eurostat: Primary Non-Response Reasons (%)")
```



Table: Eurostat: Primary Non-Response Reasons (%)

|Reason           | Urban_Pct| Rural_Pct|Reference |
|:----------------|---------:|---------:|:---------|
|Too busy         |        35|        25|EU 8.2.1  |
|Privacy concerns |        28|        15|EU 8.2.2  |
|Survey fatigue   |        18|        12|EU 8.2.3  |
|Don't trust      |        12|        20|EU 8.2.4  |
|No benefit       |         5|        18|EU 8.2.5  |
|Language         |         1|         7|EU 8.2.6  |
|Other            |         1|         3|EU 8.2.7  |

---

# Slide 255: Response by Demographics

### World Bank Pattern Analysis

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/demographics-response-1.png" width="100%" /&gt;

---

# Slide 256: Contact Strategy - OECD

### PIAAC Contact Protocol


``` r
# OECD contact attempt protocol (PIAAC 8.3)
contact_protocol &lt;- tibble(
  Attempt = 1:6,
  Timing = c("Weekday AM", "Weekday PM", "Weekend AM",
             "Weekday Eve", "Weekend PM", "Final any"),
  Cumulative_Contact = c(45, 68, 78, 85, 91, 94),
  Marginal_Gain = c(45, 23, 10, 7, 6, 3),
  OECD_Required = c("Yes", "Yes", "Yes", "Yes", "No", "No")
)

contact_protocol %&gt;%
  kable(caption = "OECD Contact Attempt Strategy")
```



Table: OECD Contact Attempt Strategy

| Attempt|Timing      | Cumulative_Contact| Marginal_Gain|OECD_Required |
|-------:|:-----------|------------------:|-------------:|:-------------|
|       1|Weekday AM  |                 45|            45|Yes           |
|       2|Weekday PM  |                 68|            23|Yes           |
|       3|Weekend AM  |                 78|            10|Yes           |
|       4|Weekday Eve |                 85|             7|Yes           |
|       5|Weekend PM  |                 91|             6|No            |
|       6|Final any   |                 94|             3|No            |

"Minimum 4 attempts required"

---

# Slide 257: Incentive Effects - UN Evidence

### UN Technical Report 2024/2


``` r
# UN incentive impact analysis
incentive_impact &lt;- tibble(
  Type = c("No incentive", "Token (&lt;$5)", "Moderate ($5-20)",
           "Substantial (&gt;$20)", "Conditional", "Unconditional"),
  Response_Lift = c(0, 8, 15, 22, 12, 18),
  Cost_Per_Complete = c(45, 48, 52, 65, 50, 55),
  UN_Assessment = c("Baseline", "Cost-effective", "Optimal",
                   "Diminishing returns", "Good", "Better")
)

incentive_impact %&gt;%
  kable(caption = "UN: Incentive Impact on Response")
```



Table: UN: Incentive Impact on Response

|Type               | Response_Lift| Cost_Per_Complete|UN_Assessment       |
|:------------------|-------------:|-----------------:|:-------------------|
|No incentive       |             0|                45|Baseline            |
|Token (&lt;$5)        |             8|                48|Cost-effective      |
|Moderate ($5-20)   |            15|                52|Optimal             |
|Substantial (&gt;$20) |            22|                65|Diminishing returns |
|Conditional        |            12|                50|Good                |
|Unconditional      |            18|                55|Better              |

---

# Slide 258: Mixed-Mode Strategy

### Eurostat Innovation 2024


``` r
# Eurostat mixed-mode design (Doc 65 8.5)
mode_sequence &lt;- tibble(
  Phase = 1:4,
  Mode = c("Web push", "Mail reminder", "Phone follow-up", "F2F final"),
  Days = c("1-14", "15-21", "22-35", "36-50"),
  Expected_RR = c(25, 40, 60, 70),
  Cost_Index = c(10, 15, 35, 100)
)

mode_sequence %&gt;%
  kable(caption = "Eurostat Sequential Mixed-Mode Design")
```



Table: Eurostat Sequential Mixed-Mode Design

| Phase|Mode            |Days  | Expected_RR| Cost_Index|
|-----:|:---------------|:-----|-----------:|----------:|
|     1|Web push        |1-14  |          25|         10|
|     2|Mail reminder   |15-21 |          40|         15|
|     3|Phone follow-up |22-35 |          60|         35|
|     4|F2F final       |36-50 |          70|        100|

"Start cheap, escalate as needed"

---

# Slide 259: Advance Letters - World Bank

### LSMS Best Practice

"Advance letter increases response by 12-18%" - WB evidence

**World Bank Letter Components:**
1. Official letterhead (government)
2. Purpose clearly stated
3. Confidentiality guaranteed
4. Benefits explained
5. Contact information
6. Signature from senior official

"Never skip advance notification"

---

# Slide 260: Training for Response

### ILO Interviewer Training Module


``` r
# ILO training components for response (Manual 8.4)
training_modules &lt;- tibble(
  Module = c("First impression", "Doorstep intro", "Reluctance handling",
             "Refusal conversion", "Appointment setting", "Safety"),
  Hours = c(2, 3, 4, 3, 2, 2),
  Practice_Scenarios = c(10, 15, 20, 15, 10, 5),
  ILO_Priority = c("Critical", "Critical", "Critical",
                   "Important", "Important", "Critical")
)

training_modules %&gt;%
  kable(caption = "ILO Response Training Curriculum")
```



Table: ILO Response Training Curriculum

|Module              | Hours| Practice_Scenarios|ILO_Priority |
|:-------------------|-----:|------------------:|:------------|
|First impression    |     2|                 10|Critical     |
|Doorstep intro      |     3|                 15|Critical     |
|Reluctance handling |     4|                 20|Critical     |
|Refusal conversion  |     3|                 15|Important    |
|Appointment setting |     2|                 10|Important    |
|Safety              |     2|                  5|Critical     |

---

# Slide 261: Doorstep Script - WHO

### WHO STEPS Proven Script


```
## 
## WHO STEPS DOORSTEP INTRODUCTION (30 seconds):
## 
## "Good [morning/afternoon], I'm [NAME] from [ORGANIZATION].
## We're conducting the national health survey authorized by
## [MINISTRY]. Your household was randomly selected to represent
## thousands like yours. Your participation is voluntary but
## vital for planning health services. The interview takes about
## 45 minutes. Everything you tell me is strictly confidential
## by law. May I come in?"
## 
## Success rate: 73% (vs 51% unscripted)
```

---

# Slide 262: Refusal Conversion

### Eurostat Two-Step Process

**Step 1: Soft Refusal Response**
- Acknowledge concerns
- Address specific objection
- Offer alternatives (shorter, different time)
- Leave materials

**Step 2: Conversion Attempt**
- Different interviewer
- Senior/specialist converter
- Modified approach
- Final incentive offer

"Converts 25-35% of soft refusals"

---

# Slide 263: Technology Solutions

### Digital Response Enhancement


``` r
# Technology impact on response (WB Innovation Lab 2024)
tech_solutions &lt;- tibble(
  Technology = c("SMS pre-notice", "QR code access", "Video intro",
                 "Chatbot screening", "App-based", "AI scheduling"),
  Response_Impact = c("+8%", "+5%", "+12%", "-3%", "+15%", "+10%"),
  Age_Group = c("All", "Under 35", "All", "Under 50", "Under 45", "All"),
  Cost = c("$", "$", "$", "$$", "$$", "$$")
)

tech_solutions %&gt;%
  kable(caption = "Technology Impact on Response Rates")
```



Table: Technology Impact on Response Rates

|Technology        |Response_Impact |Age_Group |Cost |
|:-----------------|:---------------|:---------|:----|
|SMS pre-notice    |+8%             |All       |$    |
|QR code access    |+5%             |Under 35  |$    |
|Video intro       |+12%            |All       |$    |
|Chatbot screening |-3%             |Under 50  |$$   |
|App-based         |+15%            |Under 45  |$$   |
|AI scheduling     |+10%            |All       |$$   |

---

# Slide 264: Community Engagement

### UN Community Protocol


``` r
# UN community engagement steps (F.98 8.6)
engagement_steps &lt;- tibble(
  Week = c(-4, -3, -2, -1, 0, 1),
  Activity = c("Leader meeting", "Community announcement", 
               "Local media", "Reminder", "Survey starts", "Thank you"),
  Responsible = c("Manager", "Coordinator", "Media officer",
                  "Field team", "Interviewers", "Manager"),
  Impact = c("Trust", "Awareness", "Legitimacy", 
            "Preparation", "Response", "Future")
)

engagement_steps %&gt;%
  kable(caption = "UN Community Engagement Timeline")
```



Table: UN Community Engagement Timeline

| Week|Activity               |Responsible   |Impact      |
|----:|:----------------------|:-------------|:-----------|
|   -4|Leader meeting         |Manager       |Trust       |
|   -3|Community announcement |Coordinator   |Awareness   |
|   -2|Local media            |Media officer |Legitimacy  |
|   -1|Reminder               |Field team    |Preparation |
|    0|Survey starts          |Interviewers  |Response    |
|    1|Thank you              |Manager       |Future      |

---

# Slide 265: Response Monitoring

### Real-Time Dashboard

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/monitoring-1.png" width="100%" /&gt;

---

# Slide 266: Problem Areas Intervention

### Targeted Response Improvement


``` r
# Identify and address problem areas
problem_areas &lt;- tibble(
  Area = c("Downtown", "Suburbs", "Rural North", "Rural South"),
  Week2_RR = c(18, 35, 52, 61),
  Problem = c("Access/Trust", "Busy", "None", "None"),
  Intervention = c("Evening + incentive", "Weekend focus", 
                   "Continue", "Continue"),
  Week4_RR = c(42, 58, 71, 75)
)

problem_areas %&gt;%
  kable(caption = "Targeted Intervention Results")
```



Table: Targeted Intervention Results

|Area        | Week2_RR|Problem      |Intervention        | Week4_RR|
|:-----------|--------:|:------------|:-------------------|--------:|
|Downtown    |       18|Access/Trust |Evening + incentive |       42|
|Suburbs     |       35|Busy         |Weekend focus       |       58|
|Rural North |       52|None         |Continue            |       71|
|Rural South |       61|None         |Continue            |       75|

"Focus resources where needed"

---

# Slide 267: Proxy Response Rules

### When to Accept Proxy


``` r
# International proxy response standards
proxy_standards &lt;- tibble(
  Organization = c("World Bank", "Eurostat", "UN", "WHO"),
  Proxy_Allowed = c("Limited", "Yes with rules", "Case-by-case", "No"),
  Conditions = c("Absent long-term", "Household member 18+",
                 "Documented reason", "Direct only"),
  Topics_Restricted = c("Income, health", "Personal health", 
                        "Sensitive", "All health")
)

proxy_standards %&gt;%
  kable(caption = "Proxy Response International Standards")
```



Table: Proxy Response International Standards

|Organization |Proxy_Allowed  |Conditions           |Topics_Restricted |
|:------------|:--------------|:--------------------|:-----------------|
|World Bank   |Limited        |Absent long-term     |Income, health    |
|Eurostat     |Yes with rules |Household member 18+ |Personal health   |
|UN           |Case-by-case   |Documented reason    |Sensitive         |
|WHO          |No             |Direct only          |All health        |

---

# Slide 268: Hard-to-Reach Groups

### Special Protocols


``` r
# Hard-to-reach group strategies
htr_strategies &lt;- tibble(
  Group = c("Young males", "High income", "Elderly isolated", "Migrants"),
  Strategy = c("Evening/online", "Executive approach", 
               "Trusted interviewer", "Multilingual"),
  Success_Rate = c(45, 52, 68, 58),
  Cost_Multiple = c(1.5, 2.2, 1.8, 2.0)
)

htr_strategies %&gt;%
  kable(caption = "Strategies for Hard-to-Reach Groups")
```



Table: Strategies for Hard-to-Reach Groups

|Group            |Strategy            | Success_Rate| Cost_Multiple|
|:----------------|:-------------------|------------:|-------------:|
|Young males      |Evening/online      |           45|           1.5|
|High income      |Executive approach  |           52|           2.2|
|Elderly isolated |Trusted interviewer |           68|           1.8|
|Migrants         |Multilingual        |           58|           2.0|

---

# Slide 269: Response Quality Check

### Not All Responses Equal


``` r
# Response quality indicators (Eurostat Doc 65 8.8)
quality_indicators &lt;- tibble(
  Indicator = c("Item non-response", "Straight-lining", 
                "Interview duration", "Inconsistencies"),
  Threshold = c("&lt;5%", "&lt;2%", "±30% of median", "&lt;3%"),
  Action = c("Follow-up", "Review", "Investigate", "Verify")
)

quality_indicators %&gt;%
  kable(caption = "Eurostat Response Quality Standards")
```



Table: Eurostat Response Quality Standards

|Indicator          |Threshold      |Action      |
|:------------------|:--------------|:-----------|
|Item non-response  |&lt;5%            |Follow-up   |
|Straight-lining    |&lt;2%            |Review      |
|Interview duration |±30% of median |Investigate |
|Inconsistencies    |&lt;3%            |Verify      |

"High response rate ≠ High quality"

---

# Slide 270: Cultural Considerations

### UN Guidelines for Diverse Contexts


``` r
# Cultural adaptations for response
cultural_factors &lt;- tibble(
  Context = c("Religious communities", "Indigenous groups",
              "Conflict-affected", "Gender-restricted"),
  Adaptation = c("Religious leader endorsement", "Community protocol",
                "Security clearance", "Same-gender interviewers"),
  Impact = c("+20% RR", "+25% RR", "+15% RR", "+30% RR"),
  Reference = c("UN 8.9.1", "UN 8.9.2", "UN 8.9.3", "UN 8.9.4")
)

cultural_factors %&gt;%
  kable(caption = "UN Cultural Response Adaptations")
```



Table: UN Cultural Response Adaptations

|Context               |Adaptation                   |Impact  |Reference |
|:---------------------|:----------------------------|:-------|:---------|
|Religious communities |Religious leader endorsement |+20% RR |UN 8.9.1  |
|Indigenous groups     |Community protocol           |+25% RR |UN 8.9.2  |
|Conflict-affected     |Security clearance           |+15% RR |UN 8.9.3  |
|Gender-restricted     |Same-gender interviewers     |+30% RR |UN 8.9.4  |

---

# Slide 271: Crisis Management Story

### 2020 - Pandemic Response Crisis

"National survey scheduled March 2020. Face-to-face impossible."

**Emergency Pivot:**
- Week 1: Suspend field operations
- Week 2: Design phone follow-up
- Week 3: Train remote interviewing
- Week 4: Launch mixed-mode

**Result:** 61% response rate achieved

"Flexibility saved the survey"

---

# Slide 272: Phone Survey Response

### Different Game Entirely

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/phone-response-1.png" width="100%" /&gt;

---

# Slide 273: Web Survey Response

### Modern Challenge


``` r
# Web survey response strategies (OECD 2024)
web_strategies &lt;- tibble(
  Strategy = c("Email invite only", "+ Postal invite", 
               "+ SMS reminder", "+ Phone prompt", "+ Incentive"),
  Response_Rate = c(12, 18, 23, 31, 38),
  Days_to_Complete = c(21, 18, 15, 12, 10),
  Cost_Per = c(5, 8, 10, 18, 25)
)

web_strategies %&gt;%
  kable(caption = "Web Survey Response Building")
```



Table: Web Survey Response Building

|Strategy          | Response_Rate| Days_to_Complete| Cost_Per|
|:-----------------|-------------:|----------------:|--------:|
|Email invite only |            12|               21|        5|
|+ Postal invite   |            18|               18|        8|
|+ SMS reminder    |            23|               15|       10|
|+ Phone prompt    |            31|               12|       18|
|+ Incentive       |            38|               10|       25|

---

# Slide 274: Adaptive Design

### Eurostat Innovation


``` r
# Adaptive design protocol (Eurostat 2024)
adaptive_rules &lt;- tibble(
  Week = 1:4,
  Response_Rate = c(25, 40, 52, 60),
  Action = c("Continue as planned",
             "Increase evening calls",
             "Add incentive for refusals",
             "Focus on high-priority only"),
  Resources = c("100%", "100%", "120%", "80%")
)

adaptive_rules %&gt;%
  kable(caption = "Eurostat Adaptive Design Rules")
```



Table: Eurostat Adaptive Design Rules

| Week| Response_Rate|Action                      |Resources |
|----:|-------------:|:---------------------------|:---------|
|    1|            25|Continue as planned         |100%      |
|    2|            40|Increase evening calls      |100%      |
|    3|            52|Add incentive for refusals  |120%      |
|    4|            60|Focus on high-priority only |80%       |

"Adjust strategy based on results"

---

# Slide 275: Response Propensity Modeling

### Advanced Targeting


``` r
# Model response propensity for targeting
library(randomForest)

# Build model on previous survey
response_model &lt;- randomForest(
  responded ~ age + gender + urban + education + 
             housing_type + previous_response,
  data = historical_data,
  importance = TRUE
)

# Predict for current survey
frame$response_propensity &lt;- predict(response_model, frame)

# Prioritize low-propensity cases
priority_cases &lt;- frame %&gt;%
  filter(response_propensity &lt; 0.5) %&gt;%
  arrange(response_propensity)
```

---

# Slide 276: Paradata Analysis

### Learning from Process Data


``` r
# Paradata insights (World Bank standard)
paradata_analysis &lt;- tibble(
  Metric = c("Best contact time", "Avg attempts needed",
             "Doorstep duration", "Refusal topics"),
  Finding = c("17:00-19:00", "3.2", "48 seconds", "Time &amp; privacy"),
  Action = c("Schedule accordingly", "Plan for 4 attempts",
            "Train on intro", "Address in script")
)

paradata_analysis %&gt;%
  kable(caption = "Paradata-Driven Improvements")
```



Table: Paradata-Driven Improvements

|Metric              |Finding        |Action               |
|:-------------------|:--------------|:--------------------|
|Best contact time   |17:00-19:00    |Schedule accordingly |
|Avg attempts needed |3.2            |Plan for 4 attempts  |
|Doorstep duration   |48 seconds     |Train on intro       |
|Refusal topics      |Time &amp; privacy |Address in script    |

---

# Slide 277: Cost of Non-Response

### Economic Analysis

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/cost-nr-1.png" width="100%" /&gt;

---

# Slide 278: Response Bias Analysis

### Who's Missing?


``` r
# Analyze response bias
response_bias &lt;- tibble(
  Characteristic = c("Young adults", "High income", "Urban males", "Minorities"),
  Population_Pct = c(25, 20, 18, 15),
  Sample_Pct = c(12, 14, 13, 11),
  Bias = (Sample_Pct - Population_Pct) / Population_Pct * 100
)

response_bias %&gt;%
  mutate(Bias = paste0(round(Bias, 1), "%")) %&gt;%
  kable(caption = "Response Bias Assessment")
```



Table: Response Bias Assessment

|Characteristic | Population_Pct| Sample_Pct|Bias   |
|:--------------|--------------:|----------:|:------|
|Young adults   |             25|         12|-52%   |
|High income    |             20|         14|-30%   |
|Urban males    |             18|         13|-27.8% |
|Minorities     |             15|         11|-26.7% |

"Large bias = weight adjustment critical"

---

# Slide 279: Documentation Requirements

### International Standards


``` r
# Non-response documentation required
nr_documentation &lt;- tibble(
  Component = c("Contact attempts", "Response rates by strata",
                "Refusal reasons", "Bias analysis",
                "Adjustment methods", "Quality checks"),
  WB = c("Required", "Required", "Required", "Required", "Required", "Optional"),
  Eurostat = c("Required", "Required", "Required", "Required", "Required", "Required"),
  Pages = c(2, 3, 2, 4, 5, 2)
)

nr_documentation %&gt;%
  kable(caption = "Non-Response Documentation Standards")
```



Table: Non-Response Documentation Standards

|Component                |WB       |Eurostat | Pages|
|:------------------------|:--------|:--------|-----:|
|Contact attempts         |Required |Required |     2|
|Response rates by strata |Required |Required |     3|
|Refusal reasons          |Required |Required |     2|
|Bias analysis            |Required |Required |     4|
|Adjustment methods       |Required |Required |     5|
|Quality checks           |Optional |Required |     2|

---

# Slide 280: Success Metrics

### Achieving Quality Response


``` r
# Response quality metrics
success_metrics &lt;- tibble(
  Metric = c("Overall RR", "Minimum stratum RR", "Contact rate",
             "Cooperation rate", "Refusal rate", "Unable rate"),
  Target = c("≥70%", "≥60%", "≥90%", "≥80%", "≤15%", "≤5%"),
  Achieved = c("72%", "61%", "91%", "79%", "14%", "6%"),
  Status = c("✓", "✓", "✓", "~", "✓", "~")
)

success_metrics %&gt;%
  kable(caption = "Response Quality Dashboard")
```



Table: Response Quality Dashboard

|Metric             |Target |Achieved |Status |
|:------------------|:------|:--------|:------|
|Overall RR         |≥70%   |72%      |✓      |
|Minimum stratum RR |≥60%   |61%      |✓      |
|Contact rate       |≥90%   |91%      |✓      |
|Cooperation rate   |≥80%   |79%      |~      |
|Refusal rate       |≤15%   |14%      |✓      |
|Unable rate        |≤5%    |6%       |~      |

---

# Slide 281: Interviewer Performance

### Individual Tracking

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/interviewer-perf-1.png" width="100%" /&gt;

---

# Slide 282: Seasonal Effects
# Slide 283: Legal Framework

### Data Protection Impact


``` r
# Legal requirements affecting response
legal_impact &lt;- tibble(
  Region = c("EU/GDPR", "USA", "Asia-Pacific", "Africa"),
  Consent_Required = c("Explicit", "Implied OK", "Varies", "Minimal"),
  Impact_on_RR = c("-15%", "-5%", "-8%", "-2%"),
  Compliance_Cost = c("High", "Medium", "Medium", "Low")
)

legal_impact %&gt;%
  kable(caption = "Legal Framework Impact on Response")
```



Table: Legal Framework Impact on Response

|Region       |Consent_Required |Impact_on_RR |Compliance_Cost |
|:------------|:----------------|:------------|:---------------|
|EU/GDPR      |Explicit         |-15%         |High            |
|USA          |Implied OK       |-5%          |Medium          |
|Asia-Pacific |Varies           |-8%          |Medium          |
|Africa       |Minimal          |-2%          |Low             |

"GDPR changed everything in Europe"

---

# Slide 284: Response in Conflict Areas

### UN Emergency Protocol


``` r
# UN conflict area response strategies
conflict_protocol &lt;- tibble(
  Security_Level = c("1-Minimal", "2-Moderate", "3-Substantial", "4-High", "5-Extreme"),
  Mode = c("Standard F2F", "Quick F2F", "Phone primary", "Remote only", "Postpone"),
  Expected_RR = c("70%", "60%", "45%", "30%", "0%"),
  UN_Guidance = c("Proceed", "Caution", "Adapt", "Remote", "Wait")
)

conflict_protocol %&gt;%
  kable(caption = "UN Security Level Response Protocols")
```



Table: UN Security Level Response Protocols

|Security_Level |Mode          |Expected_RR |UN_Guidance |
|:--------------|:-------------|:-----------|:-----------|
|1-Minimal      |Standard F2F  |70%         |Proceed     |
|2-Moderate     |Quick F2F     |60%         |Caution     |
|3-Substantial  |Phone primary |45%         |Adapt       |
|4-High         |Remote only   |30%         |Remote      |
|5-Extreme      |Postpone      |0%          |Wait        |

---

# Slide 285: Youth Response Crisis

### The Under-30 Challenge

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/youth-response-1.png" width="100%" /&gt;

---

# Slide 286: Panel Attrition

### Longitudinal Challenge


``` r
# Panel survey attrition (World Bank LSMS Panel)
panel_attrition &lt;- tibble(
  Wave = 1:5,
  Original_Sample = 5000,
  Remaining = c(5000, 4250, 3750, 3400, 3150),
  Attrition_Rate = c(0, 15, 25, 32, 37),
  Refreshment = c(0, 0, 500, 0, 600)
) %&gt;%
  mutate(
    Total_Sample = Remaining + Refreshment
  )

panel_attrition %&gt;%
  kable(caption = "LSMS Panel Attrition Management")
```



Table: LSMS Panel Attrition Management

| Wave| Original_Sample| Remaining| Attrition_Rate| Refreshment| Total_Sample|
|----:|---------------:|---------:|--------------:|-----------:|------------:|
|    1|            5000|      5000|              0|           0|         5000|
|    2|            5000|      4250|             15|           0|         4250|
|    3|            5000|      3750|             25|         500|         4250|
|    4|            5000|      3400|             32|           0|         3400|
|    5|            5000|      3150|             37|         600|         3750|

---

# Slide 287: Response Quality Scores

### Comprehensive Assessment


``` r
# Response quality scoring system
quality_scoring &lt;- tibble(
  Component = c("Response rate", "Item completion", "Straight-lining",
                "Duration appropriate", "Consistency"),
  Weight = c(0.40, 0.20, 0.15, 0.15, 0.10),
  Score = c(85, 92, 95, 88, 90),
  Weighted = Weight * Score
)

quality_scoring %&gt;%
  mutate(Weighted = round(Weighted, 1)) %&gt;%
  kable(caption = "Response Quality Composite Score")
```



Table: Response Quality Composite Score

|Component            | Weight| Score| Weighted|
|:--------------------|------:|-----:|--------:|
|Response rate        |   0.40|    85|     34.0|
|Item completion      |   0.20|    92|     18.4|
|Straight-lining      |   0.15|    95|     14.2|
|Duration appropriate |   0.15|    88|     13.2|
|Consistency          |   0.10|    90|      9.0|

``` r
total_score &lt;- sum(quality_scoring$Weighted)
print(paste("Total Quality Score:", round(total_score, 1), "/ 100"))
```

```
## [1] "Total Quality Score: 88.8 / 100"
```

---

# Slide 288: Exercise - Response Plan

### Design Your Response Strategy


``` r
# Your survey parameters
survey_params &lt;- list(
  target_n = 3000,
  budget_response = 50000,
  urban_pct = 60,
  young_adult_pct = 35
)

# Design response strategy:
# 1. Contact attempts?
# 2. Incentive level?
# 3. Mode sequence?
# 4. Special protocols?

print("Design comprehensive response strategy")
```

```
## [1] "Design comprehensive response strategy"
```

``` r
# Solution in module6_response_plan.R
```

---

# Slide 289: Real Success Story

### 2023 - Response Rate Turnaround

"Southeast European country. Initial RR: 42%. Final: 74%."

**What Worked:**
1. Community leader engagement
2. Local language materials
3. Evening/weekend focus
4. €10 shopping voucher
5. Trusted local interviewers
6. Government endorsement

"Strategic approach saved the survey"

---

# Slide 290: Response Prediction Model

### Early Warning System


``` r
# Early response prediction
early_indicators &lt;- tibble(
  Indicator = c("Day 3 RR", "Contact rate", "Hard refusal %",
                "Appointments made", "Web starts"),
  Value = c(15, 45, 8, 22, 12),
  Benchmark = c(18, 50, 5, 25, 15),
  Signal = c("Warning", "Warning", "Alert", "Warning", "Warning")
)

early_indicators %&gt;%
  kable(caption = "Early Warning Response Indicators")
```



Table: Early Warning Response Indicators

|Indicator         | Value| Benchmark|Signal  |
|:-----------------|-----:|---------:|:-------|
|Day 3 RR          |    15|        18|Warning |
|Contact rate      |    45|        50|Warning |
|Hard refusal %    |     8|         5|Alert   |
|Appointments made |    22|        25|Warning |
|Web starts        |    12|        15|Warning |

"Day 3 predicts final response"

---

# Slide 291: Response Budgeting

### Cost Allocation

&lt;img src="Day2_Complex_Survey_Designs_files/figure-html/response-budget-1.png" width="100%" /&gt;

---

# Slide 292: International Comparison

### Response Standards Worldwide


``` r
# International response rate standards
international_rr &lt;- tibble(
  Organization = c("Eurostat", "World Bank", "OECD", "UN", "WHO"),
  Minimum_RR = c(70, 70, 70, 65, 80),
  Acceptable = c(60, 65, 65, 60, 70),
  Crisis = c(50, 55, 55, 50, 60),
  Year_Updated = c(2023, 2024, 2023, 2022, 2021)
)

international_rr %&gt;%
  kable(caption = "International Response Rate Standards (%)")
```



Table: International Response Rate Standards (%)

|Organization | Minimum_RR| Acceptable| Crisis| Year_Updated|
|:------------|----------:|----------:|------:|------------:|
|Eurostat     |         70|         60|     50|         2023|
|World Bank   |         70|         65|     55|         2024|
|OECD         |         70|         65|     55|         2023|
|UN           |         65|         60|     50|         2022|
|WHO          |         80|         70|     60|         2021|

---

# Slide 293: Mixed-Mode Integration

### Unified Response Strategy


``` r
# Integrated mixed-mode design
mode_integration &lt;- tibble(
  Week = 1:6,
  Primary = c("Web", "Web", "Phone", "Phone", "F2F", "F2F"),
  Support = c("Email", "Mail", "SMS", "Email", "Phone", "All"),
  Expected_RR = c(15, 28, 42, 55, 68, 73),
  Cost_Cumulative = c(10, 18, 35, 52, 85, 110)
)

mode_integration %&gt;%
  kable(caption = "Sequential Mixed-Mode Implementation")
```



Table: Sequential Mixed-Mode Implementation

| Week|Primary |Support | Expected_RR| Cost_Cumulative|
|----:|:-------|:-------|-----------:|---------------:|
|    1|Web     |Email   |          15|              10|
|    2|Web     |Mail    |          28|              18|
|    3|Phone   |SMS     |          42|              35|
|    4|Phone   |Email   |          55|              52|
|    5|F2F     |Phone   |          68|              85|
|    6|F2F     |All     |          73|             110|

---

# Slide 294: Final Push Strategies

### Last Week Tactics


``` r
# Final week response strategies
final_push &lt;- tibble(
  Day = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"),
  Strategy = c("Double incentive", "Senior converters", "Community appeal",
               "Extended hours", "Last chance message"),
  Expected_Gain = c("+2.5%", "+1.8%", "+1.2%", "+1.5%", "+2.0%"),
  Cost = c("$$", "$", "$", "$", "$")
)

final_push %&gt;%
  kable(caption = "Final Week Response Push")
```



Table: Final Week Response Push

|Day       |Strategy            |Expected_Gain |Cost |
|:---------|:-------------------|:-------------|:----|
|Monday    |Double incentive    |+2.5%         |$$   |
|Tuesday   |Senior converters   |+1.8%         |$    |
|Wednesday |Community appeal    |+1.2%         |$    |
|Thursday  |Extended hours      |+1.5%         |$    |
|Friday    |Last chance message |+2.0%         |$    |

"Last week can add 8-10% RR"

---

# Slide 295: Response Documentation

### Required Reporting


``` r
# Response documentation checklist
response_docs &lt;- tibble(
  Section = c("Contact protocol", "Response rates by strata",
              "Refusal analysis", "Bias assessment",
              "Quality indicators", "Lessons learned"),
  Pages = c(3, 4, 3, 5, 3, 2),
  Required_By = c("All", "All", "Eurostat/WB", "All", "Eurostat", "WB")
)

response_docs %&gt;%
  kable(caption = "Response Documentation Requirements")
```



Table: Response Documentation Requirements

|Section                  | Pages|Required_By |
|:------------------------|-----:|:-----------|
|Contact protocol         |     3|All         |
|Response rates by strata |     4|All         |
|Refusal analysis         |     3|Eurostat/WB |
|Bias assessment          |     5|All         |
|Quality indicators       |     3|Eurostat    |
|Lessons learned          |     2|WB          |

---

# Slide 296: Response Technology Future

### Emerging Solutions 2025

**Coming Soon:**
- AI-optimized contact timing
- Chatbot pre-screening
- Facial recognition verification
- Blockchain incentive delivery
- VR interview environments

"Technology will transform response"

---

# Slide 297: Key Response Lessons

### 25 Years of Experience

1. **First contact is crucial** - train extensively
2. **Timing matters** - evenings and weekends
3. **Local trust essential** - community engagement
4. **Incentives work** - but diminishing returns
5. **Monitor daily** - early intervention critical
6. **Document everything** - for next time

---

# Slide 298: Your Response Checklist

### Before Launching

✅ Contact protocol defined
✅ Incentive strategy clear
✅ Training completed
✅ Materials translated
✅ Community engaged
✅ Monitoring system ready
✅ Intervention triggers set
✅ Documentation plan ready

---

# Slide 299: Module 6 Summary

### Response Rate Mastery Achieved

**You Now Understand:**
- Modern response challenges
- Evidence-based strategies
- International standards
- Cost-benefit trade-offs
- Quality vs quantity balance

"Good response rate = credible survey"

---

# Slide 300: Module 6 Complete!

### Non-Response Solutions Mastered

**Competencies Gained:**
- ✓ Design response strategies
- ✓ Apply international standards
- ✓ Monitor and intervene
- ✓ Handle hard-to-reach groups
- ✓ Document properly

.practice-box[
**10-Minute Break**

Next: Module 7 - Special Populations
Following WHO/UN Special Protocols
]

---

class: inverse, center, middle

# End of Module 6
## Response Rate Excellence Achieved

### "70% response rate is the new 90%"

---

class: inverse, center, middle

# Slide 301: Module 7 Introduction

### Tuesday 3:30 PM - Special Populations

Harry after the break:

"Standard methods fail for special populations.
This module covers WHO protocols, UN guidelines,
and real solutions that work."

**Coverage:**
- Nomadic populations
- Urban homeless
- Institutional populations
- Refugee/IDP camps
- Remote islands
- Conflict zones

*Reference: WHO Technical Note 2024/3*

---

# Slide 302: Why Special Methods Needed

### Standard Assumptions Violated

```r
# Standard survey assumptions vs special populations
assumptions_violated &lt;- tibble(
  Assumption = c("Fixed address", "Accessible", "Stable location",
                "Single household", "Regular schedule"),
  Standard_Pop = c("Yes", "Yes", "Yes", "Yes", "Yes"),
  Nomadic = c("No", "Varies", "No", "Complex", "No"),
  Homeless = c("No", "No", "No", "No", "No"),
  Refugee = c("Temporary", "Restricted", "No", "Variable", "No")
)

assumptions_violated %&gt;%
  kable(caption = "Why Standard Methods Fail")
```

---

# Slide 303: Nomadic Populations

### WHO/UN Joint Protocol

```r
# Nomadic population sampling framework
nomadic_design &lt;- tibble(
  Stage = c("1: Migration routes", "2: Water points", 
            "3: Time periods", "4: Households"),
  Selection = c("All major routes", "PPS by usage",
               "Random times", "Random at location"),
  Frame_Source = c("Government maps", "Local knowledge",
                  "24-hour cycle", "On-site listing"),
  Challenge = c("Seasonal variation", "Access", 
               "Timing", "Definition")
)

nomadic_design %&gt;%
  kable(caption = "WHO Nomadic Population Design")
```

---

# Slide 304: Time-Location Sampling

### For Mobile Populations

```r
# Time-location sampling (TLS) design
tls_design &lt;- function(venues, time_blocks, target_n) {
  # Create venue-time units (VTU)
  vtu_frame &lt;- expand.grid(
    venue = venues,
    day = c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"),
    time = c("Morning", "Afternoon", "Evening", "Night")
  ) %&gt;%
    mutate(
      expected_traffic = sample(10:100, n(), replace = TRUE),
      selection_prob = expected_traffic / sum(expected_traffic)
    )
  
  # Select VTUs with PPS
  n_vtu &lt;- ceiling(target_n / 15)  # Assume 15 per VTU
  
  return(list(
    frame_size = nrow(vtu_frame),
    vtu_needed = n_vtu,
    expected_yield = n_vtu * 15
  ))
}

# Example for homeless population
tls_design(venues = 5, time_blocks = 4, target_n = 300)
```

---

# Slide 305: Urban Homeless

### UN-Habitat Method

```r
# Urban homeless enumeration strategy
homeless_strategy &lt;- tibble(
  Component = c("Service points", "Street counts", "Camps/settlements",
               "Hidden homeless", "Doubled-up"),
  Method = c("Facility sampling", "Area enumeration", "Census",
            "RDS/Snowball", "Household screening"),
  Coverage = c("60%", "25%", "10%", "Unknown", "5%"),
  Quality = c("Good", "Fair", "Good", "Poor", "Fair")
)

homeless_strategy %&gt;%
  kable(caption = "UN-Habitat Homeless Coverage Strategy")
```

---

# Slide 306: Service-Based Sampling

### Reaching Through Services

```r
# Service-based sampling for hard-to-reach
service_sampling &lt;- tibble(
  Service = c("Health clinics", "Food banks", "Shelters",
             "Day centers", "Mobile services"),
  Population = c("General poor", "Food insecure", "Homeless",
                "Homeless", "Remote"),
  Sampling_Unit = c("Patient visits", "Client visits", "Bed-nights",
                   "Daily attendance", "Service stops"),
  Typical_n = c("50-100/day", "100-200/day", "30-50/night",
               "20-40/day", "10-20/stop")
)

service_sampling %&gt;%
  kable(caption = "Service-Based Sampling Options")
```

---

# Slide 307: Institutional Populations

### WHO Institutional Protocol

```r
# Institutional population framework
institutional_frame &lt;- tibble(
  Type = c("Hospitals", "Prisons", "Military", "Elderly homes",
          "Boarding schools", "Work camps"),
  Sampling_Level = c("Ward", "Block", "Unit", "Room",
                    "Dormitory", "Section"),
  Access = c("Ethics approval", "Justice ministry", "Defense",
            "Facility", "Education ministry", "Labor"),
  Typical_Issues = c("Consent", "Security", "Hierarchy",
                    "Capacity", "Minors", "Rights")
)

institutional_frame %&gt;%
  kable(caption = "WHO Institutional Sampling Framework")
```

---

# Slide 308: Refugee/IDP Camps

### UNHCR Standard Method

```r
# UNHCR camp sampling protocol
camp_sampling &lt;- tibble(
  Stage = c("1: Camps/settlements", "2: Zones/blocks", 
           "3: Shelters", "4: Individuals"),
  Frame = c("UNHCR register", "Camp management", 
           "Zone leaders", "Shelter listing"),
  Selection = c("All or PPS", "Systematic", "Random", "All or random"),
  Challenges = c("New arrivals", "Irregular layout", 
                "Multiple families", "Absent members")
)

camp_sampling %&gt;%
  kable(caption = "UNHCR Camp Sampling Protocol")
```

---

# Slide 309: Real Crisis - Syria 2019

### Sampling in Active Conflict

"2019 - Need health data from conflict zone.
No access, no frame, no safety."

**Solution:**
- Remote sensing for population
- WhatsApp for data collection
- Local health workers as interviewers
- Audio consent process
- Real-time monitoring

**Result:** 73% response rate, validated data

*Published: Lancet Global Health 2020*

---

# Slide 310: Respondent-Driven Sampling

### For Hidden Populations

```r
# RDS implementation for hidden populations
rds_implementation &lt;- function(seeds = 10, waves = 6, coupons = 3) {
  # Calculate expected sample
  expected_sample &lt;- seeds * (coupons ^ waves - 1) / (coupons - 1)
  
  # Realistic recruitment (60% efficiency)
  realistic_sample &lt;- expected_sample * 0.6
  
  # Calculate design effect (typically 2-4 for RDS)
  deff_rds &lt;- 2.5
  effective_n &lt;- realistic_sample / deff_rds
  
  return(list(
    seeds = seeds,
    waves = waves,
    coupons = coupons,
    theoretical_n = expected_sample,
    expected_n = realistic_sample,
    effective_n = effective_n
  ))
}

rds_implementation(seeds = 10, waves = 5, coupons = 3)
```

---

# Slide 311: RDS Weight Calculation

### Volz-Heckathorn Estimator

```r
# RDS weight calculation (simplified)
rds_weights &lt;- function(degree, recruitment_matrix) {
  # Degree = network size of respondent
  # Basic RDS weight inversely proportional to degree
  
  weights &lt;- tibble(
    respondent_id = 1:length(degree),
    network_size = degree,
    base_weight = 1 / degree,
    normalized_weight = base_weight / mean(base_weight)
  )
  
  # In practice, use RDS Analyst or similar
  return(weights)
}

# Example
degrees &lt;- c(5, 10, 3, 15, 8, 20, 4, 12, 6, 9)
rds_weights(degrees, recruitment_matrix = NULL)
```

---

# Slide 312: Island Populations

### Pacific Island Methods

```r
# Island population challenges and solutions
island_sampling &lt;- tibble(
  Challenge = c("Geographic isolation", "Small populations",
               "Transport costs", "Weather dependency",
               "Cultural protocols"),
  Solution = c("Cluster islands", "Census for small",
              "Boat schedule coordination", "Seasonal planning",
              "Chief engagement first"),
  Example = c("Group 3-4 nearby", "Census if &lt;500",
             "Monthly supply boat", "Dry season only",
             "2-week lead time")
)

island_sampling %&gt;%
  kable(caption = "Pacific Island Sampling Solutions")
```

---

# Slide 313: Remote Area Sampling

### Extreme Geography

```r
# Remote area cost-quality trade-off
remote_options &lt;- tibble(
  Method = c("Full coverage", "Accessible only", "Hub sampling",
            "Proxy reporting", "Satellite + ground"),
  Coverage = c("100%", "60%", "75%", "85%", "95%"),
  Cost_Index = c(500, 100, 150, 120, 200),
  Quality = c("Excellent", "Biased", "Good", "Fair", "Good"),
  Time_Months = c(6, 2, 3, 2, 4)
)

remote_options %&gt;%
  kable(caption = "Remote Area Sampling Options")
```

---

# Slide 314: Indigenous Populations

### Culturally Appropriate Methods

```r
# Indigenous population protocols
indigenous_protocol &lt;- tibble(
  Step = c("1: Permission", "2: Partnership", "3: Training",
          "4: Translation", "5: Adaptation", "6: Return"),
  Action = c("Tribal council approval", "Local co-researchers",
            "Cultural sensitivity", "Local languages",
            "Relevant questions", "Share results"),
  Timeline = c("Month -3", "Month -2", "Month -1",
              "Month -1", "Month 0", "Month +6"),
  Critical = c("Yes", "Yes", "Yes", "Yes", "Yes", "Yes")
)

indigenous_protocol %&gt;%
  kable(caption = "Indigenous Population Protocol")
```

---

# Slide 315: Mining Communities

### Temporary Worker Populations

```r
# Mining community sampling design
mining_design &lt;- tibble(
  Population = c("Permanent staff", "Contract workers",
                "Informal miners", "Support services",
                "Families"),
  Frame_Source = c("Company HR", "Contractor lists",
                  "Site registration", "Business permits",
                  "Housing records"),
  Access = c("Easy", "Moderate", "Difficult",
            "Moderate", "Easy"),
  Mobility = c("Low", "High", "Very high", "Moderate", "Low")
)

mining_design %&gt;%
  kable(caption = "Mining Community Sampling Framework")
```

---

# Slide 316: Border Populations

### Cross-Border Challenges

```r
# Border population methodology
border_method &lt;- tibble(
  Issue = c("Dual residence", "Daily crossing", "Seasonal migration",
           "Trade corridors", "Informal crossings"),
  Solution = c("Time-location", "Peak hours sampling",
              "Multi-season", "Market days",
              "Community informants"),
  Coordination = c("Bilateral", "Local only", "Bilateral",
                  "Local", "Informal")
)

border_method %&gt;%
  kable(caption = "Border Population Solutions")
```

---

# Slide 317: Student Populations

### Educational Institution Sampling

```r
# Student population framework
student_sampling &lt;- tibble(
  Level = c("Primary", "Secondary", "Tertiary",
           "Vocational", "Non-formal"),
  Frame = c("Education ministry", "School lists",
           "University registry", "Training centers",
           "NGO records"),
  Design = c("2-stage: school-class", "2-stage: school-class",
            "Stratified by faculty", "Census small centers",
            "Venue-based"),
  Issues = c("Attendance", "Dropouts", "Part-time",
           "Completion rates", "Irregular")
)

student_sampling %&gt;%
  kable(caption = "Education Sector Sampling")
```

---

# Slide 318: Sex Workers

### Sensitive Population Methods

```r
# Sensitive population approach (WHO/UNAIDS)
sensitive_approach &lt;- tibble(
  Method = c("Venue-based", "RDS", "Web-based",
            "Service-based", "Mixed"),
  Advantages = c("Known locations", "Hidden reached",
                "Anonymous", "Health link", "Comprehensive"),
  Challenges = c("Visible only", "Long chains", "Tech bias",
                "Service users only", "Complex"),
  Typical_RR = c("60%", "NA", "40%", "70%", "55%")
)

sensitive_approach %&gt;%
  kable(caption = "Sensitive Population Methods")
```

---

# Slide 319: Elderly Isolated

### Reaching Isolated Elderly

```r
# Isolated elderly strategies
elderly_strategies &lt;- tibble(
  Strategy = c("Health records", "Social services",
              "Community health workers", "Pension lists",
              "Religious groups"),
  Coverage = c("Registered only", "At-risk only",
              "Known to CHW", "Pensioners only",
              "Active members"),
  Quality = c("Good", "Good", "Variable", "Excellent", "Fair"),
  Ethics = c("Consent complex", "Vulnerable", "Trust high",
            "Privacy concern", "Voluntary")
)

elderly_strategies %&gt;%
  kable(caption = "Reaching Isolated Elderly")
```

---

# Slide 320: Tuesday 4:00 PM Check

### Energy and Understanding

Harry checks the room:

"Complex populations, complex methods.
Everyone following? Questions?

Remember: Every population can be sampled,
but not with standard methods.

Let's continue - crisis management next."

*Room engaged despite late hour*

---

# Slide 321: Children in Research

### Special Protections Required

```r
# Child population protocols (UNICEF)
child_protocols &lt;- tibble(
  Age_Group = c("0-4", "5-9", "10-14", "15-17"),
  Respondent = c("Parent/caregiver", "Parent + observation",
                "Parent + child", "Adolescent + parent"),
  Consent = c("Parent only", "Parent only",
             "Parent + assent", "Both required"),
  Special_Training = c("Child development", "Child friendly",
                      "Child safeguarding", "Adolescent approach")
)

child_protocols %&gt;%
  kable(caption = "UNICEF Age-Appropriate Protocols")
```

---

# Slide 322: Disability Inclusion

### Washington Group Methods

```r
# Disability-inclusive sampling
disability_inclusion &lt;- tibble(
  Component = c("Frame identification", "Accessibility",
               "Communication", "Accommodation",
               "Proxy options"),
  Standard_Method = c("Household screen", "Physical access",
                     "Verbal only", "Standard time",
                     "Not allowed"),
  Inclusive_Method = c("Multiple sources", "Multiple modes",
                      "Multi-format", "Flexible timing",
                      "Permitted with rules")
)

disability_inclusion %&gt;%
  kable(caption = "Washington Group Disability Inclusion")
```

---

# Slide 323: Combining Methods

### Mixed Approaches for Coverage

```r
# Combined methods for complete coverage
combined_approach &lt;- function(target_pop, methods) {
  coverage_matrix &lt;- tibble(
    Method = c("Standard HH", "TLS", "RDS", "Service"),
    Coverage_Pct = c(70, 15, 10, 5),
    Quality = c("High", "Medium", "Medium", "High"),
    Cost_Per = c(50, 80, 100, 40)
  )
  
  total_coverage &lt;- sum(coverage_matrix$Coverage_Pct)
  weighted_cost &lt;- weighted.mean(coverage_matrix$Cost_Per, 
                                 coverage_matrix$Coverage_Pct)
  
  return(list(
    coverage = total_coverage,
    average_cost = weighted_cost,
    methods_needed = nrow(coverage_matrix)
  ))
}

combined_approach(target_pop = "Urban poor", methods = 4)
```

---

# Slide 324: Quality in Special Populations

### Maintaining Standards

```r
# Quality indicators for special populations
quality_special &lt;- tibble(
  Indicator = c("Coverage of target", "Response rate",
               "Data completeness", "Validation possible",
               "Replicability"),
  Standard_Pop = c("95%", "70%", "98%", "Yes", "High"),
  Special_Pop = c("Unknown", "Variable", "85%", "Limited", "Moderate"),
  Acceptable = c("&gt;70%", "&gt;50%", "&gt;80%", "Some", "Document well")
)

quality_special %&gt;%
  kable(caption = "Quality Standards for Special Populations")
```

---

# Slide 325: Documentation Requirements

### Extra Documentation Needed

```r
# Additional documentation for special populations
special_documentation &lt;- tibble(
  Section = c("Population definition", "Frame construction",
             "Method justification", "Quality limitations",
             "Ethical considerations", "Lessons learned"),
  Pages = c(3, 5, 4, 3, 4, 2),
  Critical_For = c("All", "All", "All", "All",
                  "Vulnerable", "Future surveys")
)

special_documentation %&gt;%
  kable(caption = "Special Population Documentation")
```

---

# Slide 326: Exercise - Design for Homeless

### Your City's Homeless Survey

```r
# Design homeless survey for your city
your_city &lt;- list(
  estimated_homeless = 5000,
  known_shelters = 8,
  service_points = 15,
  safe_areas = 12,
  budget = 75000
)

# Design approach:
# 1. Which methods to combine?
# 2. Sample sizes for each?
# 3. Timeline?
# 4. Quality measures?

print("Design complete coverage strategy")
# Solution in module7_homeless_design.R
```

---

# Slide 327: Cost Comparison

### Special vs Standard Methods

```r
# Cost comparison for special methods
cost_comparison &lt;- tibble(
  Population = c("Standard HH", "Nomadic", "Homeless",
                "Refugee camp", "RDS hidden"),
  Cost_Per_Interview = c(50, 120, 95, 35, 85),
  Time_Per_Interview = c(45, 60, 40, 40, 90),
  Training_Days = c(5, 10, 8, 7, 12),
  Quality_Score = c(95, 85, 80, 90, 75)
)

cost_comparison %&gt;%
  kable(caption = "Special Population Cost Premiums")
```

---

# Slide 328: Success Story - Mongolia

### Nomadic Herder Success

"2018 - Mongolia herder survey. 
40% of population nomadic.
Extreme weather, vast distances."

**Solution:**
- GPS tracking of migration routes
- Seasonal rounds (4 per year)
- Local herder interviewers
- Motorcycle teams
- Satellite phone reporting

**Result:** 82% response rate, nationally representative

---

# Slide 329: Technology for Special Populations

### Digital Solutions

```r
# Technology applications for special populations
tech_solutions &lt;- tibble(
  Technology = c("GPS tracking", "Satellite imagery",
                "Mobile apps", "Biometrics",
                "Blockchain ID"),
  Application = c("Nomadic routes", "Settlement size",
                 "Self-admin", "Deduplication",
                 "Refugee ID"),
  Status = c("Operational", "Operational", "Pilot",
            "Testing", "Experimental"),
  Cost = c("$$", "$$$", "$", "$$", "$$$")
)

tech_solutions %&gt;%
  kable(caption = "Technology for Special Populations")
```

---

# Slide 330: Ethical Considerations

### Enhanced Protections

```r
# Ethical requirements for special populations
ethical_framework &lt;- tibble(
  Population = c("Children", "Prisoners", "Refugees",
                "Mental illness", "Victims"),
  Extra_Requirements = c("Parental consent", "No coercion",
                        "Do no harm", "Capacity assessment",
                        "Trauma-informed"),
  Review_Level = c("Full IRB", "Full IRB", "Full IRB",
                  "Full IRB", "Full IRB"),
  Monitor = c("Yes", "Yes", "Yes", "Yes", "Yes")
)

ethical_framework %&gt;%
  kable(caption = "Enhanced Ethical Requirements")
```

---

# Slide 331: Seasonal Populations

### Timing is Everything

```r
# Seasonal population sampling
seasonal_sampling &lt;- tibble(
  Population = c("Agricultural workers", "Tourist areas",
                "Fishing communities", "Construction",
                "Students"),
  Peak_Season = c("Harvest", "Summer", "Fishing season",
                 "Dry season", "School term"),
  Off_Season = c("Planting", "Winter", "Off-season",
                "Rainy", "Vacation"),
  Strategy = c("Sample peak", "Both seasons", "Peak only",
              "Dry only", "Term time")
)

seasonal_sampling %&gt;%
  kable(caption = "Seasonal Population Strategies")
```

---

# Slide 332: Multiple Frame Approach

### Covering All Bases

```r
# Multiple frame for complete coverage
multiple_frame &lt;- function(frames, overlap_rate = 0.2) {
  # Assuming 3 frames with overlap
  frame_coverage &lt;- c(0.6, 0.3, 0.2)  # Coverage of each frame
  
  # Account for overlap
  total_coverage &lt;- sum(frame_coverage) - overlap_rate
  
  # Sample allocation
  n_total &lt;- 1000
  allocation &lt;- n_total * frame_coverage / sum(frame_coverage)
  
  return(list(
    coverage = paste0(total_coverage * 100, "%"),
    samples = round(allocation),
    overlap_handling = "Weight adjustment needed"
  ))
}

multiple_frame(frames = 3)
```

---

# Slide 333: Validation Methods

### Checking Special Population Data

```r
# Validation approaches for special populations
validation_methods &lt;- tibble(
  Method = c("Capture-recapture", "Multiplier method",
            "Service statistics", "Satellite validation",
            "Community counts"),
  Population = c("Homeless", "Hidden", "Service users",
                "Settlements", "Small areas"),
  Validation_Type = c("Size estimate", "Size estimate",
                     "Coverage check", "Location verify",
                     "Completeness")
)

validation_methods %&gt;%
  kable(caption = "Special Population Validation")
```

---

# Slide 334: Module 7 Summary

### Special Population Mastery

You now understand:
- When standard methods fail
- Alternative sampling approaches
- Combined coverage strategies
- Quality considerations
- Ethical requirements
- Documentation needs

"Every population is surveyable with the right method"

---

# Slide 335: Key Lessons - Special Populations

### What Works

1. **No single method covers all** - combine approaches
2. **Local knowledge essential** - partner with communities
3. **Flexibility required** - adapt to conditions
4. **Extra time needed** - plan accordingly
5. **Document everything** - for credibility
6. **Expect lower quality** - but still valuable

---

# Slide 336: Quick Reference - Methods

### Special Population Quick Guide

| Population | Primary Method | Secondary | Expected RR |
|-----------|---------------|-----------|------------|
| Nomadic | Time-location | GPS tracking | 60-70% |
| Homeless | Service-based | Street count | 50-60% |
| Refugees | Camp census | Registration | 70-80% |
| Hidden | RDS | Venue-based | Variable |
| Remote | Cluster + travel | Proxy | 60-70% |

---

# Slide 337: Your Special Population Plan

### Before Implementation

✅ Define population precisely
✅ Identify all possible frames
✅ Choose combination of methods
✅ Budget for higher costs
✅ Plan extended timeline
✅ Arrange permissions/partnerships
✅ Enhance training
✅ Prepare documentation

---

# Slide 338: Module 7 Complete!

### Special Populations Conquered

**Competencies Achieved:**
- ✓ Identify when special methods needed
- ✓ Select appropriate techniques
- ✓ Design combined approaches
- ✓ Handle ethical issues
- ✓ Document properly

**Ready for:** Module 8 - Crisis Management

---

## Module 8: Crisis Management (Slides 339-400)
### Tuesday 4:30 PM - When Everything Goes Wrong

---

# Slide 339: Module 8 Introduction

### Tuesday 4:30 PM - Crisis Management

Harry's final module energy:

"Murphy's Law: What can go wrong, will.
30 years of crises taught me: 
Plan for failure, celebrate success.

This module: Real crisis management
from pandemics to coups to cyclones."

*Reference: UN Emergency Handbook 2024*

---

# Slide 340: Types of Survey Crises

### What Can Go Wrong

```r
# Crisis taxonomy from experience
crisis_types &lt;- tibble(
  Category = c("Natural", "Political", "Security",
              "Economic", "Technical", "Human"),
  Examples = c("Flood, earthquake", "Coup, election",
              "Conflict, crime", "Budget cut, inflation",
              "System failure", "Team collapse"),
  Frequency = c("10%", "5%", "8%", "15%", "20%", "25%"),
  Impact = c("High", "High", "High", "Medium", "Medium", "Low")
)

crisis_types %&gt;%
  kable(caption = "Survey Crisis Types and Frequency")
```

---

# Slide 341: The Earthquake Story

### 2015 - Nepal Earthquake During Survey

"Day 12 of 30. Magnitude 7.8 earthquake.
25% of sample areas destroyed.
8,000+ dead. Teams missing."

**Immediate Response:**
1. Account for all staff (72 hours)
2. Suspend operations
3. Assess damage
4. Redesign sample
5. Resume after 6 weeks

**Lessons:** Staff safety first, always have Plan B

---

# Slide 342: Crisis Response Framework

### UN Emergency Protocol Structure

```r
# UN crisis response levels
response_levels &lt;- tibble(
  Level = c("Green", "Yellow", "Orange", "Red", "Black"),
  Situation = c("Normal", "Caution", "Alert", "Crisis", "Suspend"),
  Operations = c("100%", "Continue carefully", "Limited",
                "Emergency only", "Stop"),
  Decision = c("Field", "Manager", "Director", "Ministry", "Cabinet"),
  Timeline = c("NA", "24hr review", "12hr review",
              "Immediate", "Immediate")
)

response_levels %&gt;%
  kable(caption = "UN Crisis Response Levels")
```

---

# Slide 343: Budget Crisis Management

### When Funding Cuts Hit

```r
# Budget cut response options
budget_options &lt;- tibble(
  Cut_Level = c("10%", "25%", "40%", "50%", "&gt;50%"),
  Option_1 = c("Reduce incentives", "Reduce sample 20%",
              "Drop rural", "Phone only", "Postpone"),
  Option_2 = c("Reduce attempts", "Reduce domains",
              "Urban only", "Web only", "Cancel"),
  Quality_Impact = c("Minimal", "Acceptable", "Serious",
                    "Major", "Fatal"),
  Credibility = c("Maintained", "Maintained", "Questioned",
                 "Damaged", "Lost")
)

budget_options %&gt;%
  kable(caption = "Budget Crisis Response Options")
```

---

# Slide 344: Pandemic Protocol

### COVID-19 Lessons Learned

```r
# Pandemic adaptation strategies
pandemic_protocol &lt;- tibble(
  Phase = c("Lockdown", "Restricted", "Cautious", "New normal"),
  Mode = c("Phone/web only", "Phone primary", "Mixed mode",
          "F2F with protection"),
  Sample_Adj = c("Panel if available", "Reduce rural",
                "Gradual return", "Full sample"),
  Cost_Impact = c("+20%", "+15%", "+10%", "+5%"),
  Quality = c("Compromised", "Acceptable", "Good", "Standard")
)

pandemic_protocol %&gt;%
  kable(caption = "Pandemic Survey Adaptations")
```

---

# Slide 345: Security Crisis

### Conflict During Fieldwork

"2011 - Civil unrest erupts. 
Teams in field. Communications down."

**Security Protocol Activated:**
1. Extraction plan initiated
2. Safe houses activated
3. Local UN coordination
4. Embassy notification
5. Media blackout

**Result:** All staff evacuated safely in 48 hours

---

# Slide 346: Communication Crisis Plan

### When Systems Fail

```r
# Communication backup systems
comm_backup &lt;- tibble(
  Primary = c("Internet", "Mobile network", "Landline",
             "Power", "Transport"),
  Backup_1 = c("Mobile hotspot", "Satellite phone", "Mobile",
            "Generator", "Motorcycle"),
  Backup_2 = c("Satellite", "Radio", "Satellite",
            "Solar", "Bicycle"),
  Cost = c("$$", "$$$", "$$$", "$$", "$"),
  Test_Frequency = c("Weekly", "Monthly", "Monthly",
                    "Weekly", "NA")
)

comm_backup %&gt;%
  kable(caption = "Communication Redundancy Plan")
```

---

# Slide 347: Data Loss Prevention

### Protecting Your Investment

```r
# Data backup strategy
backup_strategy &lt;- tibble(
  Level = c("Field device", "Field supervisor", "Regional office",
           "HQ server", "Cloud", "Archive"),
  Frequency = c("Continuous", "Daily", "Daily",
               "Real-time", "Real-time", "Weekly"),
  Method = c("Device storage", "Encrypted USB", "Secure upload",
            "Auto-sync", "Auto-backup", "Tape/disk"),
  Redundancy = c("1x", "2x", "2x", "3x", "3x", "Permanent")
)

backup_strategy %&gt;%
  kable(caption = "Six-Level Data Protection")
```

---

# Slide 348: Team Crisis Management

### When Teams Collapse

```r
# Team crisis indicators and responses
team_crisis &lt;- tibble(
  Indicator = c("High turnover", "Low morale", "Conflicts",
               "Illness outbreak", "Strike threat"),
  Early_Warning = c("&gt;15% quit", "Complaints up", "Reports",
                   "3+ sick", "Rumors"),
  Response = c("Retention bonus", "Team meeting", "Mediation",
              "Health check", "Negotiate"),
  Prevention = c("Fair pay", "Regular feedback", "Clear roles",
                "Insurance", "Union dialogue")
)

team_crisis %&gt;%
  kable(caption = "Team Crisis Management")
```

---

# Slide 349: Weather Crisis Protocol

### Seasonal Disasters

```r
# Weather crisis management
weather_protocol &lt;- tibble(
  Event = c("Cyclone warning", "Flooding", "Extreme heat",
           "Snow/ice", "Drought"),
  Response = c("Evacuate coast", "Relocate ops", "Timing change",
              "Postpone", "Water provision"),
  Sample_Impact = c("Temp replace", "Permanent replace", "None",
                   "Delay", "None"),
  Cost_Impact = c("+30%", "+40%", "+10%", "+20%", "+15%"),
  Timeline = c("+2 weeks", "+4 weeks", "None", "+3 weeks", "None")
)

weather_protocol %&gt;%
  kable(caption = "Weather Crisis Responses")
```

---

# Slide 350: Political Crisis Navigation

### Elections and Coups

"2008 - Coup during fieldwork.
Survey branded 'government propaganda.'
Teams threatened."

**Political Crisis Management:**
- Immediate suspension
- Rebranding as "independent research"
- New partnerships with NGOs
- Resumed after 3 months
- Emphasized neutrality

**Lesson:** Political insurance essential

---

# Slide 351: Technology Failure

### When Systems Crash

```r
# Technology failure recovery
tech_recovery &lt;- tibble(
  Failure = c("Server crash", "Software bug", "Tablets stolen",
             "Internet down", "Power grid failure"),
  Immediate = c("Switch to backup", "Paper backup", "Police report",
               "Offline mode", "Generators"),
  Recovery_Time = c("4 hours", "2 days", "1 week",
                   "Continuous", "Immediate"),
  Data_Loss = c("None", "Minimal", "None if backed up",
               "None", "None"),
  Cost = c("$5k", "$2k", "$30k", "$1k", "$10k")
)

tech_recovery %&gt;%
  kable(caption = "Technology Failure Recovery")
```

---

# Slide 352: Frame Destruction

### When Sampling Frame Disappears

```r
# Frame destruction scenarios
frame_crisis &lt;- tibble(
  Scenario = c("Census building burns", "Flood destroys maps",
              "Cyber attack", "Political deletion",
              "Discovery of major errors"),
  Response = c("Reconstruct from backups", "Satellite imagery",
              "Paper backups", "Alternative sources",
              "Rapid re-listing"),
  Time_Impact = c("+1 month", "+2 months", "+2 weeks",
                 "+6 weeks", "+3 weeks"),
  Quality = c("Maintained", "Reduced", "Maintained",
             "Compromised", "Improved")
)

frame_crisis %&gt;%
  kable(caption = "Frame Destruction Recovery")
```

---

# Slide 353: Stakeholder Crisis

### Managing Expectations

```r
# Stakeholder crisis management
stakeholder_crisis &lt;- tibble(
  Stakeholder = c("Minister", "Donor", "Public", "Media", "Parliament"),
  Crisis = c("Wants different questions", "Threatens withdrawal",
            "Lost trust", "Negative coverage", "Questions validity"),
  Response = c("Document, explain impact", "Emergency meeting",
              "Transparency campaign", "Press conference",
              "Technical briefing"),
  Outcome = c("Compromise", "Negotiated", "Rebuilt slowly",
             "Corrected", "Accepted")
)

stakeholder_crisis %&gt;%
  kable(caption = "Stakeholder Crisis Management")
```

---

# Slide 354: Quality Crisis

### When Quality Fails

```r
# Quality failure recovery
quality_recovery &lt;- tibble(
  Problem = c("Fraud detected", "Translation errors",
             "Wrong sample", "Measurement error",
             "Weight miscalculation"),
  Detection = c("Validation", "Review", "Analysis",
               "External check", "Validation"),
  Response = c("Re-interview 20%", "Retranslate, redo",
              "Acknowledge, adjust", "Recalibrate",
              "Recalculate, document"),
  Impact = c("Major", "Major", "Fatal", "Serious", "Serious")
)

quality_recovery %&gt;%
  kable(caption = "Quality Crisis Recovery")
```

---

# Slide 355: Financial Controls

### Preventing Financial Crisis

```r
# Financial control framework
financial_controls &lt;- tibble(
  Control = c("Dual signature", "Weekly reconciliation",
             "Expense approval", "Audit trail",
             "Reserve fund"),
  Purpose = c("Prevent fraud", "Catch errors", "Control spending",
             "Accountability", "Emergency buffer"),
  Level = c("&gt;$1000", "All accounts", "&gt;$500",
           "All transactions", "10% budget"),
  Frequency = c("Every payment", "Weekly", "Before expense",
                "Real-time", "Maintained")
)

financial_controls %&gt;%
  kable(caption = "Financial Crisis Prevention")
```

---

# Slide 356: Media Crisis Management

### When Media Attacks

"2017 - Headline: 'Government Wastes Millions on Useless Survey'"

**Media Crisis Response:**
1. Don't panic or respond immediately
2. Gather facts
3. Prepare clear response
4. Use data to counter
5. Offer transparency
6. Learn for next time

**Result:** Public support increased after transparency

---

# Slide 357: Legal Crisis Preparation

### Legal Challenges

```r
# Legal crisis preparation
legal_prep &lt;- tibble(
  Issue = c("Privacy violation claim", "Discrimination complaint",
           "Contract dispute", "Injury claim",
           "Data breach"),
  Prevention = c("Clear consent", "EEO training", "Clear contracts",
                "Insurance", "Security protocol"),
  Response = c("Legal counsel", "Investigation", "Mediation",
              "Insurance claim", "Notification"),
  Cost = c("$$", "$", "$$$", "$$", "$$$")
)

legal_prep %&gt;%
  kable(caption = "Legal Crisis Preparation")
```

---

# Slide 358: Recovery Metrics

### Measuring Crisis Recovery

```r
# Recovery success metrics
recovery_metrics &lt;- tibble(
  Metric = c("Operations restored", "Quality recovered",
            "Team retained", "Budget impact",
            "Timeline impact", "Reputation"),
  Target = c("100%", "&gt;90%", "&gt;85%", "&lt;20%", "&lt;4 weeks", "Maintained"),
  Typical = c("95%", "85%", "75%", "25%", "6 weeks", "Damaged"),
  Best_Case = c("100%", "95%", "90%", "10%", "2 weeks", "Enhanced")
)

recovery_metrics %&gt;%
  kable(caption = "Crisis Recovery Success Metrics")
```

---

# Slide 359: Simulation Exercise

### Crisis Response Drill

```r
# Crisis simulation scenarios
simulation &lt;- function() {
  crises &lt;- c("Earthquake", "Budget cut 40%", "Team strike",
             "Data breach", "Political coup", "Pandemic")
  
  selected_crisis &lt;- sample(crises, 1)
  
  response_needed &lt;- list(
    immediate = "Safety and assessment",
    day_1 = "Stakeholder communication",
    week_1 = "Recovery plan",
    implementation = "Execute plan"
  )
  
  return(list(
    crisis = selected_crisis,
    response_checklist = response_needed
  ))
}

# Run simulation
simulation()
```

---

# Slide 360: Tuesday 5:00 PM Reality

### End of Day Crisis

Harry's phone rings at 4:55 PM:

"Donor wants preliminary results tomorrow.
We're only 60% complete.
Minister expecting briefing.
What do we do?"

**Real-time solution:**
- Explain situation honestly
- Provide what's available
- Clear confidence intervals
- Timeline for complete results
- Document everything

---

# Slide 361: Lessons Database

### Learning from Every Crisis

```r
# Crisis lessons database structure
lessons_db &lt;- tibble(
  Year = c(2010, 2015, 2018, 2020, 2023),
  Crisis = c("Flood", "Earthquake", "Budget cut",
            "COVID-19", "Coup"),
  Key_Lesson = c("Need backup sites", "Staff safety first",
                "Multiple funding sources", "Remote capability essential",
                "Political neutrality vital"),
  Change_Made = c("Alternative samples prepared", "Security protocol",
                 "Donor diversity", "Mixed-mode standard",
                 "Independence emphasized")
)

lessons_db %&gt;%
  kable(caption = "Crisis Lessons Database")
```

---

# Slide 362: Crisis Communication

### Clear Messages Under Pressure

```r
# Crisis communication templates
comm_templates &lt;- tibble(
  Audience = c("Staff", "Government", "Donors", "Public", "Media"),
  Key_Message = c("Safety first, instructions follow",
                 "Temporary delay, quality maintained",
                 "Funds secure, may need flexibility",
                 "Your data safe, survey continues",
                 "Technical issue, resolving quickly"),
  Channel = c("WhatsApp + SMS", "Official letter", "Video call",
             "Website + social", "Press release"),
  Timing = c("Immediate", "Within 24hr", "Within 24hr",
            "Within 48hr", "When ready")
)

comm_templates %&gt;%
  kable(caption = "Crisis Communication Framework")
```

---

# Slide 363: Insurance and Risk

### Financial Protection

```r
# Survey insurance coverage
insurance_coverage &lt;- tibble(
  Risk = c("General liability", "Professional indemnity",
          "Equipment", "Data breach", "Political risk"),
  Coverage = c("$2M", "$5M", "Replacement value",
              "$10M", "$1M"),
  Cost_Percent = c("0.5%", "1%", "2%", "1%", "3%"),
  Claim_Success = c("High", "Moderate", "High", "Low", "Low")
)

insurance_coverage %&gt;%
  kable(caption = "Survey Insurance Portfolio")
```

---

# Slide 364: Crisis Leadership

### Leading Through Crisis

**Harry's Crisis Leadership Principles:**

1. **Stay calm** - panic spreads fast
2. **Communicate clearly** - no ambiguity  
3. **Decide quickly** - perfect is enemy of good
4. **Document everything** - CYA essential
5. **Learn always** - every crisis teaches
6. **Protect people** - surveys replaceable, people aren't

"Leadership is tested in crisis"

---

# Slide 365: Contingency Reserves

### Budget Crisis Preparation

```r
# Contingency reserve planning
reserves &lt;- tibble(
  Component = c("General contingency", "Security emergency",
               "Natural disaster", "Technical failure",
               "Inflation buffer"),
  Percent_Budget = c(10, 3, 2, 2, 3),
  Access_Authority = c("PM", "Director", "Director", "PM", "PM"),
  Documentation = c("Simple", "Detailed", "Detailed", "Simple", "Simple")
)

reserves %&gt;%
  mutate(Total = sum(Percent_Budget)) %&gt;%
  kable(caption = "20% Total Contingency Reserve")
```

---

# Slide 366: Partner Network

### Crisis Support Network

```r
# Crisis support partners
support_network &lt;- tibble(
  Partner = c("UN OCHA", "Red Cross", "Military", "Police",
             "Embassy", "Local NGOs"),
  Support_Type = c("Coordination", "Emergency", "Evacuation",
                  "Security", "Diplomatic", "Local knowledge"),
  Contact_Level = c("Director", "Director", "Ministry",
                   "Commissioner", "Ambassador", "Director"),
  MOU_Status = c("Yes", "Yes", "Sometimes", "Sometimes", "Yes", "Yes")
)

support_network %&gt;%
  kable(caption = "Crisis Support Network")
```

---

# Slide 367: Post-Crisis Evaluation

### Learning and Improving

```r
# Post-crisis evaluation framework
evaluation_framework &lt;- tibble(
  Component = c("Response time", "Decision quality",
               "Communication", "Recovery speed",
               "Cost impact", "Lessons captured"),
  Metric = c("Hours to activate", "Outcomes achieved",
            "Stakeholder feedback", "Days to normal",
            "% over budget", "Database updated"),
  Target = c("&lt;24hr", "&gt;80% positive", "&gt;4/5 rating",
            "&lt;30 days", "&lt;20%", "100%")
)

evaluation_framework %&gt;%
  kable(caption = "Post-Crisis Evaluation")
```

---

# Slide 368: Crisis Prevention

### Proactive Risk Management

```r
# Risk prevention measures
prevention &lt;- tibble(
  Risk_Category = c("Natural", "Political", "Technical",
                   "Financial", "Human"),
  Prevention = c("Seasonal planning", "Neutrality maintained",
                "Redundancy built", "Controls strong",
                "Team care"),
  Investment = c("$", "$", "$$$", "$$", "$$"),
  ROI = c("10x", "Invaluable", "5x", "20x", "15x")
)

prevention %&gt;%
  kable(caption = "Crisis Prevention ROI")
```

---

# Slide 369: Global Crisis Examples

### Learning from Others

```r
# Global crisis case studies
global_cases &lt;- tibble(
  Country = c("Haiti 2010", "Syria 2011-", "Philippines 2013",
             "West Africa 2014", "Global 2020"),
  Crisis = c("Earthquake", "Conflict", "Typhoon",
            "Ebola", "COVID-19"),
  Survey_Impact = c("Complete restart", "Remote methods",
                   "Rapid assessment", "No-go zones",
                   "Mode change"),
  Innovation = c("SMS data", "WhatsApp surveys", "Drone mapping",
                "Phone panels", "Web transition")
)

global_cases %&gt;%
  kable(caption = "Global Crisis Innovations")
```

---

# Slide 370: Building Resilience

### Organizational Preparedness

```r
# Resilience building components
resilience &lt;- tibble(
  Component = c("Flexible contracts", "Cross-trained staff",
               "Multiple suppliers", "Diversified funding",
               "Strong partnerships"),
  Normal_Benefit = c("Cost savings", "Efficiency", "Competition",
                    "Stability", "Support"),
  Crisis_Benefit = c("Rapid adjustment", "Coverage maintained",
                    "Alternatives ready", "Buffer available",
                    "Help available"),
  Implementation = c("Standard", "Ongoing", "Policy", "Strategic", "Continuous")
)

resilience %&gt;%
  kable(caption = "Building Survey Resilience")
```

---

# Slide 371: Crisis Decision Tree

### Rapid Decision Framework

```r
cat("
CRISIS DECISION TREE

Is there immediate danger to staff?
├─ YES → Evacuate first, assess later
└─ NO → Continue assessment

Can survey objectives still be met?
├─ YES → Adapt and continue
└─ NO → Consider alternatives
    ├─ Partial completion possible?
    │   ├─ YES → Reduce scope
    │   └─ NO → Suspend/postpone
    └─ Alternative methods available?
        ├─ YES → Redesign
        └─ NO → Document and close
")
```

---

# Slide 372: Reputation Management

### Protecting Credibility

```r
# Reputation protection strategies
reputation &lt;- tibble(
  Threat = c("Quality questions", "Political bias claim",
            "Cost overrun", "Delay", "Data breach"),
  Response = c("Transparency", "Independence proof",
              "Explain value", "Regular updates",
              "Take responsibility"),
  Outcome = c("Trust maintained", "Credibility intact",
             "Understanding", "Patience", "Respect for honesty")
)

reputation %&gt;%
  kable(caption = "Reputation Crisis Management")
```

---

# Slide 373: Staff Welfare Crisis

### Caring for Teams

```r
# Staff welfare in crisis
staff_welfare &lt;- tibble(
  Support = c("Counseling services", "Emergency leave",
             "Salary advance", "Medical care",
             "Family support"),
  When = c("Trauma/stress", "Personal crisis", "Financial crisis",
          "Illness/injury", "Family emergency"),
  Policy = c("EAP contract", "5 days automatic", "1 month available",
            "Full coverage", "Flexible"),
  Usage = c("15% annually", "8% annually", "5% annually",
           "As needed", "3% annually")
)

staff_welfare %&gt;%
  kable(caption = "Staff Crisis Support Systems")
```

---

# Slide 374: Supply Chain Crisis

### When Materials Don't Arrive

```r
# Supply chain crisis management
supply_crisis &lt;- tibble(
  Item = c("Tablets", "Vehicles", "Paper forms",
          "PPE", "Fuel"),
  Alternative = c("Phones/paper", "Motorcycles/walk",
                 "Print locally", "Source locally",
                 "Budget increase"),
  Time_Impact = c("+1 week", "None", "+3 days",
                 "+1 week", "Immediate"),
  Quality_Impact = c("Minimal", "Slower", "None",
                    "None", "None")
)

supply_crisis %&gt;%
  kable(caption = "Supply Chain Alternatives")
```

---

# Slide 375: Exit Strategy

### When to Pull the Plug

```r
# Survey termination criteria
exit_criteria &lt;- tibble(
  Criterion = c("Staff safety", "Quality threshold",
               "Budget overrun", "Political interference",
               "Response rate"),
  Red_Line = c("Any threat", "&lt;60% standard", "&gt;50%",
              "Independence lost", "&lt;40%"),
  Decision = c("Immediate", "Consultation", "Donor discussion",
              "Document and exit", "Attempt recovery"),
  Recovery = c("When safe", "If fixable", "If funded",
              "If resolved", "One attempt")
)

exit_criteria %&gt;%
  kable(caption = "Survey Exit Criteria")
```

---

# Slide 376: Success Despite Crisis

### Tuesday 5:15 PM - Hope

Harry's closing story:

"2019 - Everything went wrong.
Cyclone, coup, budget cut 50%.
Team of 50 became 20.

We adapted, innovated, persevered.
Delivered quality data on time.
Won international recognition.

Crisis reveals character."

---

# Slide 377: Crisis Preparedness Checklist

### Your Emergency Ready Check

✅ Crisis response plan documented
✅ Communication tree established
✅ Backup systems tested
✅ Financial reserves allocated
✅ Insurance coverage adequate
✅ Partnerships documented
✅ Team trained on protocols
✅ Lessons database maintained
✅ Regular drills conducted

---

# Slide 378: 30 Years of Crises

### Harry's Crisis Statistics

```r
# Harry's career crisis summary
career_crises &lt;- tibble(
  Decade = c("1990s", "2000s", "2010s", "2020s"),
  Major_Crises = c(8, 12, 15, 10),
  Surveys_Lost = c(2, 1, 0, 0),
  Key_Learning = c("Preparation", "Flexibility", "Resilience", "Innovation")
)

career_crises %&gt;%
  mutate(Success_Rate = paste0(
    round((Major_Crises - Surveys_Lost) / Major_Crises * 100), "%"
  )) %&gt;%
  kable(caption = "Crisis Survival Rate: 95.6%")
```

---

# Slide 379: Final Crisis Wisdom

### What Harry Knows

**Crisis Management Truth:**

1. **Crises are certain** - not if, but when
2. **Preparation pays off** - 10x return
3. **People matter most** - protect them
4. **Documentation saves you** - always CYA
5. **Learn from everything** - growth opportunity
6. **Stay calm** - others depend on you

"Smooth seas never made skilled sailors"

---

# Slide 380: Module 8 Summary

### Crisis Management Mastery

**You Now Understand:**
- Crisis types and responses
- Prevention and preparation
- Communication strategies
- Recovery planning
- Documentation requirements
- Resilience building

"Every crisis conquered makes you stronger"

---

# Slide 381: Exercise - Crisis Response

### Your Crisis Plan

```r
# Design your crisis response
your_crisis_plan &lt;- list(
  survey = "National Health Survey",
  budget = 2000000,
  timeline = "6 months",
  crisis = "Earthquake destroys 30% of sample"
)

# Develop:
# 1. Immediate response (Day 1)
# 2. Assessment plan (Week 1)
# 3. Recovery strategy (Week 2-4)
# 4. Documentation needs

print("Create comprehensive crisis response")
# Solution in module8_crisis_plan.R
```

---

# Slide 382: Quick Reference - Crisis

### Crisis Response Quick Card

| Crisis Type | First Response | Key Decision | Timeline |
|------------|---------------|--------------|----------|
| Natural | Staff safety | Assess damage | 1-4 weeks |
| Political | Suspend | Neutrality | 2-8 weeks |
| Security | Evacuate | Safety assessment | 1-12 weeks |
| Budget | Options | Scope reduction | Immediate |
| Technical | Backup | Recovery plan | 1-2 weeks |

---

# Slide 383: International Crisis Support

### Global Resources Available

```r
# International crisis support
global_support &lt;- tibble(
  Organization = c("UN OCHA", "World Bank", "WHO", "UNHCR", "IOM"),
  Support = c("Coordination", "Funding", "Health emergency",
             "Refugee crisis", "Migration crisis"),
  Response_Time = c("24 hrs", "1 week", "48 hrs", "48 hrs", "72 hrs"),
  Contact = c("ocha.org", "worldbank.org", "who.int",
             "unhcr.org", "iom.int")
)

global_support %&gt;%
  kable(caption = "International Crisis Support")
```

---

# Slide 384: Module 8 Complete!

### Crisis Management Achieved

**Competencies Mastered:**
- ✓ Identify crisis types
- ✓ Activate response protocols
- ✓ Manage communications
- ✓ Lead through crisis
- ✓ Document everything
- ✓ Build resilience

---

# Slide 385: Tuesday Day Summary

### 8 Modules, 385 Slides, One Day

**What You've Learned:**
1. Complex design foundations
2. Stratification mastery
3. Cluster economics
4. Multi-stage integration
5. Weight calculations
6. Non-response solutions
7. Special populations
8. Crisis management

"From basics to advanced in one intense day"

---

# Slide 386: Key Takeaways

### Tuesday's Top 10 Lessons

1. **Stratify always** - variance reduction
2. **Cluster wisely** - cost efficiency
3. **Weight correctly** - validity
4. **Document everything** - credibility
5. **Plan for 70% response** - reality
6. **Special populations need special methods**
7. **Crises will happen** - prepare
8. **International standards matter**
9. **Software helps but understanding essential**
10. **Experience teaches what books cannot**

---

# Slide 387: Tomorrow Preview

### Wednesday - Advanced Topics

Harry's preview:

"Tomorrow we go deeper:
- Small area estimation
- Machine learning applications
- Real-time monitoring
- Quality frameworks
- Advanced variance
- Future of surveys

Rest well - tomorrow is intense!"

---

# Slide 388: Your Homework

### Before Tomorrow

Review and prepare:
1. Run code examples from today
2. Review modules 5-6 especially
3. Prepare your country case
4. List your challenges
5. Rest your brain!

"See you at 7:45 AM sharp!"

---

# Slide 389: Resources Recap

### Your Toolkit

**Standards Mastered:**
- World Bank LSMS Manual
- Eurostat Doc 65/2023
- UN Handbook F.98
- OECD PIAAC Standards
- WHO STEPS Manual
- ILO Survey Manual

**Software Ready:**
- R survey package
- Stata svy commands
- SPSS Complex Samples

---

# Slide 390: Network Building

### Stay Connected

```r
# Workshop network structure
network &lt;- tibble(
  Platform = c("WhatsApp Group", "GitHub Repo", "Email List",
              "LinkedIn Group", "Monthly Zoom"),
  Purpose = c("Quick help", "Code sharing", "Announcements",
             "Professional", "Deep dives"),
  Active = c("Daily", "Weekly", "Monthly", "Ongoing", "Monthly")
)

network %&gt;%
  kable(caption = "Post-Workshop Network")
```

---

# Slide 391: Personal Reflection

### Tuesday 5:30 PM

Harry's closing reflection:

"30 years ago, I knew nothing.
Today, you know what took me
decades to learn through mistakes.

Use this knowledge wisely.
Help others learn.
Build better surveys.
Generate better evidence.
Improve lives."

---

# Slide 392: Q&amp;A Preparation

### Your Questions Matter

Common end-of-day questions:
- How to convince management?
- Budget for proper design?
- Software recommendations?
- Career development?
- Specific country challenges?

"No question too basic or advanced"

---

# Slide 393: Acknowledgments

### Standing on Shoulders

Harry acknowledges:

"Every lesson comes from:
- Mentors who taught me
- Colleagues who corrected me
- Disasters that educated me
- Successes that motivated me
- Failures that humbled me"

"We build on others' experience"

---

# Slide 394: The Impact Potential

### Why This Matters

```r
# Survey impact calculation
impact &lt;- tibble(
  Decision = c("Poverty programs", "Health services", "Education",
              "Infrastructure", "Emergency response"),
  People_Affected = c("Millions", "Millions", "Millions",
                      "Millions", "Thousands"),
  Budget_Influenced = c("Billions", "Billions", "Billions",
                        "Billions", "Millions"),
  Your_Role = c("Critical", "Critical", "Critical",
               "Critical", "Critical")
)

impact %&gt;%
  kable(caption = "Your Survey Impact")
```

---

# Slide 395: Technical Excellence

### The Standard You Represent

"When you design a survey:
- Ministers depend on you
- Donors trust you
- People count on you
- History judges you
- Future builds on you

Technical excellence is ethical responsibility"

---

# Slide 396: Continuous Learning

### Survey Methods Evolution

```r
# Evolution timeline
evolution &lt;- tibble(
  Era = c("1990s", "2000s", "2010s", "2020s", "2030s"),
  Innovation = c("Computer-assisted", "Web surveys", "Mobile data",
                "AI/ML integration", "?"),
  Challenge = c("Training", "Coverage", "Quality", "Privacy", "Unknown"),
  Opportunity = c("Efficiency", "Speed", "Cost", "Insights", "Unlimited")
)

evolution %&gt;%
  kable(caption = "Survey Evolution Timeline")
```

---

# Slide 397: Your Action Plan

### Next 90 Days

Week 1-2:
- Review all materials
- Setup software
- Practice code

Week 3-4:
- Design pilot
- Test methods
- Document process

Month 2-3:
- Implement improvements
- Train team
- Share learnings

---

# Slide 398: Closing Philosophy

### Harry's Survey Philosophy

"Surveys are not about numbers.
They're about people's lives,
their struggles, hopes, needs.

Every percentage point represents
thousands of human stories.

Never forget the humanity
behind the statistics."

---

# Slide 399: Final Challenge

### Your Survey Mission

"I challenge you:

Design one survey that:
- Follows international standards
- Respects respondents
- Delivers quality data
- Influences positive change
- Makes you proud

That's success."

---

# Slide 400: End of Tuesday

### Day 2 Complete!

**Tuesday Achievement Unlocked:**
- 8 modules mastered
- 400 slides absorbed
- International standards learned
- Real experience shared
- Network built
- Confidence gained

**Harry's farewell:**
"See you tomorrow for Day 3.
Tonight, rest that amazing brain!"

---

## End of Tuesday Workshop
### 400 Slides of Intensity Complete

*"Today you learned 20 years of experience in 10 hours"*

**Tomorrow: Wednesday - Advanced Applications**
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "ratio": "16:9",
  "slideNumberFormat": "Module 1 - Slide %current% of 50"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
